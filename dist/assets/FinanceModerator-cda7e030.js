import{u as D,j as s,e as m,r as x,Q as k,c as W,k as Y,t as U,v as G,S as H}from"./index-0ca76035.js";import{A as K,B as X,C as Q,D as J}from"./finance-api-e818490b.js";import{B as r}from"./BorderBottom-1dc6f53e.js";import z from"./AssignStaffModal-e51a4441.js";import{C as y}from"./CustomNormalSelectInput-0a62fa3f.js";import{P as w}from"./PopupWrapper-2578092d.js";import{O as q}from"./Overlay-c8100e0a.js";import{S as Z}from"./SearchModalBackdrop-c4f123e6.js";import{s as b}from"./EditConfirm.module-344fbdb9.js";import"./search-api-b192a53f.js";import"./AssignStaffModal.module-a60b32e1.js";import"./JoinForm.module-212f9bb3.js";import"./SearchModalWrapper-0fa3f9a3.js";import"./Overlay.module-9133d1bb.js";import"./SearchHeader.module-b69c8942.js";const M="_moderator_container_1epgs_1",ss="_moderator_container_title_1epgs_4",is="_add_new_moderator_1epgs_10",cs="_moderator_card_1epgs_22",_s="_moderator_card_text_container_1epgs_44",ns="_menu_icon_1epgs_67",ts="_assign_role_container_1epgs_74",es="_assign_role_title_1epgs_81",ls="_selected_staff_container_1epgs_88",as="_selected_staff_text_1epgs_100",Es="_assign_btn_1epgs_118",Cs="_select_application_btn_1epgs_135",hs="_select_btn_1epgs_156",xs="_application_card_1epgs_174",os="_application_card_active_1epgs_191",As="_application_card_text_1epgs_194",ps="_application_card_text_bottom_1epgs_209",o={moderator_container:M,moderator_container_title:ss,add_new_moderator:is,moderator_card:cs,moderator_card_text_container:_s,menu_icon:ns,assign_role_container:ts,assign_role_title:es,selected_staff_container:ls,selected_staff_text:as,assign_btn:Es,select_application_btn:Cs,select_btn:hs,application_card:xs,application_card_active:os,application_card_text:As,application_card_text_bottom:ps},fs=({onCloseEdit:i,setActivePopup:g,selectedStaff:n,moderatorState:_,onSelectRole:c,onUpdateModerator:A})=>{const{t:C}=D();return s.jsx(s.Fragment,{children:s.jsx(w,{onClose:i,children:s.jsxs("div",{className:o.assign_role_container,children:[s.jsxs("section",{className:o.assign_role_title,children:[s.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:i,alt:"back icon",style:{cursor:"pointer"}}),s.jsx("h6",{children:C("update_role_to_moderator")})]}),s.jsx(r,{customStyle:{width:"100%"}}),s.jsxs("section",{className:o.selected_staff_container,onClick:()=>g("OPEN_STAFF_LIST"),children:[s.jsx("img",{src:n!=null&&n.staffProfilePhoto?`${m}/${n==null?void 0:n.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:"staff profile avatar"}),s.jsxs("div",{className:o.selected_staff_text,children:[s.jsx("h6",{children:`${n==null?void 0:n.staffFirstName} ${(n==null?void 0:n.staffMiddleName)??""} ${n==null?void 0:n.staffLastName}`}),s.jsxs("p",{children:[C("index_number"),n==null?void 0:n.staffROLLNO]})]})]}),s.jsxs("section",{style:{padding:"0.8rem"},children:[s.jsx(y,{selectLabel:C("select_role_of_moderator"),selectedValue:C("please_select_role"),options:["Cash Receipt Section","Inventories Section","Fees Master Section","Payroll Section","Deposit Section","Bank Account Section","Data Export Authority"],value:(_==null?void 0:_.mod_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(_==null?void 0:_.mod_role)==="INVENTORY_ACCESS"?"Inventories Section":(_==null?void 0:_.mod_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(_==null?void 0:_.mod_role)==="PAYROLL_ACCESS"?"Payroll Section":(_==null?void 0:_.mod_role)==="DEPOSIT_ACCESS"?"Deposit Section":(_==null?void 0:_.mod_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(_==null?void 0:_.mod_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":"",onClick:c}),s.jsxs("button",{className:o.assign_btn,onClick:A,children:[C("update")," "]})]})]})})})},$=({instituteId:i,fid:g,onClose:n,onRefetchWhenAdd:_,openModeratorMenu:c,openAs:A,onEdit:C})=>{var l;const{t:f}=D(),[p,S]=x.useState(A==="EDIT"?"PREVIEW_FORM":"OPEN_STAFF_LIST"),[e,u]=x.useState(A==="EDIT"?c==null?void 0:c.access_staff:""),[t,a]=x.useState({mod_role:A==="EDIT"?c==null?void 0:c.access_role:"",sid:A==="EDIT"?(l=c==null?void 0:c.access_staff)==null?void 0:l._id:""}),[j]=K();x.useEffect(()=>{var E;A==="EDIT"&&(u(c==null?void 0:c.access_staff),a({mod_role:c==null?void 0:c.access_role,sid:(E=c==null?void 0:c.access_staff)==null?void 0:E._id}),S("PREVIEW_FORM"))},[A]);const F=E=>{u(E),a(T=>({...T,sid:E==null?void 0:E._id})),S(A==="EDIT"?"PREVIEW_FORM":"ASSIGN_ROLE")},d=()=>{S("OPEN_STAFF_LIST")},I=E=>{a(T=>({...T,mod_role:E==="Cash Receipt Section"?"CASH_RECEIPT_ACCESS":E==="Inventories Section"?"INVENTORY_ACCESS":E==="Fees Master Section"?"FEE_MASTER_ACCESS":E==="Payroll Section"?"PAYROLL_ACCESS":E==="Deposit Section"?"DEPOSIT_ACCESS":E==="Bank Account Section"?"BANK_ACCOUNT_ACCESS":E==="Data Export Authority"?"DATA_EXPORT_ACCESS":""}))},P=()=>{S("LOADING"),j({fid:g,addModerator:t}).then(()=>{_(),S(""),n()}).catch({})},N=()=>{C(t),n()},O=()=>{n()};return s.jsxs(s.Fragment,{children:[p==="OPEN_STAFF_LIST"&&s.jsx(z,{assignHead:p==="OPEN_STAFF_LIST",headSelect:F,title:f("staff_list"),onClose:n,instituteId:i,viewAs:"ADMISSION_ADMIN"}),p==="ASSIGN_ROLE"&&s.jsx(s.Fragment,{children:s.jsx(w,{onClose:d,children:s.jsxs("div",{className:o.assign_role_container,children:[s.jsxs("section",{className:o.assign_role_title,children:[s.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:d,alt:"back icon",style:{cursor:"pointer"}}),s.jsx("h6",{children:f("assign_role_to_moderator")})]}),s.jsx(r,{customStyle:{width:"100%"}}),s.jsxs("section",{className:o.selected_staff_container,children:[s.jsx("img",{src:e!=null&&e.staffProfilePhoto?`${m}/${e==null?void 0:e.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:"staff profile avatar"}),s.jsxs("div",{className:o.selected_staff_text,children:[s.jsx("h6",{children:`${e==null?void 0:e.staffFirstName} ${(e==null?void 0:e.staffMiddleName)??""} ${e==null?void 0:e.staffLastName}`}),s.jsxs("p",{children:[f("index_number"),e==null?void 0:e.staffROLLNO]})]})]}),s.jsxs("section",{style:{padding:"0.8rem"},children:[s.jsx(y,{selectLabel:f("select_role_of_moderator"),selectedValue:f("please_select_role"),options:["Cash Receipt Section","Inventories Section","Fees Master Section","Payroll Section","Deposit Section","Bank Account Section","Data Export Authority"],value:(t==null?void 0:t.mod_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(t==null?void 0:t.mod_role)==="INVENTORY_ACCESS"?"Inventories Section":(t==null?void 0:t.mod_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(t==null?void 0:t.mod_role)==="PAYROLL_ACCESS"?"Payroll Section":(t==null?void 0:t.mod_role)==="DEPOSIT_ACCESS"?"Deposit Section":(t==null?void 0:t.mod_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(t==null?void 0:t.mod_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":"",onClick:I}),s.jsxs("button",{className:o.assign_btn,onClick:P,children:[f("assign")," "]})]})]})})}),p==="PREVIEW_FORM"&&s.jsx(fs,{onCloseEdit:O,setActivePopup:S,selectedStaff:e,moderatorState:t,onSelectRole:I,onUpdateModerator:N}),p==="LOADING"&&s.jsx(k,{})]})},gs=({onClose:i,financeId:g,onRefetch:n,openModeratorMenu:_,instituteId:c})=>{const[A,C]=x.useState(!1),[f,p]=x.useState(!1),[S]=X(),[e]=Q(),u=()=>{C(a=>!a),S({fid:g,modId:_==null?void 0:_._id}).then(()=>{n(),i(),C(a=>!a)}).catch({})},t=a=>{C(j=>!j),p(!1),e({modId:_==null?void 0:_._id,updateModerator:{role:a==null?void 0:a.mod_role,staffId:a==null?void 0:a.sid}}).then(()=>{n(),C(j=>!j),i()}).catch({})};return s.jsx(s.Fragment,{children:f?s.jsx($,{onClose:()=>p(!1),fid:g,instituteId:c,onRefetch:n,openAs:"EDIT",openModeratorMenu:_,onEdit:t}):s.jsxs(s.Fragment,{children:[s.jsx(Z,{onClose:i}),s.jsxs(q,{customStyle:{zIndex:"1200"},children:[s.jsxs("div",{className:b.edit_modal_container,style:{width:"200px"},children:[s.jsx("h6",{className:b.edit,onClick:()=>p(a=>!a),children:"Edit"}),s.jsx("h6",{className:b.remove,onClick:u,children:"Delete"})]}),A&&s.jsx(k,{})]})]})})},v=({moderator:i,setOpenModeratorMenu:g})=>{var _,c,A,C,f,p;const{t:n}=D();return s.jsxs("div",{className:o.moderator_card,children:[s.jsx("img",{src:(_=i==null?void 0:i.access_staff)!=null&&_.staffProfilePhoto?`${m}/${(c=i==null?void 0:i.access_staff)==null?void 0:c.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:"moderator avatar"}),s.jsxs("section",{className:o.moderator_card_text_container,children:[s.jsx("h6",{children:`${(A=i==null?void 0:i.access_staff)==null?void 0:A.staffFirstName} ${((C=i==null?void 0:i.access_staff)==null?void 0:C.staffMiddleName)??""} ${(f=i==null?void 0:i.access_staff)==null?void 0:f.staffLastName}`}),s.jsxs("p",{children:[n("index_number"),(p=i==null?void 0:i.access_staff)==null?void 0:p.staffROLLNO]}),s.jsx("p",{children:(i==null?void 0:i.access_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(i==null?void 0:i.access_role)==="INVENTORY_ACCESS"?"Inventories Section":(i==null?void 0:i.access_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(i==null?void 0:i.access_role)==="PAYROLL_ACCESS"?"Payroll Section":(i==null?void 0:i.access_role)==="DEPOSIT_ACCESS"?"Deposit Section":(i==null?void 0:i.access_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(i==null?void 0:i.access_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":""})]}),s.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:()=>g(i),className:o.menu_icon,title:"Menu"})]})},Ls=({financeId:i,insId:g})=>{const{t:n}=D(),_=W(),c=Y(h=>h.financeChange),[A,C]=x.useState(!1),[f,p]=x.useState(""),[S,e]=U(),[u,t]=x.useState(1),[a,j]=x.useState(!0),[F,d]=x.useState(!1),[I,P]=x.useState(!0),[N,O]=x.useState([]),{getModeratorByFinance:l,getModeratorByFinanceRefetch:E}=J({data:{fid:c.fid?c.fid:i,page:u,limit:10},skip:c.fid?!c.fid:!i}),{scrollToTop:T}=G();x.useEffect(()=>{T()},[]),x.useEffect(()=>{(c.fid||i)&&(P(!0),E())},[c.fid,i,u,E]),x.useEffect(()=>{e&&a&&t(h=>h+1)},[e,a]),x.useEffect(()=>{var h,R;F?(O(l==null?void 0:l.all_mods),d(!1),P(!1)):l!=null&&l.all_mods?(O(V=>[...new Set([...V,...l==null?void 0:l.all_mods].map(JSON.stringify))].map(JSON.parse)),P(!1)):((h=l==null?void 0:l.all_mods)==null?void 0:h.length)===0&&P(!1),((R=l==null?void 0:l.all_mods)==null?void 0:R.length)===10?j(!0):j(!1)},[l==null?void 0:l.all_mods]);const B=()=>{_(-1)},L=()=>{d(!0),t(1),P(!0),E()};return s.jsxs("div",{className:o.moderator_container,children:[s.jsxs("section",{className:o.moderator_container_title,children:[s.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:B,alt:"go to previous tab",title:"Go Back",style:{cursor:"pointer"}}),s.jsx("h6",{children:n("finance_moderator")})]}),s.jsx(r,{customStyle:{width:"100%"}}),s.jsx("h6",{className:o.add_new_moderator,onClick:()=>C(!0),children:n("add_new_moderator")}),s.jsxs("div",{className:o.refund_list,children:[N==null?void 0:N.map((h,R)=>(N==null?void 0:N.length)===R+1?s.jsx("div",{ref:S,children:s.jsx(v,{moderator:h,setOpenModeratorMenu:p})},h==null?void 0:h._id):s.jsx(v,{moderator:h,setOpenModeratorMenu:p},h==null?void 0:h._id)),A&&s.jsx($,{onClose:()=>C(h=>!h),instituteId:c.insId?c.insId:g,fid:c.fid?c.fid:i,onRefetchWhenAdd:L}),f&&s.jsx(gs,{financeId:c.fid?c.fid:i,instituteId:c.insId?c.insId:g,onRefetch:L,onClose:()=>p(""),openModeratorMenu:f}),I&&s.jsx(H,{})]})]})};export{Ls as default};
