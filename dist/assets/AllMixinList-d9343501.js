import{k,g as A,r as S,bS as R,j as d,L as t,A as O,e as $}from"./index-731451a5.js";import{k as q,l as b,m as U,n as E}from"./search-api-15f7f9f9.js";import{i as D}from"./constant_value-4cd2b3e0.js";import{u as G}from"./post-api-f57ebb8f.js";import{s as f}from"./SearchStyle.module-ded1a888.js";const V=({institute:a,hideModal:h})=>{var _,F,L;const o=k(l=>l.idChange),e=k(l=>l.postChange.dashboardPosts),r=A(),[s]=q(),[N]=b(),{allDashPost:c,allDashPostRefetch:B}=G({data:{id:o==null?void 0:o.id,viewAs:D},skip:!1}),{instituteOwnFollowingList:g}=U({page:1,id:a==null?void 0:a._id,limit:100}),{instituteFollowList:I,instituteFollowListRefetch:C}=E({list:{page:1,id:a==null?void 0:a._id,limit:100}});S.useEffect(()=>{c!=null&&c.post&&r(R.followPost({post:c==null?void 0:c.post,profilePost:"dash"}))},[c==null?void 0:c.post]);const M=l=>{const w=[];for(let j=0;j<(e==null?void 0:e.length);j++)e[j].author!==l&&w.push(e[j]);return w},H=()=>{s({followId:a==null?void 0:a._id}).then(l=>{l.data.message&&(C(),B())}).catch({})},P=()=>{const l=M(a==null?void 0:a._id);r(R.unfollowPost({posts:l})),N({followId:a==null?void 0:a._id}).then(w=>{w.data.message&&C()}).catch({})};return d.jsxs("div",{className:f.searchResult,children:[d.jsx(t,{to:`/q/${a==null?void 0:a.name}/profile`,onClick:()=>{r(O.searchId({id:a==null?void 0:a._id,type:"ID"})),h(!1)},children:d.jsxs("div",{className:f.searchResultLeft,children:[d.jsx("img",{src:(a==null?void 0:a.photoId)!=="1"?`${$}/${a==null?void 0:a.insProfilePhoto}`:"/images/ins_default_profile.svg",alt:""}),d.jsxs("div",{children:[d.jsx("h6",{children:a==null?void 0:a.insName}),d.jsx("p",{children:a==null?void 0:a.name})]})]})}),(_=g==null?void 0:g.following)!=null&&_.some(l=>l._id===(o==null?void 0:o.id))?d.jsx("div",{className:f.connectBtn,children:"Block"}):(F=a==null?void 0:a.follower)!=null&&F.includes(o.id)||(L=I==null?void 0:I.iFollowers)!=null&&L.some(l=>l._id===o.id)?d.jsx("div",{className:f.connectBtn,onClick:P,children:"Unfollow"}):d.jsx("div",{className:f.connectBtn,onClick:H,children:"Follow"})]})},v=({username:a,activeTab:h,imageShow:o,name:e,showBottomInfo:r,openType:s})=>{const N=A(),c=()=>{(s==null?void 0:s.asOpen)==="department"&&N(O.addDepartmentId({did:s==null?void 0:s.openId}))};return d.jsxs("div",{className:f.searchResult,children:[d.jsx(t,{to:(s==null?void 0:s.asOpen)==="department"?`/q/${s==null?void 0:s.urlName}/viewdept`:`/q/${a}/${h}`,state:{openType:s},onClick:c,children:d.jsxs("div",{className:f.searchResultLeft,children:[d.jsx("img",{src:o,alt:"avatar icon"}),d.jsxs("div",{children:[d.jsx("h6",{children:e}),d.jsx("p",{children:r})]})]})}),d.jsx(t,{to:(s==null?void 0:s.asOpen)==="department"?`/q/${s==null?void 0:s.urlName}/viewdept`:`/q/${a}/${h}`,state:{openType:s},onClick:c,children:d.jsx("div",{className:f.connectBtn,children:"View"})})]})},X=({mixin:a,onCloseSearch:h,username:o})=>{var e,r,s,N;return d.jsxs(d.Fragment,{children:[(a==null?void 0:a.insName)&&d.jsx(V,{institute:a,hideModal:h}),(a==null?void 0:a.staffFirstName)&&d.jsx(v,{username:o,activeTab:"staff",imageShow:`${$}/${a==null?void 0:a.staffProfilePhoto}`,name:`${a==null?void 0:a.staffFirstName} ${a!=null&&a.staffMiddleName?a==null?void 0:a.staffMiddleName:""} ${a==null?void 0:a.staffLastName}`,showBottomInfo:a==null?void 0:a.staffROLLNO,openType:{openId:a==null?void 0:a._id,asOpen:"staff"}}),(a==null?void 0:a.studentFirstName)&&d.jsx(v,{username:o,activeTab:"student",imageShow:`${$}/${a==null?void 0:a.studentProfilePhoto}`,name:`${a==null?void 0:a.studentFirstName} ${a!=null&&a.studentMiddleName?a==null?void 0:a.studentMiddleName:""} ${a==null?void 0:a.studentLastName}`,showBottomInfo:a==null?void 0:a.studentGRNO,openType:{openId:a==null?void 0:a._id,asOpen:"student"}}),(a==null?void 0:a.dName)&&d.jsx(v,{username:o,activeTab:"department",imageShow:a!=null&&a.photo?`${$}/${a==null?void 0:a.photo}`:"/images/profileAndCover/department-profile-img.svg",name:a==null?void 0:a.dName,showBottomInfo:`${(e=a==null?void 0:a.dHead)==null?void 0:e.staffFirstName} ${(r=a==null?void 0:a.dHead)!=null&&r.staffMiddleName?(s=a==null?void 0:a.dHead)==null?void 0:s.staffMiddleName:""} ${(N=a==null?void 0:a.dHead)==null?void 0:N.staffLastName}`,openType:{urlName:a==null?void 0:a.dName,openId:a==null?void 0:a._id,asOpen:"department"}})]})};export{X as A,v as C,V as I};
