import{u as b,n as ne,d as te,r as c,aa as y,j as a,L as ie,lH as re,t as ge,_ as ce,b as xe}from"./index-0ca76035.js";import{X as je,v as ve,a as Ne,Q as se,Y as Se,p as Re,q as we,s as L,r as Le,L as Ee,l as Pe,U as F,B as ee,H as $e,k as Fe}from"./FinanceConfig-24ef7fd2.js";import{l as be}from"./localTime-4e51d139.js";import{h as oe,a as ke}from"./pdf-convertor-function-4fe9e778.js";import{ab as ze}from"./admission-api-925391d9.js";import{p as Me}from"./pdfInternalFeeReceipt-24199e26.js";import{r as He}from"./main.receipt.pdf.worker-914052f8.js";const Oe="_settle_card_divgz_1",Te="_settle_card_container_divgz_12",Ue="_settle_card_text_divgz_23",Ce="_settle_paragraph_divgz_36",Ie="_sidebarheader_divgz_51",De="_text_divgz_63",We="_rcv_divgz_71",Ve="_history_image_container_divgz_84",f={settle_card:Oe,settle_card_container:Te,settle_card_text:Ue,settle_paragraph:Ce,sidebarheader:Ie,text:De,rcv:We,history_image_container:Ve},ae=({history:e})=>{var k,z,M,H,O,T,U,C,I,D,W,V,Y,q,B,K,Q,A,G;const{t:i}=b(),S=ne(),j=te(),[x,w]=c.useState(""),[m,N]=c.useState(!1),[s,R]=c.useState(""),[t,$]=c.useState(""),[r,E]=c.useState(""),{financeReceipt:n,financeReceiptRefetch:P}=je({rid:x,skip:!x});c.useEffect(()=>{x&&P()},[x,P]),c.useEffect(()=>{n!=null&&n.receipt&&(n!=null&&n.all_remain)&&R(n)},[n]),c.useEffect(()=>{var d;if(s){const _=new Worker(new URL(He,import.meta.url),{type:"module"});if(((d=s==null?void 0:s.all_remain)==null?void 0:d.remaining_flow)==="Hostel Application"){const{institute:p,studentInfo:g,paymentReceiptInfo:u}=oe(s==null?void 0:s.all_remain,s==null?void 0:s.receipt);_.postMessage({institute:p,studentInfo:g,paymentReceiptInfo:u,printReceiptType:(u==null?void 0:u.transactonRefund)==="Refunded"?"HOSTEL_REFUND":"HOSTEL"})}else{const{institute:p,studentInfo:g,paymentReceiptInfo:u}=ke(s==null?void 0:s.all_remain,s==null?void 0:s.receipt);_.postMessage({institute:p,studentInfo:g,paymentReceiptInfo:u,printReceiptType:(u==null?void 0:u.transactonRefund)==="Refunded"?"ADMISSION_REFUND":"ADMISSION"})}_.onmessage=p=>{p&&(window.open(p.data,"_blank"),N(g=>!g),R(""),_.terminate())}}},[s]);const _e=()=>{var d,_,p;(d=e==null?void 0:e.fee_receipt)!=null&&d._id&&(N(g=>!g),w((_=e==null?void 0:e.fee_receipt)==null?void 0:_._id),x===((p=e==null?void 0:e.fee_receipt)==null?void 0:p._id)&&R(n))},{internalFeeReceipt:v,internalFeeReceiptRefetch:o}=ze({rid:t,skip:!t});c.useEffect(()=>{t&&o()},[t,o]),c.useEffect(()=>{v!=null&&v.receipt&&(v!=null&&v.one_account)&&E(v)},[v]),c.useEffect(()=>{var d,_,p,g,u,X,J,Z;if(r){N(fe=>!fe);let h=r==null?void 0:r.one_account,l=r==null?void 0:r.receipt;const pe=(_=(d=l==null?void 0:l.finance)==null?void 0:d.institute)!=null&&_.insProfilePhoto?`${y}/${(g=(p=l==null?void 0:l.finance)==null?void 0:p.institute)==null?void 0:g.insProfilePhoto}`:"/images/certificate/logodemo.jpg",ue=(X=(u=l==null?void 0:l.finance)==null?void 0:u.institute)!=null&&X.affliatedLogo?`${y}/${(Z=(J=l==null?void 0:l.finance)==null?void 0:J.institute)==null?void 0:Z.affliatedLogo}`:"/images/certificate/logodemo.jpg";h&&l&&(Me(h,l,pe,ue),N(!1)),E(""),window.location.reload()}},[r]);const de=d=>{d&&(N(_=>!_),$(d))},le=()=>{},me=()=>{var d,_;(e==null?void 0:e.payment_module_type)==="Admission"||(e==null?void 0:e.payment_module_type)==="Admission Fees"||(e==null?void 0:e.payment_module_type)==="Hostel"||(e==null?void 0:e.payment_module_type)==="Hostel Fees"?_e((d=e==null?void 0:e.fee_receipt)==null?void 0:d._id):(e==null?void 0:e.payment_module_type)==="Income"?le():de((_=e==null?void 0:e.fee_receipt)==null?void 0:_._id)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:f.sidebarheader,style:{gap:"1%"},title:(e==null?void 0:e.payment_module_type)==="Income"?"":"View Receipt",children:[a.jsxs("div",{className:f.history_image_container,style:{width:"50%"},children:[(k=e==null?void 0:e.payment_student)!=null&&k.studentProfilePhoto?a.jsx(ie,{to:`/${S.username}/student/profile`,state:{...j.state,sid:(z=e==null?void 0:e.payment_student)==null?void 0:z._id},children:a.jsx("img",{src:`${re}/${(M=e==null?void 0:e.payment_student)==null?void 0:M.studentProfilePhoto}`,alt:"qr code",style:{width:"60px",height:"60px",borderRadius:"12px"}})}):null,a.jsxs("div",{className:f.text,children:[a.jsx("p",{className:f.rcv,children:i("recived_from")}),a.jsx("h6",{children:e!=null&&e.payment_student?`${(H=e==null?void 0:e.payment_student)==null?void 0:H.studentFirstName} ${(O=e==null?void 0:e.payment_student)==null?void 0:O.studentMiddleName} ${(T=e==null?void 0:e.payment_student)==null?void 0:T.studentLastName}`:((U=e==null?void 0:e.payment_by_end_user_id)==null?void 0:U.userLegalName)??(e==null?void 0:e.payment_by_end_user_id_name)}),a.jsxs("p",{className:f.rcv,children:[i("gr_number")," ",((C=e==null?void 0:e.payment_student)==null?void 0:C.studentGRNO)??""]}),a.jsx("p",{className:f.rcv,children:((D=(I=e==null?void 0:e.payment_student)==null?void 0:I.fee_structure)==null?void 0:D.unique_structure_name)??""})]})]}),a.jsxs("div",{className:f.text,style:{width:"27%"},children:[a.jsx("p",{className:f.rcv,style:{width:"100%"},children:i("transaction_id")}),a.jsx("h6",{style:{width:"100%",wordWrap:"break-word"},children:e!=null&&e.razorpay_payment_id?e==null?void 0:e.razorpay_payment_id:(W=e==null?void 0:e.fee_receipt)!=null&&W.fee_utr_reference?(V=e==null?void 0:e.fee_receipt)==null?void 0:V.fee_utr_reference:"N/A"}),a.jsxs("p",{className:f.rcv,style:{width:"100%"},children:[ve(e==null?void 0:e.created_at).format("DD MMM YYYY"),", ",be(e==null?void 0:e.created_at,"LT")]})]}),a.jsxs("div",{className:f.text,style:{width:"20%"},children:[a.jsxs("p",{className:f.rcv,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i("invoice_no")," ",((Y=e==null?void 0:e.fee_receipt)==null?void 0:Y.invoice_count)??(e==null?void 0:e.payment_invoice_number)??"N/A",a.jsx("img",{src:`${Ne}/receipt.svg`,alt:"receipt icon",title:"Download Fees Receipt",onClick:me})]}),a.jsxs("h6",{style:{width:"100%"},children:["Rs. ",e==null?void 0:e.payment_amount]}),a.jsx("p",{className:f.rcv,style:{width:"100%"},children:((q=e.payment_mode)==null?void 0:q.toLowerCase())==="offline"?(B=e==null?void 0:e.fee_receipt)!=null&&B.fee_payment_mode?`${(K=e==null?void 0:e.fee_receipt)==null?void 0:K.fee_payment_mode}`:"Offline - No Receipt":((Q=e.payment_mode)==null?void 0:Q.toLowerCase())==="online"?(A=e==null?void 0:e.fee_receipt)!=null&&A.fee_payment_mode?`${(G=e==null?void 0:e.fee_receipt)==null?void 0:G.fee_payment_mode}`:"Online - No Receipt":e==null?void 0:e.payment_mode})]})]}),m&&a.jsx(se,{})]})},Ye=({instituteId:e})=>{const{t:i}=b(),[S,j]=c.useState(""),[x,w]=c.useState(1),[m,N]=c.useState(!0),[s,R]=ge({skip:S}),{financeAllTransaction:t,financeAllTransactionLoading:$}=Se({data:{uid:e,page:x,limit:10,search:S,filter:""},skip:!e});c.useEffect(()=>{R&&m&&w(n=>n+1)},[R,m]),c.useEffect(()=>{t!=null&&t.length&&Re(t==null?void 0:t.length,N)},[t==null?void 0:t.length]);const r=c.useCallback(we(n=>j(n),500),[]),E=n=>{r(n.target.value)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:L.fm_search_full,children:a.jsx("section",{className:L.fm_search_full_container,children:a.jsxs("div",{className:L.fm_search_full_container_inner,children:[a.jsx("img",{className:L.fm_search_full_icon,alt:"search icon",src:`${Le}/navbar-search.svg`}),a.jsx("input",{type:"text",placeholder:i("search"),onChange:E})]})})}),$&&a.jsx(Ee,{}),t==null?void 0:t.map((n,P)=>(t==null?void 0:t.length)===P+1?a.jsx("div",{ref:s,children:a.jsx(ae,{history:n})},n==null?void 0:n._id):a.jsx(ae,{history:n},n==null?void 0:n._id))]})},qe=c.lazy(()=>ce(()=>import("./FinanceSettlement-ad915480.js"),["assets/FinanceSettlement-ad915480.js","assets/index-0ca76035.js","assets/index-4d24e8f6.css","assets/FinanceConfig-24ef7fd2.js","assets/FinanceConfig-b1ad62f1.css","assets/localTime-4e51d139.js","assets/pdf-convertor-function-4fe9e778.js","assets/admission-api-925391d9.js","assets/pdfInternalFeeReceipt-24199e26.js","assets/numberToWords.min-081ca735.js","assets/main.receipt.pdf.worker-914052f8.js"])),Be=c.lazy(()=>ce(()=>import("./FinanceHistory-d8f4e6fe.js"),["assets/FinanceHistory-d8f4e6fe.js","assets/index-0ca76035.js","assets/index-4d24e8f6.css","assets/FinanceConfig-24ef7fd2.js","assets/FinanceConfig-b1ad62f1.css","assets/localTime-4e51d139.js","assets/pdf-convertor-function-4fe9e778.js","assets/admission-api-925391d9.js","assets/pdfInternalFeeReceipt-24199e26.js","assets/numberToWords.min-081ca735.js","assets/main.receipt.pdf.worker-914052f8.js"])),Ke=[{label:"receipts",id:"receipt",urlKey:""},{label:"payments",id:"payment",urlKey:"&n=payment"},{label:"settlement_history",id:"settlement",urlKey:"&n=settlement"}],Qe=({fid:e,instituteId:i})=>{const{t:S}=b(),[j]=xe(),x=te(),w=ne();return a.jsxs(Pe,{children:[a.jsx(F,{children:a.jsx("div",{className:L.fm_header_container,children:a.jsx("h6",{children:S("transaction_history")})})}),a.jsx(ee,{}),a.jsxs(F,{customStyle:{paddingTop:"0"},children:[a.jsx($e,{children:Ke.map(m=>a.jsx(Fe,{tab:m,isLink:!0,isActive:m.id==="receipt"&&!j.get("n")?!0:j.get("n")===m.id,parentState:x.state,url:`/q/${w.username}/member/staff/finance?type=history${m.urlKey}`},m==null?void 0:m.id))}),a.jsx(ee,{customStyleBorder:{marginTop:"0"}})]}),a.jsx(F,{customStyle:{paddingTop:"0"},children:a.jsx(c.Suspense,{fallback:a.jsx(se,{}),children:j.get("n")==="payment"?a.jsx(Be,{instituteId:i}):j.get("n")==="settlement"?a.jsx(qe,{instituteId:i}):a.jsx(Ye,{instituteId:i})})})]})},ea=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"}));export{ea as T,f as s};
