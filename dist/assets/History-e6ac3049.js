import{u as B,j as t,a1 as O,k as q,R as v,r as i,t as A,v as G,l as ue,S as Q,n as Ne,aa as le,L as ve,e as xe,Q as Se,on as we,c as Re}from"./index-0ca76035.js";import{s as n}from"./History.module-4b700312.js";import{P as re}from"./finance-api-e818490b.js";import{E as W}from"./EmptyInfo-dd58cebb.js";import{p as Le}from"./pdfInternalFeeReceipt-24199e26.js";import{F as be,ab as Ee}from"./admission-api-925391d9.js";import{h as Te,a as Ie}from"./pdf-convertor-function-4fe9e778.js";import{r as Me}from"./main.receipt.pdf.worker-914052f8.js";import{B as _e}from"./BorderBottom-1dc6f53e.js";import{U as Pe}from"./UniversalTab-73e7f63a.js";import"./numberToWords.min-081ca735.js";function $e({detailview:e,setDetailView:a,onClickValue:s}){var p;const{t:m}=B();return t.jsx(t.Fragment,{children:t.jsx("div",{className:n.incomeRightt,children:e?t.jsxs("div",{className:n.detail,children:[t.jsxs("div",{className:n.detailTop,children:[t.jsx("div",{className:n.detailTopLeft,children:t.jsx("h6",{onClick:()=>a(!1),children:m("back")})}),t.jsx("div",{className:n.detailTopMid,children:t.jsx("h6",{children:((p=s==null?void 0:s.payment_by_end_user_id)==null?void 0:p.userLegalName)??(s==null?void 0:s.payment_by_end_user_id_name)})}),t.jsxs("div",{className:n.detailTopRight,children:["Rs. ",s==null?void 0:s.payment_amount]})]}),t.jsxs("div",{className:n.detailContent,children:[t.jsx("p",{children:m("transaction_mode")}),t.jsx("h6",{children:s==null?void 0:s.payment_mode})]}),t.jsxs("div",{className:n.detailContent,children:[t.jsx("p",{children:m("day_date")}),t.jsxs("h6",{children:[O(s==null?void 0:s.created_at).format("DD MMM yyyy")," ",O(s==null?void 0:s.created_at).format("LT")]})]})]}):""})})}const ie=({history:e,setOnClickValue:a,setDetailView:s})=>{var p,g,R,x,c,r,u;const{t:m}=B();return t.jsx(t.Fragment,{children:t.jsxs("div",{className:n.sidebarheader,onClick:()=>{a(e),s(!0)},children:[t.jsxs("div",{className:n.text,children:[t.jsx("p",{className:n.rcv,children:m("paid_to")}),t.jsx("h6",{children:((p=e==null?void 0:e.payment_by_end_user_id)==null?void 0:p.userLegalName)??(e==null?void 0:e.payment_by_end_user_id_name)}),t.jsxs("p",{className:n.rcv,children:[O(e==null?void 0:e.created_at).format("DD MMM yyyy")," ",O(e==null?void 0:e.created_at).format("LT")]})]}),t.jsxs("div",{className:n.text,style:{marginTop:"0.9rem"},children:[t.jsx("p",{className:n.rcv}),t.jsxs("h6",{children:["Rs. ",e==null?void 0:e.payment_amount]}),t.jsx("p",{className:n.rcv,children:((g=e.payment_mode)==null?void 0:g.toLowerCase())==="offline"?(R=e==null?void 0:e.fee_receipt)!=null&&R.fee_payment_mode?`${(x=e==null?void 0:e.fee_receipt)==null?void 0:x.fee_payment_mode}`:"Offline - No Receipt":((c=e.payment_mode)==null?void 0:c.toLowerCase())==="online"?(r=e==null?void 0:e.fee_receipt)!=null&&r.fee_payment_mode?`${(u=e==null?void 0:e.fee_receipt)==null?void 0:u.fee_payment_mode}`:"Online - No Receipt":e==null?void 0:e.payment_mode})]})]})})},Fe=({insId:e})=>{const{t:a}=B(),s=q(o=>o.financeChange),[m,p]=v.useState([]),[g,R]=i.useState(""),[x,c]=A({skip:g}),[r,u]=v.useState(!0),[M,_]=v.useState(1),[L,d]=v.useState(!1),[f,E]=v.useState(""),[j,D]=i.useState(!0),{financeAllHistory:l,financeAllHistoryRefetch:P}=re({data:{uid:s!=null&&s.insId?s==null?void 0:s.insId:e,page:M,limit:10,filter:"Expense",search:g},skip:s!=null&&s.insId?!(s!=null&&s.insId):!e}),{scrollToTop:C}=G();v.useEffect(()=>{C()},[]),v.useEffect(()=>{(s!=null&&s.insId||e)&&P()},[s==null?void 0:s.insId,e,M,g,P]),v.useEffect(()=>{c&&r&&_(o=>o+1)},[c,r]),v.useEffect(()=>{if(l!=null&&l.history)if(g)p(()=>l==null?void 0:l.history),D(!1);else{const o=[...m,...l==null?void 0:l.history],$=[...new Set(o.map(JSON.stringify))].map(JSON.parse);p($),D(!1)}(l==null?void 0:l.history.length)===10?u(!0):u(!1)},[l==null?void 0:l.history]);const U=i.useCallback(ue.debounce(o=>R(o),500),[]),J=o=>{U(o.target.value)};return t.jsx("div",{className:n.incomeContainer,children:t.jsxs("div",{className:n.income,style:{display:"flex",gap:"2%"},children:[t.jsxs("div",{className:n.incomeLeft,style:{width:L?"50%":"100%"},children:[t.jsx("div",{className:n.searchContainerr,children:t.jsxs("div",{className:n.searchContainer,children:[t.jsx("img",{alt:"",src:"/images/search-dept-icon.svg"}),t.jsx("input",{type:"text",placeholder:a("search"),onChange:J})]})}),t.jsxs("div",{className:n.itemsContainer,children:[m==null?void 0:m.map((o,$)=>(m==null?void 0:m.length)===$+1?t.jsx("div",{ref:x,children:t.jsx(ie,{history:o,setDetailView:d,setOnClickValue:E})},$):t.jsx(ie,{history:o,setDetailView:d,setOnClickValue:E},$)),j&&t.jsx(Q,{}),!j&&!m.length&&t.jsx(W,{customStyleContainer:{marginTop:"9rem"},title:"No search found."})]})]}),L&&t.jsx("div",{className:n.incomeRight,children:t.jsx($e,{setDetailView:d,detailview:L,onClickValue:f})})]})})},pe=({history:e,insId:a})=>{var C,U,J,o,$,z,k,K,X,Y,Z,H,V,h,y,ee,te,se,ae;const{t:s}=B(),m=Ne(),[p,g]=i.useState(""),[R,x]=i.useState(!1),[c,r]=i.useState(""),[u,M]=i.useState(""),[_,L]=i.useState(""),{getFeeReceiptDetail:d,getFeeReceiptDetailRefetch:f}=be({rid:p,skip:!p});i.useEffect(()=>{p&&f()},[p,f]),i.useEffect(()=>{d!=null&&d.receipt&&(d!=null&&d.all_remain)&&r(d)},[d]),i.useEffect(()=>{var N;if(c){const S=new Worker(new URL(Me,import.meta.url),{type:"module"});if(((N=c==null?void 0:c.all_remain)==null?void 0:N.remaining_flow)==="Hostel Application"){const{institute:T,studentInfo:F,paymentReceiptInfo:b}=Te(c==null?void 0:c.all_remain,c==null?void 0:c.receipt);S.postMessage({institute:T,studentInfo:F,paymentReceiptInfo:b,printReceiptType:(b==null?void 0:b.transactonRefund)==="Refunded"?"HOSTEL_REFUND":"HOSTEL"})}else{const{institute:T,studentInfo:F,paymentReceiptInfo:b}=Ie(c==null?void 0:c.all_remain,c==null?void 0:c.receipt);S.postMessage({institute:T,studentInfo:F,paymentReceiptInfo:b,printReceiptType:(b==null?void 0:b.transactonRefund)==="Refunded"?"ADMISSION_REFUND":"ADMISSION"})}S.onmessage=T=>{T&&(window.open(T.data,"_blank"),x(F=>!F),r(""),S.terminate())}}},[c]);const E=N=>{N&&(x(S=>!S),g(N),p===N&&r(d))},{internalFeeReceipt:j,internalFeeReceiptRefetch:D}=Ee({rid:u,skip:!u});i.useEffect(()=>{u&&D()},[u,D]);const l=N=>{N&&(x(S=>!S),M(N))};i.useEffect(()=>{j!=null&&j.receipt&&(j!=null&&j.one_account)&&L(j)},[j]),i.useEffect(()=>{var N,S,T,F,b,ne,ce,de;if(_){x(oe=>!oe);let me=_==null?void 0:_.one_account,w=_==null?void 0:_.receipt;const ge=(S=(N=w==null?void 0:w.finance)==null?void 0:N.institute)!=null&&S.insProfilePhoto?`${le}/${(F=(T=w==null?void 0:w.finance)==null?void 0:T.institute)==null?void 0:F.insProfilePhoto}`:"/images/certificate/logodemo.jpg",je=(ne=(b=w==null?void 0:w.finance)==null?void 0:b.institute)!=null&&ne.affliatedLogo?`${le}/${(de=(ce=w==null?void 0:w.finance)==null?void 0:ce.institute)==null?void 0:de.affliatedLogo}`:"/images/certificate/logodemo.jpg";me&&w&&(Le(me,w,ge,je),x(!1)),L(""),window.location.reload()}},[_]);const P=()=>{};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:n.sidebarheader,style:{gap:"1%"},title:(e==null?void 0:e.payment_module_type)==="Income"?"":"View Receipt",children:[t.jsxs("div",{className:n.history_image_container,style:{width:"50%"},children:[(C=e==null?void 0:e.payment_student)!=null&&C.studentProfilePhoto?t.jsx(ve,{to:`/q/${m.username}/student/profile`,state:{sid:(U=e==null?void 0:e.payment_student)==null?void 0:U._id,viewAs:"FINANCE_MANAGER",instituteId:a},children:t.jsx("img",{src:`${xe}/${(J=e==null?void 0:e.payment_student)==null?void 0:J.studentProfilePhoto}`,alt:"qr code",style:{width:"60px",height:"60px",borderRadius:"12px"}})}):null,t.jsxs("div",{className:n.text,children:[t.jsx("p",{className:n.rcv,children:s("recived_from")}),t.jsx("h6",{children:e!=null&&e.payment_student?`${(o=e==null?void 0:e.payment_student)==null?void 0:o.studentFirstName} ${($=e==null?void 0:e.payment_student)==null?void 0:$.studentMiddleName} ${(z=e==null?void 0:e.payment_student)==null?void 0:z.studentLastName}`:((k=e==null?void 0:e.payment_by_end_user_id)==null?void 0:k.userLegalName)??(e==null?void 0:e.payment_by_end_user_id_name)}),t.jsxs("p",{className:n.rcv,children:[s("gr_number")," ",((K=e==null?void 0:e.payment_student)==null?void 0:K.studentGRNO)??""]}),t.jsx("p",{className:n.rcv,children:((Y=(X=e==null?void 0:e.payment_student)==null?void 0:X.fee_structure)==null?void 0:Y.unique_structure_name)??""})]})]}),t.jsxs("div",{className:n.text,style:{width:"27%"},children:[t.jsx("p",{className:n.rcv,style:{width:"100%"},children:s("transaction_id")}),t.jsx("h6",{style:{width:"100%",wordWrap:"break-word"},children:e!=null&&e.razorpay_payment_id?e==null?void 0:e.razorpay_payment_id:(Z=e==null?void 0:e.fee_receipt)!=null&&Z.fee_utr_reference?(H=e==null?void 0:e.fee_receipt)==null?void 0:H.fee_utr_reference:"N/A"}),t.jsxs("p",{className:n.rcv,style:{width:"100%"},children:[O(e==null?void 0:e.created_at).format("DD MMM yyyy"),", ",O(e==null?void 0:e.created_at).format("LT")]})]}),t.jsxs("div",{className:n.text,style:{width:"20%"},children:[t.jsxs("p",{className:n.rcv,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s("invoice_no")," ",((V=e==null?void 0:e.fee_receipt)==null?void 0:V.invoice_count)??(e==null?void 0:e.payment_invoice_number)??"N/A",t.jsx("img",{src:"/images/member_tab/admission/admission-receipt-download.svg",onClick:()=>{var N,S;(e==null?void 0:e.payment_module_type)==="Admission"||(e==null?void 0:e.payment_module_type)==="Admission Fees"||(e==null?void 0:e.payment_module_type)==="Hostel"||(e==null?void 0:e.payment_module_type)==="Hostel Fees"?E((N=e==null?void 0:e.fee_receipt)==null?void 0:N._id):(e==null?void 0:e.payment_module_type)==="Income"?P():l((S=e==null?void 0:e.fee_receipt)==null?void 0:S._id)},alt:"receipt icon",title:"Download Fees Receipt"})]}),t.jsxs("h6",{style:{width:"100%"},children:["Rs. ",e==null?void 0:e.payment_amount]}),t.jsx("p",{className:n.rcv,style:{width:"100%"},children:((h=e.payment_mode)==null?void 0:h.toLowerCase())==="offline"?(y=e==null?void 0:e.fee_receipt)!=null&&y.fee_payment_mode?`${(ee=e==null?void 0:e.fee_receipt)==null?void 0:ee.fee_payment_mode}`:"Offline - No Receipt":((te=e.payment_mode)==null?void 0:te.toLowerCase())==="online"?(se=e==null?void 0:e.fee_receipt)!=null&&se.fee_payment_mode?`${(ae=e==null?void 0:e.fee_receipt)==null?void 0:ae.fee_payment_mode}`:"Online - No Receipt":e==null?void 0:e.payment_mode})]})]}),R&&t.jsx(Se,{})]})},Oe=({insId:e})=>{const a=q(l=>l.financeChange),[s,m]=v.useState([]),[p,g]=i.useState(""),[R,x]=A({skip:p}),[c,r]=v.useState(!0),[u,M]=v.useState(1),[_,L]=i.useState(!0),{financeAllHistory:d,financeAllHistoryRefetch:f}=re({data:{uid:a!=null&&a.insId?a==null?void 0:a.insId:e,page:u,limit:10,filter:"",search:p},skip:a!=null&&a.insId?!(a!=null&&a.insId):!e}),{scrollToTop:E}=G();i.useEffect(()=>{E()},[]),v.useEffect(()=>{(a!=null&&a.insId||e)&&(L(!0),f())},[a==null?void 0:a.insId,e,u,p,f]),v.useEffect(()=>{x&&c&&M(l=>l+1)},[x,c]),v.useEffect(()=>{d!=null&&d.history&&(p?(m(()=>d==null?void 0:d.history),L(!1)):(m(l=>[...new Set([...l,...d==null?void 0:d.history].map(JSON.stringify))].map(JSON.parse)),L(!1))),(d==null?void 0:d.history.length)===10?r(!0):r(!1)},[d==null?void 0:d.history]);const j=i.useCallback(ue.debounce(l=>g(l),500),[]),D=l=>{j(l.target.value)};return t.jsxs("div",{className:n.incomeContainer,children:[t.jsx("div",{className:n.searchContainerr,children:t.jsxs("div",{className:n.searchContainer,children:[t.jsx("img",{alt:"",src:"/images/search-dept-icon.svg"}),t.jsx("input",{type:"text",placeholder:"Search",onChange:D})]})}),t.jsxs("div",{className:n.itemsContainer,children:[s==null?void 0:s.map((l,P)=>(s==null?void 0:s.length)===P+1?t.jsx("div",{ref:R,children:t.jsx(pe,{history:l,insId:e})},P):t.jsx(pe,{history:l,insId:e},P)),_&&t.jsx(Q,{}),!_&&!s.length&&t.jsx(W,{customStyleContainer:{marginTop:"9rem"},title:"No search found."})]})]})},De="_dueList_6s0an_1",Be="_settle_card_6s0an_5",Ce="_settle_card_container_6s0an_16",Ue="_settle_card_text_6s0an_23",Je="_settle_paragraph_6s0an_38",I={dueList:De,settle_card:Be,settle_card_container:Ce,settle_card_text:Ue,settle_paragraph:Je};function fe({repay:e}){var s,m;const{t:a}=B();return t.jsxs("div",{className:I.settle_card,children:[t.jsxs("div",{className:I.settle_card_container,children:[t.jsx("img",{src:"/images/career/newLogo.svg",alt:"logo",style:{width:"60px",height:"60px",borderRadius:"12px"}}),t.jsxs("div",{className:I.settle_card_text,children:[t.jsxs("h6",{children:[a("settlement_date")," "," : ",(e==null?void 0:e.settlement_date)??""]}),t.jsxs("p",{className:I.settle_paragraph,children:[a("message")," "," : "," ",(e==null?void 0:e.message)??""]}),t.jsxs("p",{className:I.settle_paragraph,children:[a("transition_id")," : "," ",(e==null?void 0:e.txnId)??""]}),t.jsxs("p",{className:I.settle_paragraph,children:[a("bank_name")," : ",((m=(s=e==null?void 0:e.bank_account)==null?void 0:s[0])==null?void 0:m.finance_bank_account_name)??""]})]})]}),t.jsxs("div",{className:I.settle_card_text,style:{alignItems:"flex-end"},children:[e!=null&&e.excel_attach?t.jsx("a",{title:"Download File",href:`${xe}/${e==null?void 0:e.excel_attach}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:t.jsx("img",{src:"/images/member_tab/subject/subject-excel-icon.svg",alt:"excel icon",style:{cursor:"pointer",height:"1.5rem"}})}):null,t.jsxs("h6",{children:["Rs. ",(e==null?void 0:e.repayAmount)??""]}),t.jsx("p",{className:I.settle_paragraph,children:`${O(e==null?void 0:e.createdAt).format("DD MMM, yyyy")}, ${O(e==null?void 0:e.createdAt).format("LT")}`})]})]})}function qe({insId:e}){const a=q(f=>f.financeChange),[s,m]=A(),[p,g]=i.useState(1),[R,x]=i.useState(!0),[c,r]=i.useState(!0),[u,M]=i.useState([]),{data:_,refetch:L}=we({info:{page:p,limit:10,fid:a!=null&&a.insId?a==null?void 0:a.insId:e},skip:a!=null&&a.insId?!(a!=null&&a.insId):!e});i.useEffect(()=>{(e||a!=null&&a.insId)&&(r(!0),L())},[e,a==null?void 0:a.insId,p,L]),i.useEffect(()=>{m&&R&&g(f=>f+1)},[m,R]);const{scrollToTop:d}=G();return i.useEffect(()=>{d()},[]),i.useEffect(()=>{var f,E;_!=null&&_.repay?(M(j=>[...new Set([...j,..._==null?void 0:_.repay].map(JSON.stringify))].map(JSON.parse)),r(!1)):((f=_==null?void 0:_.repay)==null?void 0:f.length)===0&&r(!1),((E=_==null?void 0:_.repay)==null?void 0:E.length)===10?x(!0):x(!1)},[_==null?void 0:_.repay]),t.jsxs("div",{className:I.dueList,children:[u==null?void 0:u.map((f,E)=>(u==null?void 0:u.length)===E+1?t.jsx("div",{ref:s,children:t.jsx(fe,{repay:f})},f==null?void 0:f._id):t.jsx(fe,{repay:f},f==null?void 0:f._id)),c&&t.jsx(Q,{}),!c&&!u.length&&t.jsx(W,{customStyleContainer:{marginTop:"9rem"},title:"No due payment."})]})}function Ve({insId:e}){const{t:a}=B(),s=Re(),[m,p]=i.useState(0),g=[{name:a("payment_receipts"),id:0},{name:a("payments"),id:1},{name:a("finance_settlement"),id:2}],R=()=>{s(-1)},x=c=>{p(c)};return t.jsxs("div",{className:n.history,children:[t.jsxs("section",{className:n.moderator_container_title,children:[t.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:R,alt:"go to previous tab",title:"Go Back",style:{cursor:"pointer"}}),t.jsx("div",{className:n.moderator_container_title_filter,children:t.jsx("h6",{children:a("finance_transaction_hisotry")})})]}),t.jsx(_e,{customStyle:{width:"100%"}}),t.jsx(Pe,{tabList:g,activeIndexTab:m,setActiveIndexTab:x,showAs:!1,customStyleTab:{width:"33.3%"}}),t.jsx(_e,{customStyle:{width:"100%",marginBottom:"0.5rem"}}),m===0&&t.jsx(Oe,{insId:e}),m===1&&t.jsx(Fe,{insId:e}),m===2&&t.jsx(qe,{insId:e})]})}export{Ve as default};
