import{n as Q,r as t,j as a,L as Y,e as z,Q as re,bo as te,u as ce,t as oe,v as me,l as ne,S as ie}from"./index-0ca76035.js";import{s as l}from"./AdmissionScholarship.module-d4281c11.js";import{g as _e}from"./institute-staff-student-api-7114d611.js";import{B as Z}from"./BorderBottom-1dc6f53e.js";import{b as fe}from"./export-data-api-674b559b.js";import{E as he}from"./EmptyInfo-dd58cebb.js";import{b as pe}from"./admission-api-925391d9.js";import{A as ge}from"./AllStudentFilter-af77389c.js";import{S as de}from"./SendFilterStudentMessage-e0daf41f.js";const H=({student:e,is_view:r,messageId:m,headId:E,instituteId:x})=>{var _;const g=Q(),[i,o]=t.useState(!1),[S]=fe(),j=A=>{A.preventDefault(),o(!0),S({instituteId:e==null?void 0:e._id}).then(f=>{var d;window.open(`${te}/${(d=f==null?void 0:f.data)==null?void 0:d.Key}`,"_blank"),o(!1)}).catch({})};return a.jsxs(a.Fragment,{children:[a.jsxs(Y,{to:`/q/${g.username}/student/profile`,state:{sid:e==null?void 0:e._id,viewAs:r||"INSTITUTE_ADMIN",messageId:m,headId:E,studentMessaageView:"STUDENT_MESSAGE",instituteId:x},children:[a.jsxs("div",{className:l.student_table_content_card,children:[a.jsx("p",{className:l.student_table_header_label,style:{flex:"1"},children:(e==null?void 0:e.studentGRNO)??""}),a.jsxs("div",{className:l.student_table_profile,style:{flex:"3"},children:[r==="ID_CARD_SECTION"?a.jsx("img",{src:e!=null&&e.studentProfilePhoto?`${z}/${e==null?void 0:e.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",loading:"lazy",alt:"avatar",style:{cursor:"pointer"},title:"Download profile photo",onClick:j}):a.jsx("img",{src:e!=null&&e.studentProfilePhoto?`${z}/${e==null?void 0:e.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",loading:"lazy",alt:"avatar"}),a.jsxs("div",{children:[a.jsxs("p",{className:l.student_table_header_name,children:[`${(e==null?void 0:e.studentFirstName)??""} ${(e==null?void 0:e.studentMiddleName)??""} ${(e==null?void 0:e.studentLastName)??""}`,(e==null?void 0:e.profile_percentage)==="100"||(e==null?void 0:e.profile_percentage)===100?a.jsx("img",{src:"/images/member_tab/class/profile-complete-icon.svg",loading:"lazy",alt:"avatar",style:{marginLeft:"0.6rem",height:"1rem"}}):null]}),a.jsx("p",{className:l.student_table_header_label_text,children:((_=e==null?void 0:e.studentClass)==null?void 0:_.classTitle)??""})]})]}),a.jsxs("div",{className:l.student_table_header_label,style:{flex:"2"},children:[a.jsxs("div",{className:l.student_table_contact,children:[a.jsx("img",{src:"/images/user_signup/gender.svg",alt:"gender icon"}),a.jsx("p",{className:l.student_table_contact_email,children:e==null?void 0:e.studentGender})]}),a.jsxs("div",{className:l.student_table_contact,style:{marginTop:"0.4rem"},children:[a.jsx("img",{src:"/images/phone-white.svg",alt:""}),a.jsx("p",{className:l.student_table_contact_number,children:e!=null&&e.user.userPhoneNumber?e==null?void 0:e.user.userPhoneNumber:(e==null?void 0:e.user.userEmail)??""})]})]}),a.jsx("p",{className:l.student_table_header_label,style:{flex:"1"},children:(e==null?void 0:e.applicable_fees_pending)??0})]}),a.jsx(Z,{customStyle:{width:"100%"}})]}),i&&a.jsx(re,{})]})},Ie=({instituteId:e,is_view:r,viewId:m,studentAlias:E,headId:x,carryParentState:g})=>{var M;const{t:i}=ce(),o=Q(),[S,j]=t.useState(!0),[_,A]=t.useState(""),[f,d]=t.useState(1),[J,I]=oe({skip:_}),[h,T]=t.useState([]),[y,b]=t.useState(!0),[N,C]=t.useState({depart_arr:[],batch_arr:[],master_arr:[],gender:"",cast_category:"",filter_by:""}),[K,D]=t.useState(!1),[$,B]=t.useState(!1),[W,R]=t.useState(!1),[X,w]=t.useState([]),{scrollToTop:O}=me(),[ee]=_e(),{getPendingCustomFilterByAdmission:n,getPendingCustomFilterByAdmissionRefetch:q}=pe({data:{aid:m,flow:r==="ADMISSION_ADMIN"?"Admission_Student_Filter":r==="FINANCE_MANAGER"?"Finance_Student_Filter":r==="CERTIFICATE_AUTHORITY"?"Certificate_Section_Filter":r==="STUDENT_SECTION"?"Student_Section_Filter":r==="ID_CARD_SECTION"?"Id_Card_Section_Filter":"Institute_Filter"},skip:!m});t.useEffect(()=>{m&&q()},[m,q]),t.useEffect(()=>{var s,p;if((s=n==null?void 0:n.ads_admin)!=null&&s.pending_fee_custom_filter){let c=(p=n==null?void 0:n.ads_admin)==null?void 0:p.pending_fee_custom_filter;C({depart_arr:c==null?void 0:c.department,batch_arr:c==null?void 0:c.batch,master_arr:c==null?void 0:c.master,gender:c==null?void 0:c.gender,cast_category:c==null?void 0:c.cast_category,filter_by:""}),B(!0)}},[(M=n==null?void 0:n.ads_admin)==null?void 0:M.pending_fee_custom_filter]);const u=t.useCallback(()=>{$&&ee({id:e,page:f,limit:10,search:_,is_view:r,mid:m,filter_by:N.filter_by,filterData:{...N}}).then(s=>{var p,c,F,U,L,P,k,G,v;(p=s.data)!=null&&p.studentIns&&(w((c=s.data)==null?void 0:c.all_student_query),_?(T((F=s.data)==null?void 0:F.studentIns),b(!1)):(U=s.data)!=null&&U.studentIns?(T(f===1?(L=s.data)==null?void 0:L.studentIns:le=>{var V;return[...new Set([...le,...(V=s.data)==null?void 0:V.studentIns].map(JSON.stringify))].map(JSON.parse)}),b(!1)):((k=(P=s.data)==null?void 0:P.studentIns)==null?void 0:k.length)===0&&b(!1),((v=(G=s.data)==null?void 0:G.studentIns)==null?void 0:v.length)===10?j(!0):j(!1))}).catch({})},[_,f,e,m,N,$]);t.useEffect(()=>{I&&S&&d(s=>s+1)},[I,S]),t.useEffect(()=>{e&&(b(!0),u())},[f,e,_,u]),t.useEffect(()=>{d(s=>1),b(!0),u()},[N]);const ae=t.useCallback(ne.debounce(s=>A(s),500),[]),se=s=>{d(1),ae(s.target.value),s.target.value||(u(),b(!0))};return t.useEffect(()=>{O()},[O]),a.jsxs("div",{className:l.moderator_container,style:{marginTop:"0"},children:[a.jsx("section",{className:l.moderator_container_title,children:a.jsxs("div",{className:l.with_search,children:[a.jsx("h6",{children:i("all_students")}),a.jsxs("section",{className:l.search_container,style:{gap:"1rem"},children:[a.jsxs("div",{className:l.search_container_input,children:[a.jsx("img",{className:l.searchIcon,alt:"search icon",src:"/images/search-dash-icon.svg"}),a.jsx("input",{type:"text",placeholder:"Search student...",onChange:se,style:{width:"400px"}})]}),a.jsxs("div",{className:l.os_filter_container,children:[a.jsx("img",{src:"/images/filter-blue-icon.svg",alt:"filter icon",onClick:()=>D(!0),style:{cursor:"pointer"}}),a.jsx(Y,{to:r==="FINANCE_MANAGER"?`/q/${o.username}/member/finance?a=student-message`:r==="ADMISSION_ADMIN"?`/q/${o.username}/member/admission?a=student-message`:r==="ID_CARD_SECTION"?`/q/${o.username}/member/idcard?a=student-message`:r==="CERTIFICATE_AUTHORITY"?`/q/${o.username}/member/certificate?a=student-message`:r==="STUDENT_SECTION"?`/q/${o.username}/member/promote?a=student-message`:`/q/${o.username}/member`,state:g,children:a.jsx("img",{src:"/images/member_tab/finance/finance-message-log-icon.svg",alt:"receipt icon",title:"View message history",style:{height:"2rem",cursor:"pointer"}})}),a.jsx("button",{className:l.os_reminder,onClick:()=>R(!0),children:i("student_message")})]})]})]})}),a.jsxs("div",{className:l.student_table,children:[a.jsxs("div",{className:l.student_table_header,children:[a.jsx("p",{className:l.student_table_header_label,style:{flex:"1"},children:E??i("gr_no")}),a.jsx("p",{className:l.student_table_header_label,style:{flex:"3"},children:i("name")}),a.jsx("p",{className:l.student_table_header_label,style:{flex:"2"},children:i("contact_number")}),a.jsx("p",{className:l.student_table_header_label,style:{flex:"1"},children:i("applicable_outs")})]}),a.jsx(Z,{customStyle:{width:"100%"}}),h==null?void 0:h.map((s,p)=>(h==null?void 0:h.length)===p+1?a.jsx("div",{ref:J,children:a.jsx(H,{student:s,is_view:r,messageId:m,headId:x,carryParentState:g,instituteId:e})},s==null?void 0:s._id):a.jsx(H,{student:s,is_view:r,messageId:m,headId:x,carryParentState:g,instituteId:e},s==null?void 0:s._id)),!y&&!h.length&&a.jsx(he,{customStyleContainer:{marginTop:"9rem"},title:"No student found for this filter."}),y&&a.jsx(ie,{status:"white"})]}),K&&a.jsx(ge,{onClose:()=>D(!1),instituteId:e,setApplyFilter:C,applyFilter:N}),W&&a.jsx(de,{onClose:()=>R(!1),messageId:m,headId:x,viewAs:r,sendStudentList:X,toRedirectUrl:r==="FINANCE_MANAGER"?`/q/${o.username}/member/finance?a=student-message`:r==="ADMISSION_ADMIN"?`/q/${o.username}/member/admission?a=student-message`:r==="ID_CARD_SECTION"?`/q/${o.username}/member/idcard?a=student-message`:r==="CERTIFICATE_AUTHORITY"?`/q/${o.username}/member/certificate?a=student-message`:r==="STUDENT_SECTION"?`/q/${o.username}/member/promote?a=student-message`:`/q/${o.username}/student?a=student-message`,carryParentState:g,instituteId:e})]})};export{Ie as A};
