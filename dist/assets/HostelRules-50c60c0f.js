import{u as b,r as h,W as L,j as t,Q as I,c as B,S as J}from"./index-0ca76035.js";import{al as O,am as v,an as A}from"./hostel-api-9294ced1.js";import{B as U}from"./BorderBottom-1dc6f53e.js";import{s as j}from"./Hostel.module-50da11fe.js";import{P as $}from"./PopupWrapper-2578092d.js";import{s as D}from"./HostelFeeStructure.module-5a40a31e.js";import{J as Q}from"./JoinFormInput-82706177.js";import{J as W}from"./JoinFormTextArea-394bf055.js";import{J as q}from"./JoinFormFileEdit-10928ae7.js";import{O as G}from"./Overlay-c8100e0a.js";import{S as K}from"./SearchModalBackdrop-c4f123e6.js";import{s as k}from"./EditConfirm.module-344fbdb9.js";const H=({openAs:e,onClose:o,hid:_,openRuleMenu:i,onRefetch:p,onEdit:E})=>{const{t:n}=b(),[s,g]=h.useState({regulation_headline:e==="EDIT"?i==null?void 0:i.regulation_headline:"",regulation_description:e==="EDIT"?i==null?void 0:i.regulation_description:"",regulation_attachment:e==="EDIT"?i==null?void 0:i.regulation_attachment:""}),[f,a]=h.useState(""),[l,x]=h.useState(!1),[T]=O(),[y]=L();h.useEffect(()=>{e==="EDIT"&&g({regulation_headline:i==null?void 0:i.regulation_headline,regulation_description:i==null?void 0:i.regulation_description,regulation_attachment:i==null?void 0:i.regulation_attachment})},[e]);const S=c=>{g(m=>({...m,[c.target.name]:c.target.value}))},u=c=>{const m={};for(let r in c)r==="regulation_attachment"||r==="regulation_description"||c[r]||(m[r]=`${r} is required!`);return m},d=c=>{x(r=>!r);const m=new FormData;m.append("file",c.target.files[0]),y({fileUpload:m}).then(r=>{var F;(F=r.data)!=null&&F.imageKey&&g(w=>{var N;return{...w,regulation_attachment:(N=r.data)==null?void 0:N.imageKey}}),x(w=>!w)}).catch({})},C=()=>{const c=u(s);let m=!1;for(let r in c)if(r){m=!0;break}m?a(c):e==="EDIT"?E(s):(x(r=>!r),T({hid:_,addRules:{rules:[{headLine:s==null?void 0:s.regulation_headline,description:s==null?void 0:s.regulation_description,attach:s==null?void 0:s.regulation_attachment}]}}).then(()=>{p(),o(),x(r=>!r)}).catch({}))};return t.jsx($,{onClose:o,children:t.jsxs("div",{className:D.add_category_modal,children:[t.jsxs("div",{className:D.add_category_modal_title,children:[t.jsx("h6",{children:n(e==="EDIT"?"edit_rule":"add_new_rule")}),t.jsx("img",{src:"/images/close-post-icon.svg",onClick:o,alt:"close"})]}),t.jsx(Q,{labelText:n("rule_headline"),placeholder:n("rule_headline_placeholder"),name:"regulation_headline",value:s==null?void 0:s.regulation_headline,type:"text",onChange:S,errorShow:f.regulation_headline}),t.jsx(W,{labelText:n("rules_deacription"),placeholder:n("rules_deacription_placeholder"),name:"regulation_description",value:s.regulation_description,type:"text",onChange:S,customStyleContainer:{width:"100%"}}),t.jsx(q,{labelText:n("attach_rule_pdf"),name:"regulation_attachment",value:s.regulation_attachment,onChange:d,customStyleContainer:{width:"100%"}}),t.jsx("button",{className:D.set_fees_structure_btn,title:"Add Hostel Rules",onClick:C,style:{justifyContent:"center"},children:n(e==="EDIT"?"update":"add")}),l&&t.jsx(I,{})]})})},P=({onClose:e,openRuleMenu:o,onRefetch:_,hid:i})=>{const[p,E]=h.useState(!1),[n,s]=h.useState(!1),[g]=v(),f=a=>{s(l=>!l),E(l=>!l),g({hid:i,rid:o==null?void 0:o._id,editRules:{existing_rules:{headLine:a==null?void 0:a.regulation_headline,description:a==null?void 0:a.regulation_description,attach:a==null?void 0:a.regulation_attachment}}}).then(()=>{_(),E(l=>!l),e()}).catch({})};return t.jsx(t.Fragment,{children:n?t.jsx(H,{openRuleMenu:o,onEdit:f,openAs:"EDIT"}):t.jsxs(t.Fragment,{children:[t.jsx(K,{onClose:e}),t.jsxs(G,{customStyle:{zIndex:"1200"},children:[t.jsx("div",{className:k.edit_modal_container,style:{width:"200px"},children:t.jsx("h6",{className:k.edit,onClick:()=>s(a=>!a),children:"Edit"})}),p&&t.jsx(I,{})]})]})})},z=({rules:e,setOpenRuleMenu:o,viewAs:_})=>{const{t:i}=b();return t.jsxs("div",{className:j.rules_card,children:[t.jsxs("div",{className:j.rules_card_title,children:[t.jsx("h6",{children:e==null?void 0:e.regulation_headline}),_==="HOSTEL_SEARCH"?"":t.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:p=>o(e),className:j.menu_icon,title:"Menu"})]}),t.jsx("p",{children:e==null?void 0:e.regulation_description}),(e==null?void 0:e.regulation_attachment)&&t.jsx("a",{title:"Download Attachment",href:`https://d3dqpu54js2vfl.cloudfront.net/${e==null?void 0:e.regulation_attachment}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:t.jsx("span",{className:j.download_attachment,children:i("download_attachment")})})]})},ot=({hid:e,viewAs:o})=>{var y,S,u;const{t:_}=b(),i=B(),[p,E]=h.useState(!1),[n,s]=h.useState(""),[g,f]=h.useState(!0),{getHostelRules:a,getHostelRulesRefetch:l}=A({hid:e,skip:!e});h.useEffect(()=>{e&&(f(!0),l())},[e,l]),h.useEffect(()=>{var d,C,c;((d=a==null?void 0:a.one_hostel)!=null&&d.rules||((c=(C=a==null?void 0:a.one_hostel)==null?void 0:C.rules)==null?void 0:c.length)===0)&&f(!1)},[(y=a==null?void 0:a.one_hostel)==null?void 0:y.rules]);const x=()=>{E(d=>!d)},T=()=>{i(-1)};return t.jsxs(t.Fragment,{children:[o==="HOSTEL_SEARCH"?t.jsxs("div",{className:j.with_search,style:{justifyContent:"flex-start",gap:"1rem"},children:[t.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:T,alt:"go to previous tab",title:"Go Back",style:{cursor:"pointer"}}),t.jsx("h6",{children:_("hostel_rule_and_regulation")})]}):t.jsx("div",{className:j.with_search,children:t.jsx("h6",{children:_("hostel_rule_and_regulation")})}),t.jsx(U,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}}),o==="HOSTEL_SEARCH"?"":t.jsx("p",{className:j.add_new_category,onClick:x,children:_("create_new_rule")}),(u=(S=a==null?void 0:a.one_hostel)==null?void 0:S.rules)==null?void 0:u.map(d=>t.jsx(z,{rules:d,setOpenRuleMenu:s,viewAs:o},d==null?void 0:d._id)),g&&t.jsx(J,{}),p&&t.jsx(H,{onClose:x,hid:e,onRefetch:l}),n&&t.jsx(P,{onClose:()=>s(""),hid:e,onRefetch:l,openRuleMenu:n})]})};export{ot as H};
