import{r as d,lV as F,j as s,Q as W,u as D,a1 as E,kX as M,t as V,S as g,d as B}from"./index-731451a5.js";import{a7 as $,a8 as J}from"./department-api-a4f0b4b7.js";import{T as L}from"./TileWrapper-be9153cb.js";import{s as N}from"./EditConfirm.module-344fbdb9.js";import{S as P}from"./SearchModalBackdrop-5b309d60.js";import{O as G}from"./Overlay-07ce6f88.js";import{B as z}from"./BorderBottom-47800983.js";const U="_request_card_m2mis_1",X="_request_card_staff_m2mis_7",Y="_request_card_header_m2mis_18",H="_request_card_text_m2mis_25",Q="_request_card_inner_text_m2mis_38",Z="_btn_m2mis_55",I="_request_card_btn_group_m2mis_63",K="_accept_btn_m2mis_68",C="_reject_btn_m2mis_69",O="_viewAll_m2mis_86",v="_staff_card_m2mis_96",ss="_staff_card_info_m2mis_106",ts="_staff_card_info_inner_m2mis_118",es="_staff_card_info_inner_index_m2mis_126",as="_staff_card_overview_m2mis_132",ns="_staff_card_overview_inner_m2mis_140",rs="_staff_card_overview_inner_label_m2mis_146",_s="_staff_card_overview_inner_text_m2mis_153",m={request_card:U,request_card_staff:X,request_card_header:Y,request_card_text:H,request_card_inner_text:Q,btn:Z,request_card_btn_group:I,accept_btn:K,reject_btn:C,viewAll:O,staff_card:v,staff_card_info:ss,staff_card_info_inner:ts,staff_card_info_inner_index:es,staff_card_overview:as,staff_card_overview_inner:ns,staff_card_overview_inner_label:rs,staff_card_overview_inner_text:_s},is=({onClose:t,onRefetch:c,menu:n})=>{const[o,l]=d.useState(!1),[u]=F(),h=()=>{n!=null&&n._id&&(l(_=>!_),u({lid:n==null?void 0:n._id}).then(()=>{c(),t(),l(_=>!_)}).catch({}))};return s.jsxs(s.Fragment,{children:[s.jsx(P,{onClose:t}),s.jsxs(G,{customStyle:{zIndex:"1200"},children:[s.jsx("div",{className:N.edit_modal_container,style:{width:"200px"},children:s.jsx("h6",{className:N.remove,onClick:h,children:"Delete"})}),o&&s.jsx(W,{})]})]})},A=({leave:t,onRefetch:c,viewBy:n})=>{var f;const{t:o}=D(),[l,u]=d.useState("");t!=null&&t.reason.match(/[\s\S]{1,50}/g);const h=[],_=[],p=[],e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(f=t==null?void 0:t.date)==null||f.map(i=>{const a=i.split("/")[0],j=i.split("/")[1].split("")[0]==="0"?e[parseInt(i.split("/")[1],10)]:e[i.split("/")[1]],r=i.split("/")[2];h.push(a),_.push(j),p.push(r)}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:m.request_card_staff,children:[s.jsxs("div",{className:m.request_card_header,children:[s.jsxs("div",{className:m.request_card_text,children:[s.jsx("img",{src:"/images/members/transfer-icon.svg",alt:"icon"}),s.jsxs("div",{className:m.request_card_inner_text,children:[s.jsxs("h6",{style:{fontWeight:"400"},children:[o("leave_type")," "," : ",t==null?void 0:t.leave_type]}),s.jsxs("p",{children:[o("raised_on")," ",E(t==null?void 0:t.createdAt).format("LT"),","," ",E(t==null?void 0:t.createdAt).format("DD MMM yyyy")]}),s.jsxs("p",{children:[o("for_dates")," "," : ",[...new Set(h)].map(i=>`${i}, `),s.jsxs("span",{children:[[...new Set(_)].map(i=>`${i} `)," ",[...new Set(p)].map(i=>`${i} `)]})]})]})]}),s.jsx("div",{className:m.request_card_btn_group,children:n==="OVERVIEW"?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:m.btn,children:[o("status")," "," : ",s.jsx("span",{style:{color:(t==null?void 0:t.status)==="Request"?"rgba(18, 18, 18, 0.7)":(t==null?void 0:t.status)==="Rejected"?"red":"#14ab50"},children:t==null?void 0:t.status})]}),s.jsx("img",{className:m.dots,src:"/images/menu-dots-icon.svg",alt:"",onClick:()=>u(t),style:{cursor:"pointer"}})]})})]}),s.jsx("div",{className:m.request_card_inner_text,style:{marginTop:"0.5rem"},children:s.jsxs("h6",{style:{fontWeight:"400",whiteSpace:"break-spaces"},children:[o("reason")," "," : ",t==null?void 0:t.reason]})}),(t==null?void 0:t.attach)&&s.jsx("div",{className:m.request_card_inner_text,style:{marginTop:"0.5rem"},children:s.jsxs("h6",{style:{fontWeight:"400",whiteSpace:"break-spaces"},children:[o("attachment")," "," : ",s.jsx("a",{href:`${M}/${t==null?void 0:t.attach}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:s.jsx("span",{className:m.viewAll,children:o("view_attachment")})})]})})]}),l&&s.jsx(is,{menu:l,onClose:()=>u(""),onRefetch:c})]})},cs=({staffId:t,categoryKey:c})=>{const[n,o]=V(),[l,u]=d.useState(1),[h,_]=d.useState(!0),[p,e]=d.useState(!0),[f,i]=d.useState([]),{getLeaveOverviewIssue:a,getLeaveOverviewIssueRefetch:j}=$({data:{sid:t,page:l,limit:10,category:c==="All Leave"?"":c},skip:c?!t:!c});return d.useEffect(()=>{t&&(e(!0),j())},[t,c,l,j]),d.useEffect(()=>{o&&h&&u(r=>r+1)},[o,h]),d.useEffect(()=>{var r,y;a!=null&&a.all_leave?l===1?(i(a==null?void 0:a.all_leave),e(!1)):(i(S=>[...new Set([...S,...a==null?void 0:a.all_leave].map(JSON.stringify))].map(JSON.parse)),e(!1)):((r=a==null?void 0:a.all_leave)==null?void 0:r.length)===0&&e(!1),((y=a==null?void 0:a.all_leave)==null?void 0:y.length)===10?_(!0):_(!1)},[a==null?void 0:a.all_leave]),s.jsxs(s.Fragment,{children:[s.jsx(z,{customStyle:{width:"100%",marginTop:"0.9rem"}}),s.jsx("div",{className:m.request_card_inner_text,style:{marginTop:"0.5rem"},children:s.jsx("h6",{children:c??""})}),f==null?void 0:f.map((r,y)=>(f==null?void 0:f.length)===y+1?s.jsx("div",{ref:n,children:s.jsx(A,{leave:r,viewBy:"OVERVIEW"})},r==null?void 0:r._id):s.jsx(A,{leave:r,viewBy:"OVERVIEW"},r==null?void 0:r._id)),p&&s.jsx(g,{})]})},R=[{name:"all",key:"All Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"casual_leave",key:"Casual Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"medical_leave",key:"Medical Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"sick_leave",key:"Sick Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"compensation_off_leave",key:"Compensation Off Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"on_duty_leave",key:"On Duty Leave",isAvaiable:!0,count:0,mode:"FILTER"},{name:"leave_without_pay",key:"Leave Without Pay",isAvaiable:!0,count:0,mode:"FILTER"}];function ps({staffId:t}){var a,j,r,y;const{t:c}=D(),n=B(),[o,l]=d.useState(!0),[u,h]=d.useState(R),[_,p]=d.useState(""),{getLeaveOverviewCount:e,getLeaveOverviewCountRefetch:f}=J({data:{sid:t},skip:!t});d.useEffect(()=>{t&&(l(!0),f())},[t,f]),d.useEffect(()=>{var S,b,q,k,w,T;if(e!=null&&e.overview){let x=R;x[0].count=(S=e==null?void 0:e.overview)==null?void 0:S.casual_leave,x[1].count=(b=e==null?void 0:e.overview)==null?void 0:b.medical_leave,x[2].count=(q=e==null?void 0:e.overview)==null?void 0:q.sick_leave,x[3].count=(k=e==null?void 0:e.overview)==null?void 0:k.c_off_leave,x[4].count=(w=e==null?void 0:e.overview)==null?void 0:w.off_duty_leave,x[5].count=(T=e==null?void 0:e.overview)==null?void 0:T.lwp_leave,h(x),n.state.isCategory?p({key:n.state.isCategory}):p(x[0]),l(!1)}},[e==null?void 0:e.overview]);const i=S=>{p(S)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:m.request_card_inner_text,style:{marginTop:"0.5rem"},children:[(a=n==null?void 0:n.state)!=null&&a.staffName?s.jsxs("h6",{style:{fontWeight:"400"},children:[c("name")," "," : ",(j=n==null?void 0:n.state)==null?void 0:j.staffName]}):null,s.jsxs("h6",{style:{fontWeight:"400"},children:[c("total_leave_available")," "," : ",(r=e==null?void 0:e.overview)==null?void 0:r.total_leave_available]}),s.jsxs("h6",{style:{fontWeight:"400"},children:[c("total_leave_taken")," "," : ",(y=e==null?void 0:e.overview)==null?void 0:y.total_leave_taken]})]}),s.jsx(L,{labelText:"",tileList:u,activeTile:_==null?void 0:_.key,onParentTile:i,customTileContainer:{flexWrap:"wrap"}}),s.jsx(cs,{categoryKey:_==null?void 0:_.key,staffId:t}),o&&s.jsx(g,{})]})}export{A as S,ps as a,m as s};
