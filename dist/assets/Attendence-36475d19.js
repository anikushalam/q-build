import{r as L,j as e,e as V,R as v,am as ge,k as re,u as ue,Q as $e,S as pe}from"./index-0ca76035.js";import{a as we,b as Me,c as Se}from"./attendance-api-9d8aa2ad.js";import{b as Fe}from"./institute-staff-student-api-7114d611.js";import{D as De}from"./Divider-2f807990.js";const Ie="_attendence_ws4c1_1",Le="_attendencehead_ws4c1_13",Re="_attendenceBtns_ws4c1_17",ke="_changemonth_ws4c1_21",Ce="_buttons_ws4c1_41",Ee="_leaves_ws4c1_46",Oe="_save_ws4c1_57",Ye="_calender_ws4c1_71",Te="_arrowbtn_ws4c1_78",Je="_dates_ws4c1_86",Ue="_date_ws4c1_86",ze="_clickedDate_ws4c1_127",Be="_tabs_ws4c1_152",Qe="_tab_ws4c1_152",We="_grey_ws4c1_173",He="_purple_ws4c1_176",Ve="_light_ws4c1_181",qe="_tabgreen_ws4c1_184",Ge="_red_ws4c1_188",Ke="_rose_ws4c1_193",Xe="_list_ws4c1_202",Ze="_divider_ws4c1_208",Pe="_selectMonthList_ws4c1_213",ye="_month_ws4c1_228",c={attendence:Ie,attendencehead:Le,attendenceBtns:Re,changemonth:ke,buttons:Ce,leaves:Ee,save:Oe,calender:Ye,arrowbtn:Te,dates:Je,date:Ue,clickedDate:ze,tabs:Be,tab:Qe,grey:We,purple:He,light:Ve,tabgreen:qe,red:Ge,rose:Ke,list:Xe,divider:Ze,selectMonthList:Pe,month:ye},Ae=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],fe=["January","February","March","April","May","June","July","August","September","October","November","December"],es=(s=Ae,h=fe)=>{const g=new Date,N=`${g.getDate()}-${g.getMonth()+1}-${g.getFullYear()}`,$=[1,2,3,4,5,6,0],[r,l]=L.useState(g),w=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),b=new Date(r.getFullYear(),r.getMonth(),1).getDay(),p=$.indexOf(b)+1;let i=1;const R=6,M=7,o={},k=[];for(let t=1;t<R+1;t++){for(let j=1;j<M+1;j++)o[t]||(o[t]=[]),t===1?j<p||(o[t]=[...o[t],{classes:"",date:`${i}-${r.getMonth()+1}-${r.getFullYear()}`,value:i}],i++):t>1&&i<w+1&&(o[t]=[...o[t],{classes:"",date:`${i}-${r.getMonth()+1}-${r.getFullYear()}`,value:i}],i++);o[t].map(j=>{const C=j.date.split("-")[0],u=new Date(r.getFullYear(),r.getMonth(),C).getDay();return k.push({date:j.date,day:u}),""})}return{daysShort:s,monthNames:h,todayFormatted:N,calendarData:k,selectedDate:r,getPrevMonth:()=>{l(t=>new Date(t.getFullYear(),t.getMonth()-1,1))},getNextMonth:()=>{l(t=>new Date(t.getFullYear(),t.getMonth()+1,1))},switchMonth:t=>{l(j=>new Date(j.getFullYear(),j.getMonth()+(t-r.getMonth()),1))}}},ss="_listItem_mcpd8_1",ts="_listItemLeft_mcpd8_8",ns="_listItemRight_mcpd8_30",S={listItem:ss,listItemLeft:ts,listItemRight:ns};function H({staff:s,status:h}){var g;return e.jsxs("div",{className:S.listItem,children:[e.jsxs("div",{className:S.listItemLeft,children:[e.jsxs("p",{children:[s==null?void 0:s.staffROLLNO,"."]}),e.jsx("img",{src:(s==null?void 0:s.photoId)!=="1"?`${V}/${s==null?void 0:s.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",loading:"lazy",alt:""}),e.jsx("p",{children:`${s==null?void 0:s.staffFirstName} ${s!=null&&s.staffMiddleName?s==null?void 0:s.staffMiddleName:""} ${s==null?void 0:s.staffLastName}`})]}),e.jsx("div",{className:S.listItemRight,children:(g=s==null?void 0:s.staffLeave)!=null&&g.length?e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""}):h==="present"?e.jsx("img",{src:"/images/members/radio-btn-green.svg",alt:""}):h==="absent"?e.jsx("img",{src:"/images/members/radio-btn-red.svg",alt:""}):e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""})})]})}function me({staff:s,status:h,presentTabHandler:g}){var p;const[N,$]=v.useState(h),[r,l]=v.useState(!1),[m,w]=v.useState(""),b=()=>{var i;(i=s==null?void 0:s.staffLeave)!=null&&i.length?(w("You can not mark attendence untill its granted leave over"),l(!0)):h==="present"||(N==="present"?($(""),g(s._id)):($("present"),g(s._id)))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S.listItem,onClick:b,children:[e.jsxs("div",{className:S.listItemLeft,children:[e.jsxs("p",{children:[s==null?void 0:s.staffROLLNO,"."]}),e.jsx("img",{src:(s==null?void 0:s.photoId)!=="1"?`${V}/${s==null?void 0:s.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",loading:"lazy",alt:""}),e.jsx("p",{children:`${s==null?void 0:s.staffFirstName} ${s.staffMiddleName?s.staffMiddleName:""} ${s==null?void 0:s.staffLastName}`})]}),e.jsx("div",{className:S.listItemRight,children:(p=s==null?void 0:s.staffLeave)!=null&&p.length?e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""}):N==="present"?e.jsx("img",{src:"/images/members/radio-btn-green.svg",alt:""}):e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""})})]}),e.jsx(ge,{msg:m,run:r,setRun:l})]})}function he({staff:s,status:h,absentTabHandler:g}){var p;const[N,$]=v.useState(h),[r,l]=v.useState(!1),[m,w]=v.useState(""),b=()=>{var i;(i=s==null?void 0:s.staffLeave)!=null&&i.length?(w("You can not mark attendence untill its granted leave over"),l(!0)):h==="absent"||(N==="absent"?($(""),g(s._id)):($("absent"),g(s._id)))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S.listItem,onClick:()=>b(s._id),children:[e.jsxs("div",{className:S.listItemLeft,children:[e.jsxs("p",{children:[s==null?void 0:s.staffROLLNO,"."]}),e.jsx("img",{src:(s==null?void 0:s.photoId)!=="1"?`${V}/${s==null?void 0:s.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:"",loading:"lazy"}),e.jsx("p",{children:`${s==null?void 0:s.staffFirstName} ${s.staffMiddleName?s.staffMiddleName:""} ${s==null?void 0:s.staffLastName}`})]}),e.jsx("div",{className:S.listItemRight,children:(p=s==null?void 0:s.staffLeave)!=null&&p.length?e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""}):N==="absent"?e.jsx("img",{src:"/images/members/radio-btn-red.svg",alt:""}):e.jsx("img",{src:"/images/members/radio-btn.svg",alt:""})})]}),e.jsx(ge,{msg:m,run:r,setRun:l})]})}const cs=({today:s,alreadyMark:h,allIdsArray:g,allAttendanceRefetch:N,clickedIndex:$,setClickedIndex:r,idPresentArray:l,idAbsentArray:m,setIdPresentArray:w,setIdAbsentArray:b})=>{const[p,i]=v.useState(!1),[R,M]=v.useState(!1),o=re(t=>t.idChange),[k]=we(),[T]=Me();v.useEffect(()=>{l!=null&&l.length||m!=null&&m.length?i(!0):i(!1)},[l,m]);const d=()=>{M(u=>!u);const t=s.split("-"),j=t[0]>9?t[0]:`0${t[0]}`,C=t[1]>9?t[1]:`0${t[1]}`;if(h!=null&&h._id)T({said:h==null?void 0:h._id,payload:{date:`${j}/${C}/${t[2]}`,present:l!=null&&l.length?l:[],absent:m!=null&&m.length?m:[]}}).then(()=>{N(),r(0),M(u=>!u),w([]),b([])}).catch(()=>M(u=>!u));else{const u=[];g==null||g.map(_=>u.push(_._id));const U=[],E=[];if(l!=null&&l.length)for(let _ of u)l!=null&&l.includes(_)||E.push(_);else for(let _ of u)m!=null&&m.includes(_)||U.push(_);k({id:o==null?void 0:o.id,payload:{date:`${j}/${C}/${t[2]}`,present:l!=null&&l.length?l:U,absent:m!=null&&m.length?m:E}}).then(()=>{N(),r(0),M(_=>!_),w([]),b([])}).catch(()=>M(_=>!_))}},{t:J}=ue();return e.jsxs("div",{className:c.buttons,children:[$!==0?p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:c.leaves,children:"Holiday"}),e.jsx("div",{className:c.save,onClick:d,children:J("save")})]}):"",R&&e.jsx($e,{})]})};function ds({instituteId:s,viewBy:h}){var f,ee,se,te,ne,ce,le,ae;const{calendarData:g,selectedDate:N,todayFormatted:$,switchMonth:r,monthNames:l,getNextMonth:m,getPrevMonth:w}=es(),[b,p]=L.useState($),i=b.split("-"),R=i[0]>9?i[0]:`0${i[0]}`,M=i[1]>9?i[1]:`0${i[1]}`,o=re(n=>n.idChange),[k,T]=L.useState(!0),{approveStaffList:d,approveStaffListRefetch:J}=Fe({data:{id:s||(o==null?void 0:o.id),page:"",limit:"",date:`${R}/${M}/${i[2]}`},skip:s?!s:!(o!=null&&o.id)}),{allAttendance:t,allAttendanceRefetch:j}=Se({id:s||(o==null?void 0:o.id),date:`${R}/${M}/${i[2]}`}),C=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=10,U=Math.floor(g.map(function(n){return n.date}).indexOf(b)/u),[E,_]=L.useState(U),q=E*u,G=Math.ceil(g.length/u),_e=g.slice(q,q+u).map((n,a)=>e.jsxs("div",{className:n.date===b?`${c.date} ${c.clickedDate}`:c.date,onClick:()=>p(n.date),children:[e.jsx("h6",{children:n.date.split("-")[0]}),e.jsx("p",{children:C[n.day]})]},a)),xe=()=>{E+1<G?_(n=>n+1):(_(0),m())},je=()=>{E>0?_(n=>n-1):(_(G-1),w())},[F,z]=L.useState(0),[O,ve]=L.useState([]),[Y,Ne]=L.useState([]),[K,B]=v.useState([]),[X,Q]=v.useState([]),[Z,P]=L.useState(!1),be=["January","February","March","April","May","June","July","August","September","October","November","December"];v.useEffect(()=>{(o!=null&&o.id||s)&&(T(!0),J())},[o==null?void 0:o.id,s,J]),v.useEffect(()=>{var n;(n=d==null?void 0:d.staffIns)!=null&&n.length&&(ve(d==null?void 0:d.staffIns),Ne(d==null?void 0:d.staffIns),T(!1))},[d==null?void 0:d.staffIns]),v.useEffect(()=>{B([]),Q([])},[F]);const y=n=>{if(h!=="LEAVE_AND_TRANSFER"){const a=[...K];if(a!=null&&a.includes(n)){const x=a.indexOf(n);a.splice(x,1),B(()=>[...a])}else B(x=>[...x,n])}},A=n=>{if(h!=="LEAVE_AND_TRANSFER"){const a=[...X];if(a!=null&&a.includes(n)){const x=a.indexOf(n);a.splice(x,1),Q(()=>[...a])}else Q(x=>[...x,n])}},{t:W}=ue();return e.jsxs("div",{className:c.attendence,children:[e.jsxs("div",{className:c.attendencehead,children:[e.jsxs("div",{className:c.attendenceBtns,children:[e.jsxs("div",{className:c.changemonth,onClick:()=>P(!Z),children:[e.jsxs("h6",{children:[l[N.getMonth()]," ",N.getFullYear()]}),e.jsx("img",{alt:"not found",src:"/images/dropdown-icon.svg"}),Z&&e.jsx("div",{className:c.selectMonthList,children:be.map((n,a)=>e.jsx("div",{className:c.month,onClick:()=>{r(a),P(!1)},children:n},a))})]}),h==="LEAVE_AND_TRANSFER"?e.jsx(cs,{alreadyMark:(ee=(f=t==null?void 0:t.institute)==null?void 0:f.staffAttendance)==null?void 0:ee[0],today:b,allIdsArray:d==null?void 0:d.staffIns,allAttendanceRefetch:j,clickedIndex:F,setClickedIndex:z,idPresentArray:K,idAbsentArray:X,setIdPresentArray:B,setIdAbsentArray:Q}):null]}),e.jsxs("div",{className:c.calender,children:[e.jsx("div",{className:c.arrowbtn,onClick:je,children:e.jsx("img",{alt:"not found",src:"/images/members/left-icon.svg"})}),e.jsx("div",{className:c.dates,children:_e}),e.jsx("div",{className:c.arrowbtn,onClick:xe,children:e.jsx("img",{alt:"not found",src:"/images/members/right-icon.svg"})})]})]}),e.jsx(De,{}),e.jsxs("div",{className:c.tabs,children:[e.jsxs("div",{className:F===0?`${c.tab} ${c.purple}`:`${c.tab} ${c.grey}`,onClick:()=>z(0),children:[W("total")," ",(se=d==null?void 0:d.staffIns)==null?void 0:se.length]}),e.jsxs("div",{className:F===1?`${c.tab} ${c.tabgreen}`:`${c.tab} ${c.light}`,onClick:()=>z(1),children:[W("present")," ",(ne=(te=t==null?void 0:t.institute)==null?void 0:te.staffAttendance[0])==null?void 0:ne.presentTotal]}),e.jsxs("div",{className:F===2?`${c.tab} ${c.red}`:`${c.tab} ${c.rose}`,onClick:()=>z(2),children:[W("absent")," ",(le=(ce=t==null?void 0:t.institute)==null?void 0:ce.staffAttendance[0])==null?void 0:le.absentTotal]})]}),e.jsxs("div",{className:c.list,children:[F===0&&((ae=d==null?void 0:d.staffIns)==null?void 0:ae.map((n,a)=>{var x,D,I,oe,ie,de;return(I=(D=(x=t==null?void 0:t.institute)==null?void 0:x.staffAttendance[0])==null?void 0:D.presentStaff)!=null&&I.includes(n._id)?e.jsxs(e.Fragment,{children:[e.jsx(H,{staff:n,status:"present"},a),e.jsx("div",{className:c.divider})]}):(de=(ie=(oe=t==null?void 0:t.institute)==null?void 0:oe.staffAttendance[0])==null?void 0:ie.absentStaff)!=null&&de.includes(n._id)?e.jsxs(e.Fragment,{children:[e.jsx(H,{staff:n,status:"absent"},a),e.jsx("div",{className:c.divider})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{staff:n,status:"initial"},a),e.jsx("div",{className:c.divider})]})})),F===1&&(O==null?void 0:O.length)>0&&(O==null?void 0:O.map((n,a)=>{var x,D,I;return(I=(D=(x=t==null?void 0:t.institute)==null?void 0:x.staffAttendance[0])==null?void 0:D.presentStaff)!=null&&I.includes(n._id)?e.jsxs(e.Fragment,{children:[e.jsx(me,{staff:n,status:"present",presentTabHandler:y},a),e.jsx("div",{className:c.divider})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{staff:n,presentTabHandler:y,status:"absent"},a),e.jsx("div",{className:c.divider})]})})),F===2&&(Y==null?void 0:Y.length)>0&&(Y==null?void 0:Y.map((n,a)=>{var x,D,I;return(I=(D=(x=t==null?void 0:t.institute)==null?void 0:x.staffAttendance[0])==null?void 0:D.absentStaff)!=null&&I.includes(n._id)?e.jsxs(e.Fragment,{children:[e.jsx(he,{staff:n,status:"absent",absentTabHandler:A},a),e.jsx("div",{className:c.divider})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{staff:n,status:"present",absentTabHandler:A},a),e.jsx("div",{className:c.divider})]})}))]}),k&&e.jsx(pe,{})]})}export{ds as default};
