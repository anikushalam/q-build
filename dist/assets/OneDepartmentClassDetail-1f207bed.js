import{u as A,d as Es,n as Ls,j as s,L as ls,R as B,r as N,g as Os,Q as Ms,N as ws,lx as Fs,k as Hs,b as Us}from"./index-0ca76035.js";import{s as _}from"./Tabs.module-5d07bc0d.js";import{s as ds}from"./PromoteDepartment.module-1bdd3b1d.js";import{E as Bs,I as Js}from"./InstituteClassStudentList-e122f8e3.js";import{S as Qs,A as Vs}from"./SubjectMarks-16511174.js";import{I as X,a as ns,b as is,s as v,C as P,A as zs,c as Gs,S as Ws,d as Ys,e as Ks}from"./McqWrapper-c0d8189f.js";import{s as a,u as Xs}from"./Attendence.module-1983200c.js";import{n as Zs,o as Ps,u as ys,p as As}from"./class-api-bd140bb6.js";import{D as se}from"./Divider-2f807990.js";import{D as y}from"./DepartmentTabChangeLink-a4183fdb.js";import{A as ee}from"./Academics-14049141.js";import{A as te}from"./AcademicDetail-e9069d1f.js";function ae({carryParentState:i}){var b,t,c;const{t:m}=A(),j=Es(),g=Ls();return s.jsx("div",{className:_.mcqTop,style:{padding:"0"},children:s.jsxs("div",{className:_.mcqToptabs,children:[s.jsx(ls,{to:`/q/${g.username}/member/department/${g.deptname}?a=class-detail`,state:i,className:((b=j.search)==null?void 0:b.substring(3))==="class-detail"?`${_.mcqTopItem} ${_.active}`:_.mcqTopItem,children:s.jsx("div",{children:m("students")})}),s.jsx(ls,{to:`/q/${g.username}/member/department/${g.deptname}?a=class-attendance`,state:i,className:((t=j.search)==null?void 0:t.substring(3))==="class-attendance"?`${_.mcqTopItem} ${_.active}`:_.mcqTopItem,children:s.jsx("div",{children:m("attendance")})}),s.jsx(ls,{to:`/q/${g.username}/member/department/${g.deptname}?a=class-subject`,state:i,className:((c=j.search)==null?void 0:c.substring(3))==="class-subject"?`${_.mcqTopItem} ${_.active}`:_.mcqTopItem,children:s.jsx("div",{children:m("subjects")})})]})})}const ce=({today:i,alreadyMark:m,allIdsArray:j,clickedIndex:g,setClickedIndex:b,idPresentArray:t,idAbsentArray:c,setIdPresentArray:M,setIdAbsentArray:w,cid:T,isDepartment:$,className:J,setIsRefetch:r})=>{const[Q,H]=B.useState(!1),[k,f]=B.useState(!1),[l]=Zs(),[V]=Ps(),{t:U}=A(),[q,o]=N.useState(!1),R=Os(),[d,F]=N.useState({msg:"",run:!1});B.useEffect(()=>{t!=null&&t.length||c!=null&&c.length?H(!0):H(!1)},[t,c]);const z=()=>{f(S=>!S);const p=i.split("-"),L=p[0]>9?p[0]:`0${p[0]}`,E=p[1]>9?p[1]:`0${p[1]}`;if(m!=null&&m._id)R(Fs.updateClassAttendance({clsId:T,ldate:`${L}/${E}/${p[2]}`,presentStudent:t!=null&&t.length?t:[],absentStudent:c!=null&&c.length?c:[],alreadyMark:m==null?void 0:m._id})),V({said:m==null?void 0:m._id,attendanceUpdate:{date:`${L}/${E}/${p[2]}`,present:t!=null&&t.length?t:[],absent:c!=null&&c.length?c:[]}}).then(()=>{r(!0),b(0),f(S=>!S),M([]),w([])}).catch({});else{const S=[];j==null||j.map(h=>S.push(h._id));const G=[],Z=[];if(t!=null&&t.length)for(let h of S)t!=null&&t.includes(h)||Z.push(h);else for(let h of S)c!=null&&c.includes(h)||G.push(h);l({cid:T,attendance:{date:`${L}/${E}/${p[2]}`,present:t!=null&&t.length?t:G,absent:c!=null&&c.length?c:Z}}).then(h=>{var ss,I;((ss=h==null?void 0:h.data)==null?void 0:ss.message)==="Today will be holiday Provided by department Admin or already marked attendance"?F({msg:"Today will be holiday Provided by department Admin or already marked attendance",run:!0}):R(Fs.addClassAttendance({clsId:T,ldate:`${L}/${E}/${p[2]}`,presentStudent:t!=null&&t.length?t:G,absentStudent:c!=null&&c.length?c:Z,alreadyMark:(I=h==null?void 0:h.data)==null?void 0:I.alreadyMark})),b(0),f(W=>!W),M([]),w([])}).catch({})}},C=()=>{o(p=>!p)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"1.5rem"},children:[s.jsx("div",{className:a.buttons,children:s.jsx("div",{className:a.save,onClick:C,children:U("export_zip_attendance")})}),s.jsx("div",{className:a.buttons,children:g!==0?Q&&!$&&s.jsx(s.Fragment,{children:s.jsx("div",{className:a.save,onClick:z,children:U("save")})}):""})]}),k&&s.jsx(Ms,{}),q&&s.jsx(Bs,{cid:T,onClose:C,className:J}),d.run&&s.jsx(ws,{msg:d.msg,run:d.run,setRun:()=>F({msg:"",run:!1}),postiton:"bottom",type:"error"})]})};function ne({cid:i,isDepartment:m,className:j}){var hs,xs,gs,ps,bs,vs,rs,fs,Ns,$s,Is,Ds;const{calendarData:g,selectedDate:b,todayFormatted:t,switchMonth:c,monthNames:M,getNextMonth:w,getPrevMonth:T}=Xs(),[$,J]=N.useState(t),r=$.split("-"),Q=r[0]>9?r[0]:`0${r[0]}`,H=r[1]>9?r[1]:`0${r[1]}`,{t:k}=A(),f=Hs(e=>e.attendanceStore.classTeacher),[l,V]=N.useState(""),[U,q]=N.useState(!1),{classAllStudent:o,classAllStudentRefetch:R}=ys({data:{cid:i,page:1,limit:30},skip:!i}),{classStudentCurrentAttendance:d,classStudentCurrentAttendanceRefetch:F}=As({cid:i,date:`${Q}/${H}/${r[2]}`});N.useEffect(()=>{if((f==null?void 0:f.length)>0){const e=$.split("-"),n=e[0]>9?e[0]:`0${e[0]}`,u=e[1]>9?e[1]:`0${e[1]}`;let D="";for(let x of f)if((x==null?void 0:x.ldate)===`${n}/${u}/${e[2]}`)if((x==null?void 0:x.clsId)===i){D=x;break}else q(!1);else q(!1);V(D)}},[f,$,i,U]),N.useEffect(()=>{i&&(R(),F())},[i,F,R]);const z=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],C=10,p=Math.floor(g.map(function(e){return e.date}).indexOf($)/C),[L,E]=N.useState(p),S=L*C,G=Math.ceil(g.length/C),Z=g.slice(S,S+C).map((e,n)=>s.jsxs("div",{className:e.date===$?`${a.date} ${a.clickedDate}`:a.date,onClick:()=>J(e.date),children:[s.jsx("h6",{children:e.date.split("-")[0]}),s.jsx("p",{children:z[e.day]})]},n)),h=()=>{L+1<G?E(e=>e+1):(E(0),w())},ss=()=>{L>0?E(e=>e-1):(E(G-1),T())},[I,W]=N.useState(0),[Y,ks]=N.useState([]),[K,qs]=N.useState([]),[ms,es]=B.useState([]),[os,ts]=B.useState([]),[js,us]=N.useState(!1),Rs=["January","February","March","April","May","June","July","August","September","October","November","December"];B.useEffect(()=>{var e,n;ks((e=o==null?void 0:o.classes)==null?void 0:e.ApproveStudent),qs((n=o==null?void 0:o.classes)==null?void 0:n.ApproveStudent)},[(hs=o==null?void 0:o.classes)==null?void 0:hs.ApproveStudent]),B.useEffect(()=>{es([]),ts([])},[I]);const as=e=>{const n=[...ms];if(n!=null&&n.includes(e)){const u=n.indexOf(e);n.splice(u,1),es(()=>[...n])}else es(u=>[...u,e])},cs=e=>{const n=[...os];if(n!=null&&n.includes(e)){const u=n.indexOf(e);n.splice(u,1),ts(()=>[...n])}else ts(u=>[...u,e])};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:a.attendence,style:{border:m?"none":"0.5px solid #cacaca"},children:[s.jsxs("div",{className:a.attendencehead,children:[s.jsxs("div",{className:a.attendenceBtns,children:[s.jsxs("div",{className:a.changemonth,onClick:()=>us(!js),children:[s.jsxs("h6",{children:[M[b.getMonth()]," ",b.getFullYear()]}),s.jsx("img",{alt:"not found",src:"/images/dropdown-icon.svg"}),js&&s.jsx("div",{className:a.selectMonthList,children:Rs.map((e,n)=>s.jsx("div",{className:a.month,onClick:()=>{c(n),us(!1)},children:e},n))})]}),s.jsx(ce,{alreadyMark:l?{_id:l==null?void 0:l.alreadyMark}:(gs=(xs=d==null?void 0:d.classes)==null?void 0:xs.attendenceDate)==null?void 0:gs[0],today:$,allIdsArray:(ps=o==null?void 0:o.classes)==null?void 0:ps.ApproveStudent,classStudentCurrentAttendanceRefetch:F,clickedIndex:I,setClickedIndex:W,idPresentArray:ms,idAbsentArray:os,setIdPresentArray:es,setIdAbsentArray:ts,cid:i,isDepartment:m,className:j,setIsRefetch:q})]}),s.jsxs("div",{className:a.calender,children:[s.jsx("div",{className:a.arrowbtn,onClick:ss,children:s.jsx("img",{alt:"not found",src:"/images/members/left-icon.svg"})}),s.jsx("div",{className:a.dates,children:Z}),s.jsx("div",{className:a.arrowbtn,onClick:h,children:s.jsx("img",{alt:"not found",src:"/images/members/right-icon.svg"})})]})]}),s.jsx(se,{}),s.jsxs("div",{className:a.tabs,children:[s.jsxs("div",{className:I===0?`${a.tab} ${a.purple}`:`${a.tab} ${a.grey}`,onClick:()=>W(0),children:[k("total")," ",(vs=(bs=o==null?void 0:o.classes)==null?void 0:bs.ApproveStudent)==null?void 0:vs.length]}),s.jsxs("div",{className:I===1?`${a.tab} ${a.tabgreen}`:`${a.tab} ${a.light}`,onClick:()=>W(1),children:[k("present")," ",l?(l==null?void 0:l.presentCount)??0:(fs=(rs=d==null?void 0:d.classes)==null?void 0:rs.attendenceDate[0])==null?void 0:fs.presentTotal]}),s.jsxs("div",{className:I===2?`${a.tab} ${a.red}`:`${a.tab} ${a.rose}`,onClick:()=>W(2),children:[k("absent")," ",l?(l==null?void 0:l.absentCount)??0:($s=(Ns=d==null?void 0:d.classes)==null?void 0:Ns.attendenceDate[0])==null?void 0:$s.absentTotal]})]}),s.jsxs("div",{className:a.list,children:[I===0&&((Ds=(Is=o==null?void 0:o.classes)==null?void 0:Is.ApproveStudent)==null?void 0:Ds.map((e,n)=>{var u,D,x,O,_s,Cs,Ss,Ts;return l?(u=l==null?void 0:l.presentStudent)!=null&&u.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"present"},n),s.jsx("div",{className:a.divider})]}):(D=l==null?void 0:l.absentStudent)!=null&&D.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"absent"},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"initial"},n),s.jsx("div",{className:a.divider})]}):(_s=(O=(x=d==null?void 0:d.classes)==null?void 0:x.attendenceDate[0])==null?void 0:O.presentStudent)!=null&&_s.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"present"},n),s.jsx("div",{className:a.divider})]}):(Ts=(Ss=(Cs=d==null?void 0:d.classes)==null?void 0:Cs.attendenceDate[0])==null?void 0:Ss.absentStudent)!=null&&Ts.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"absent"},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(X,{student:e,status:"initial"},n),s.jsx("div",{className:a.divider})]})})),I===1&&(Y==null?void 0:Y.length)>0&&(Y==null?void 0:Y.map((e,n)=>{var u,D,x,O;return l?(u=l==null?void 0:l.presentStudent)!=null&&u.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(ns,{student:e,status:"present",presentTabHandler:as},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(ns,{student:e,presentTabHandler:as,status:"absent"},n),s.jsx("div",{className:a.divider})]}):(O=(x=(D=d==null?void 0:d.classes)==null?void 0:D.attendenceDate[0])==null?void 0:x.presentStudent)!=null&&O.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(ns,{student:e,status:"present",presentTabHandler:as},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(ns,{student:e,presentTabHandler:as,status:"absent"},n),s.jsx("div",{className:a.divider})]})})),I===2&&(K==null?void 0:K.length)>0&&(K==null?void 0:K.map((e,n)=>{var u,D,x,O;return l?(u=l==null?void 0:l.absentStudent)!=null&&u.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(is,{student:e,status:"absent",absentTabHandler:cs},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(is,{student:e,status:"present",absentTabHandler:cs},n),s.jsx("div",{className:a.divider})]}):(O=(x=(D=d==null?void 0:d.classes)==null?void 0:D.attendenceDate[0])==null?void 0:x.absentStudent)!=null&&O.includes(e._id)?s.jsxs(s.Fragment,{children:[s.jsx(is,{student:e,status:"absent",absentTabHandler:cs},n),s.jsx("div",{className:a.divider})]}):s.jsxs(s.Fragment,{children:[s.jsx(is,{student:e,status:"present",absentTabHandler:cs},n),s.jsx("div",{className:a.divider})]})}))]})]})})}const ie=({carryParentState:i,isDepartment:m})=>{const{t:j}=A();return s.jsx(s.Fragment,{children:s.jsx("div",{className:v.MiddleContentLeft,style:{border:"none"},children:m==="CLASS_TEACHER"?s.jsxs("div",{className:v.item,style:{paddingLeft:"2vw"},children:[s.jsx(P,{carryParentState:i,activeTab:"subject-catalog",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/class/class-catalog-icon.svg",alt:"Class Catalog"}),s.jsx("p",{children:j("catalog")})]})}),s.jsx(P,{carryParentState:i,activeTab:"subject-attendance",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/class/class-attendance-icon.svg",alt:"attendence"}),s.jsxs("p",{children:[" ",j("attendance")," "]})]})}),s.jsx(P,{carryParentState:i,activeTab:"subject-assignment",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/subject/subject-assignment-icon.svg",alt:"assignment"}),s.jsx("p",{children:j("assigmnent")})]})}),s.jsx(P,{carryParentState:i,activeTab:"subject-exam",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/department/department-examination-icon.svg",alt:"attendence"}),s.jsx("p",{children:j("examinations")})]})}),s.jsx(P,{carryParentState:i,activeTab:"subject-academic",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/subject/subject-daily-update-icon.svg",alt:"student Request"}),s.jsx("p",{style:{textAlign:"center"},children:j("academics_teachings")})]})})]}):s.jsxs("div",{className:v.item,style:{paddingLeft:"2vw"},children:[s.jsx(y,{carryParentState:i,activeTab:"subject-catalog",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/class/class-catalog-icon.svg",alt:"Class Catalog"}),s.jsx("p",{children:j("catalog")})]})}),s.jsx(y,{carryParentState:i,activeTab:"subject-attendance",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/class/class-attendance-icon.svg",alt:"attendence"}),s.jsxs("p",{children:[" ",j("attendance")," "]})]})}),s.jsx(y,{carryParentState:i,activeTab:"subject-assignment",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/subject/subject-assignment-icon.svg",alt:"assignment"}),s.jsx("p",{children:j("assigmnent")})]})}),s.jsx(y,{carryParentState:i,activeTab:"subject-exam",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/department/department-examination-icon.svg",alt:"attendence"}),s.jsx("p",{children:j("examinations")})]})}),s.jsx(y,{carryParentState:i,activeTab:"subject-academic",children:s.jsxs("div",{className:v.itemIcon,children:[s.jsx("img",{src:"/images/member_tab/subject/subject-daily-update-icon.svg",alt:"student Request"}),s.jsx("p",{style:{textAlign:"center"},children:j("academics_teachings")})]})})]})})})},re=({carryParentState:i,viewAs:m,did:j,instituteId:g})=>{var M,w,T,$,J,r,Q,H,k,f,l,V,U,q,o,R,d,F,z,C;const{t:b}=A(),t=Es(),[c]=Us();return s.jsx(s.Fragment,{children:c.get("a")==="subject-academic-detail"?s.jsx(te,{}):c.get("a")==="assignment-detail"?s.jsx(zs,{isDepartment:m,carryParentState:i}):c.get("a")==="assignment-student-detail"?s.jsx(Gs,{isDepartment:m}):s.jsx("div",{className:ds.departmenthead,children:s.jsxs("div",{className:ds.demaprtment_list,children:[s.jsx("div",{className:ds.with_search,style:{marginBottom:"0.7rem",alignItems:"flex-start",flexDirection:"column"},children:((M=c.get("a"))==null?void 0:M.substring(0,7))==="subject"?s.jsxs(s.Fragment,{children:[s.jsxs("h6",{children:[b("subject_name")," : ",((w=t.state)==null?void 0:w.subjectName)??""]}),s.jsxs("h6",{children:[b("subject_teacher")," : ",((T=t.state)==null?void 0:T.subjectTeacherName)??""]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("h6",{children:[b("class_name")," : ",(($=t.state)==null?void 0:$.clsName)??""]}),s.jsxs("h6",{children:[b("class_teacher")," : ",((J=t.state)==null?void 0:J.teacherName)??""]})]})}),c.get("a")==="subject-detail"?s.jsx(ie,{carryParentState:i,isDepartment:m}):c.get("a")==="subject-catalog"?s.jsx(Ws,{cid:(r=t.state)==null?void 0:r.clsId,bid:(Q=t.state)==null?void 0:Q.batchId,isDepartment:m,sid:(H=t.state)==null?void 0:H.subjectId}):c.get("a")==="subject-attendance"?s.jsx(Ys,{sid:(k=t.state)==null?void 0:k.subjectId,bid:(f=t.state)==null?void 0:f.batchId,isDepartment:m,subjectName:((l=t.state)==null?void 0:l.subjectName)??""}):c.get("a")==="subject-assignment"?s.jsx(Ks,{sid:(V=t.state)==null?void 0:V.subjectId,cid:(U=t.state)==null?void 0:U.clsId,carryParentState:i,bid:(q=t.state)==null?void 0:q.batchId,isDepartment:m}):c.get("a")==="subject-exam"?s.jsx(Qs,{sid:(o=t.state)==null?void 0:o.subjectId,cid:(R=t.state)==null?void 0:R.clsId,isDepartment:m}):c.get("a")==="subject-academic"?s.jsx(ee,{sid:(d=t.state)==null?void 0:d.subjectId,carryParentState:i,isDepartment:m}):s.jsxs(s.Fragment,{children:[s.jsx(ae,{carryParentState:i}),c.get("a")==="class-detail"&&s.jsx(Js,{cid:t.state.clsId,openAs:"SUBJECT_TEACHER",isDepartment:!0}),c.get("a")==="class-subject"&&s.jsx(Vs,{carryParentState:i,clsId:(F=t.state)==null?void 0:F.clsId,isView:"DEPARTMENT_HEAD",instituteId:g,did:j}),c.get("a")==="class-attendance"&&s.jsx(ne,{cid:(z=t.state)==null?void 0:z.clsId,isDepartment:!0,className:((C=t.state)==null?void 0:C.clsName)??""})]})]})})})};export{ne as A,re as O};
