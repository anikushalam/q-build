import{u as D,r as n,W as K,z as X,j as t,Q as Y}from"./index-0ca76035.js";import{B as Z}from"./BorderBottom-1dc6f53e.js";import{P as $}from"./PopupWrapper-2578092d.js";import{J as A}from"./JoinFormTextArea-394bf055.js";import{n as q}from"./institute-staff-student-api-7114d611.js";import{s as d}from"./FeesStructure.module-7a88fbbc.js";import{J as G}from"./JoinFormInput-82706177.js";import{s as V}from"./pdf-convertor-function-4fe9e778.js";import{c as ee}from"./department-api-e4b13f05.js";import{c as te}from"./main.certificate.pdf.worker-fdc20546.js";const fe=({onClose:_,uniqueGr:m,instituteId:s,isViewBy:f,commingReason:p,certificateId:B,onRefetch:k})=>{const{t:o}=D(),[x,h]=n.useState(!1),[R,U]=n.useState(!1),[i,y]=n.useState(""),[u,w]=n.useState(""),[b,E]=n.useState(""),[j,F]=n.useState(!1),[L]=q(),[I]=K(),[M]=ee(),{oneInstituteProfile:g,oneInstituteProfileRefetch:v}=X({data:{id:s,type:"ID"},skip:!s});n.useEffect(()=>{s&&v()},[s,v]),n.useEffect(()=>{f==="REQUEST_TAB"&&y(p||"")},[p,f]);const N=e=>{var a;((a=e.target.value)==null?void 0:a.length)<=75&&y(e.target.value)},W=e=>{var a;((a=e.target.value)==null?void 0:a.length)<=75&&w(e.target.value)},H=e=>{var a;((a=e.target.value)==null?void 0:a.length)<=75&&E(e.target.value)},J=e=>{const{institute:a,studentInfo:r}=V(g==null?void 0:g.institute,e,{reason:i,message:u,authority:b,uniqueGr:m,letterHead:j}),S=new Worker(new URL(te,import.meta.url),{type:"module"});S.postMessage({printCertificateType:"BONAFIDE",studentInfo:r,institute:a}),S.onmessage=c=>{if(c&&(e!=null&&e._id)){if(f==="REQUEST_TAB"){const l=new FormData;l.append("file",c.data),I({fileUpload:l}).then(Q=>{var T;M({cid:B,attach:(T=Q.data)==null?void 0:T.imageKey,status:"Issued"}).then(()=>{k(),h(z=>!z),window.open(URL.createObjectURL(c.data),"_blank")}).catch({})}).catch({})}else window.open(URL.createObjectURL(c.data),"_blank"),h(l=>!l);_()}}},O=()=>{m&&i&&s?(h(e=>!e),L({gr:m,id:s,bonafideReason:{reason:i,student_bona_message:u}}).then(e=>{var a,r;(a=e==null?void 0:e.data)!=null&&a.student&&J((r=e==null?void 0:e.data)==null?void 0:r.student)}).catch({})):i||U(!0)},P=()=>{x||_()},C=()=>{F(e=>!e)};return t.jsx(t.Fragment,{children:t.jsxs($,{onClose:P,children:[t.jsx("div",{className:d.add_category_modal,style:{width:"30rem",minHeight:"10rem",height:"fit-content"},children:t.jsxs("section",{className:d.fee_middle_section_container,style:{marginBottom:"1.2rem"},children:[t.jsx("h6",{style:{fontSize:"20px",fontWeight:"600"},children:o("bonafide")}),t.jsx(Z,{customStyle:{width:"100%",marginTop:"0.7rem"}}),t.jsx(A,{labelText:o("enter_reason"),placeholder:o("enter_reason"),name:"reason",value:i,type:"text",onChange:N,errorShow:R}),t.jsx(A,{labelText:o("bonafide_message_optional"),placeholder:o("bonafide_message_optional_placeholder"),name:"message",value:u,type:"text",onChange:W}),t.jsx(G,{labelText:o("competent_authority"),placeholder:o("competent_authority_lable"),name:"authority",value:b,type:"text",onChange:H}),t.jsxs("section",{className:d.letter_head_container,children:[j?t.jsx("img",{src:"/images/checkbox-icon.svg",alt:"icon",onClick:C}):t.jsx("img",{src:"/images/box-icon.svg",alt:"icon",onClick:C}),t.jsx("h6",{children:o("printing_on_letter_head")})]}),t.jsx("button",{onClick:O,className:d.fee_middle_confirm_button,style:{marginTop:"4rem"},children:o("confirm")})]})}),x&&t.jsx(Y,{})]})})};export{fe as B};
