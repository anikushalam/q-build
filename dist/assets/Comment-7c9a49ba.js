import{R as A,_ as B,r as i,u as y,k as R,g as V,bS as I,j as e,e as F,t as J,q as K}from"./index-0ca76035.js";import{i as M,j as Q,k as W}from"./post-api-b04eb54b.js";import{f as X}from"./index-c08ef366.js";import{i as S}from"./constant_value-4cd2b3e0.js";import{C as Y}from"./CustomSuspenseGif-96fc12fa.js";import{A as Z}from"./Avatar-e65c49d9.js";import"./Avatar.module-fb7ee634.js";const tt="_addComment_lhw3q_1",et="_imgcontainer_lhw3q_9",st="_inputContainer_lhw3q_20",at="_hr_lhw3q_28",nt="_icons_lhw3q_47",it="_btn_lhw3q_59",ot="_comment_not_open_lhw3q_77",n={addComment:tt,imgcontainer:et,inputContainer:st,hr:at,icons:nt,btn:it,comment_not_open:ot},rt="_eachComment_1roza_1",ct="_imgcontainer_1roza_11",lt="_commentText_1roza_23",dt="_likeReply_1roza_43",ht="_eachCommentContainer_1roza_57",mt="_dots_1roza_61",ut="_time_1roza_67",r={eachComment:rt,imgcontainer:ct,commentText:lt,likeReply:dt,eachCommentContainer:ht,dots:mt,time:ut},_t=A.lazy(()=>B(()=>import("./NestedComments-a6a029b4.js"),["assets/NestedComments-a6a029b4.js","assets/index-0ca76035.js","assets/index-4d24e8f6.css","assets/post-api-b04eb54b.js","assets/index-c08ef366.js","assets/constant_value-4cd2b3e0.js","assets/Avatar-e65c49d9.js","assets/Avatar.module-fb7ee634.js","assets/Avatar-8bcfd9a5.css","assets/NestedComments-8a266a99.css"]));function U({comment:t,pid:d}){const[h,m]=i.useState(!1),[f,c]=A.useState(!0),{t:o}=y(),l=R(j=>j.idChange),u=V(),{commentLike:_,commentLikeRefetch:N}=M({ids:{cid:t==null?void 0:t._id,id:l==null?void 0:l.id,viewAs:S},skip:f});A.useEffect(()=>{_&&(c(!0),u(I.addCommentLike({postId:d,commentId:t==null?void 0:t._id,like:_.allLikeCount})))},[_]);const x=()=>{c(!1),N()};return e.jsxs("div",{className:r.eachCommentContainer,children:[e.jsxs("div",{className:r.eachComment,children:[e.jsx("div",{className:r.imgcontainer,children:e.jsx("img",{src:(t==null?void 0:t.authorPhotoId)!=="1"?`${F}/${t.authorProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:""})}),e.jsxs("div",{className:r.commentText,children:[e.jsx("h6",{children:t==null?void 0:t.authorUserName}),e.jsx("p",{children:t==null?void 0:t.commentDescription})]})]}),e.jsxs("div",{className:r.likeReply,children:[e.jsxs("p",{onClick:x,children:[o("Like")," ",e.jsx("span",{children:t==null?void 0:t.allLikeCount})]}),e.jsxs("p",{onClick:()=>m(!h),children:[o("reply")," ",e.jsx("span",{children:t==null?void 0:t.allChildCommentCount})," "]})]}),e.jsx("div",{className:r.nested,children:e.jsx(Y,{children:h&&(t==null?void 0:t._id)&&e.jsx(_t,{pcid:t==null?void 0:t._id,pid:d,allChildCommentCount:t==null?void 0:t.allChildCommentCount})})}),e.jsx("div",{className:r.dots,children:e.jsx("p",{className:r.time,children:X(t==null?void 0:t.createdAt)})})]})}const Ct=({pid:t,commentCount:d,commentCountIncrement:h})=>{var P,q;const[m,f]=i.useState(1),{t:c}=y(),o=i.useRef(""),[l,u]=J(),[_,N]=i.useState(!0),x=V(),j=R(s=>s.postChange.comments),w=R(s=>s.idChange.id),{allPostComment:a,allPostCommentRefetch:E}=Q({data:{pid:t||"",viewAs:S,page:m,limit:10},skip:!1}),[H]=W(),{oneInstituteDashboard:C,oneInstituteDashboardRefetch:L}=K({id:w,skip:!w});i.useEffect(()=>{w&&L()},[w,L]),i.useEffect(()=>{u&&_&&f(s=>s+1)},[u,_]),i.useEffect(()=>{E()},[m,E]),i.useEffect(()=>{a!=null&&a.comment&&x(I.addComment({postId:t,comment:a==null?void 0:a.comment})),(a==null?void 0:a.comment.length)===10?N(!0):N(!1)},[a==null?void 0:a.comment,x,t]);const G=()=>{h(++d),H({comment:{commentDescription:o.current.value},pid:t,viewAs:S}).then(s=>{var g,v,p,k,z,b,$,T,D,O;x(I.addCreatedComment({postId:t,comment:{allChildCommentCount:(g=s.data)==null?void 0:g.comment.allChildCommentCount,allLikeCount:(v=s.data)==null?void 0:v.comment.allLikeCount,author:(p=s.data)==null?void 0:p.comment.author,authorName:(k=s.data)==null?void 0:k.comment.authorName,authorPhotoId:(z=s.data)==null?void 0:z.comment.authorPhotoId,authorProfilePhoto:(b=s.data)==null?void 0:b.comment.authorProfilePhoto,authorUserName:($=s.data)==null?void 0:$.comment.authorUserName,commentDescription:(T=s.data)==null?void 0:T.comment.commentDescription,createdAt:(D=s.data)==null?void 0:D.comment.createdAt,_id:(O=s.data)==null?void 0:O.comment._id}}))}).catch({}),o.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.addComment,children:[e.jsx("div",{className:n.imgcontainer,children:e.jsx(Z,{dynamicImage:((P=C==null?void 0:C.institute)==null?void 0:P.photoId)!=="1"?`${F}/${(q=C==null?void 0:C.institute)==null?void 0:q.insProfilePhoto}`:"/images/ins_default_profile.svg"})}),e.jsxs("div",{className:n.inputContainer,children:[e.jsx("input",{type:"text",ref:o,placeholder:c("all_comment"),className:`form-control ${n.searchinput}`}),e.jsxs("div",{className:n.icons,children:[e.jsx("img",{src:"/images/img-icon.svg",alt:""}),e.jsx("img",{src:"/images/emoji-icon.svg",alt:""})]})]})]}),e.jsx("div",{className:n.btn,onClick:G,children:c("post")}),j==null?void 0:j.map(s=>{var g;return s.postId===t?(g=s==null?void 0:s.comment)==null?void 0:g.map((v,p)=>{var k;return((k=s==null?void 0:s.comment)==null?void 0:k.length)===p+1?e.jsxs("div",{className:n.eachComment,ref:l,children:[e.jsx(U,{comment:v,pid:t}),e.jsx("hr",{})]},p):e.jsxs("div",{className:n.eachComment,children:[e.jsx(U,{comment:v,pid:t}),e.jsx("hr",{})]},p)}):""})]})};function Nt({pid:t,commentCount:d,commentOpen:h,comment_turned:m}){const[f,c]=i.useState(d),{t:o}=y(),l=u=>{c(u)};return e.jsx(e.Fragment,{children:h&&(m!=="On"?e.jsx("section",{className:n.comment_not_open,children:o("comment_is_not_open_for_this_post")}):e.jsx("div",{style:{padding:"1vw"},children:e.jsx(Ct,{pid:t,commentCount:f,commentCountIncrement:l})}))})}export{Nt as default};
