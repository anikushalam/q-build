import{u as k,j as e,kX as Y,e as q,a1 as U,r as g,Q as v}from"./index-731451a5.js";import{s as n,b as F,c as z}from"./AcademicDetail-b12ada4f.js";import{i as Z}from"./image_extenstion-bbfb153e.js";import{P as I}from"./PopupWrapper-ffbaef7a.js";import{B as L}from"./BorderBottom-47800983.js";import{J as y}from"./JoinFormTextArea-7f6dded0.js";import{F as M,G as ee,r as se}from"./subject-api-215ccf27.js";import{C as te}from"./DatePicker-305f3dc6.js";const re=({isView:r,updateDescription:f,upadateImage:m,createdAt:t,subject:o})=>{var h,N,a;const{t:x}=k();return e.jsxs("div",{className:n.aditional_info_container,children:[r==="STUDENT"?e.jsxs("div",{className:n.aditional_info_dates,children:[e.jsx("h5",{children:(o==null?void 0:o.subjectName)??""}),e.jsx("h6",{children:`${((h=o==null?void 0:o.subjectTeacherName)==null?void 0:h.staffFirstName)??""} ${((N=o==null?void 0:o.subjectTeacherName)==null?void 0:N.staffMiddleName)??""} ${((a=o==null?void 0:o.subjectTeacherName)==null?void 0:a.staffLastName)??""}`})]}):null,f||(m==null?void 0:m.length)>0?e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:x("additional_info")}),e.jsx("p",{children:f}),(m==null?void 0:m.length)>0?e.jsx("div",{className:n.aditional_info_images,children:m==null?void 0:m.map(l=>Z(l==null?void 0:l.documentKey)?e.jsx("a",{title:"view File",href:`${Y}/${l==null?void 0:l.documentKey}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsx("img",{src:`${q}/${l==null?void 0:l.documentKey}`,alt:"files"},l==null?void 0:l.documentKey)}):null)}):null]}):null,e.jsxs("div",{className:n.aditional_info_dates,children:[e.jsx("p",{children:U(t).format("DD MMM yyyy")}),e.jsx("p",{children:U(t).format("LT")})]})]})},ce=({topic:r,topicId:f})=>{const{t:m}=k();return e.jsxs("div",{className:n.academic_card_container,children:[e.jsxs("div",{className:n.academic_card_top,children:[e.jsx("img",{src:"/images/member_tab/subject/subject-topic-icon.svg",alt:"topic icon"}),e.jsx("h6",{children:m("selected_topics")})]}),r==null?void 0:r.map(t=>e.jsx(F,{topic:t,topicId:f,isView:"SAVE_RECORD"},t==null?void 0:t._id))]})},R=[{name:"tab_lecture",id:0,key:"Lecture"},{name:"tab_practical",id:1,key:"Practical"},{name:"tab_tutorial",id:2,key:"Tutorial"}],ie=({topic:r,state:f,setState:m,isEdit:t,topicId:o})=>{const{t:x}=k(),[h,N]=g.useState([]),a=i=>{m(d=>({...d,rec_status:i}))},l=i=>{var d;if((d=i.target.files)!=null&&d.length){let C=[];for(let S of i.target.files)C.push(URL.createObjectURL(S));N(C),m(S=>({...S,files:[...S.files,...i.target.files]}))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:n.record_tab_container,children:R==null?void 0:R.map(i=>e.jsx("div",{className:f.rec_status===(i==null?void 0:i.key)?`${n.record_tab} ${n.record_tab_active}`:n.record_tab,onClick:()=>a(i==null?void 0:i.key),children:e.jsx("h6",{children:x(i==null?void 0:i.name)})},i==null?void 0:i.id))}),e.jsx(ce,{topic:r,topicId:o}),e.jsx(y,{labelText:x("additional_info_optional"),placeholder:x("additional_info_optional_placeholder"),name:"additiona_info",value:f.updateDescription,type:"text",onChange:i=>m(d=>({...d,updateDescription:i.target.value})),customStyleContainer:{width:"100%"}}),t?null:e.jsxs("div",{className:n.aditional_info_images,children:[h==null?void 0:h.map((i,d)=>e.jsx("img",{src:i,alt:"uploaded avatar"},d)),e.jsx("label",{htmlFor:"upload",children:e.jsx("img",{src:"/images/member_tab/subject/subject-camera-icon.svg",alt:"camera icon",style:{cursor:"pointer"}})})]}),e.jsx("input",{multiple:!0,type:"file",name:"upload",id:"upload",style:{display:"none"},onChange:l,accept:"image/gif, image/jpeg, image/png, image/*"})]})},oe=({onClose:r,sid:f,onRefetch:m,dailyMenu:t})=>{const{t:o}=k(),[x,h]=g.useState(2),[N,a]=g.useState(!1),[l,i]=g.useState({updateDescription:"",rec_status:"Lecture",files:[],date:""}),[d,C]=g.useState([]),[S,E]=g.useState([]),[A,B]=g.useState([]),[u,w]=g.useState([]),[b]=M(),[V]=ee(),[J]=se();g.useEffect(()=>{var s,_,D;if(t!=null&&t._id){let c=[],p=[];for(let j of t==null?void 0:t.daily_topic)c.push({topicId:(s=j==null?void 0:j.topic)==null?void 0:s._id,current_status:j==null?void 0:j.current_status}),p.push(j==null?void 0:j.topic);i({updateDescription:t==null?void 0:t.updateDescription,rec_status:(D=(_=t==null?void 0:t.daily_topic)==null?void 0:_[0])==null?void 0:D.status,files:[]}),C(()=>c),E(()=>p)}},[t]);const T=()=>{x===2?r():h(x===1?0:2)},P=(s,_)=>{(d==null?void 0:d.find(c=>(c==null?void 0:c.topicId)===(s==null?void 0:s._id)))?(C(c=>c==null?void 0:c.filter(p=>(p==null?void 0:p.topicId)!==(s==null?void 0:s._id))),E(c=>c==null?void 0:c.filter(p=>(p==null?void 0:p._id)!==(s==null?void 0:s._id)))):(C(c=>[...c,{topicId:s==null?void 0:s._id,current_status:_}]),E(c=>[...c,s]))},W=()=>{(d==null?void 0:d.length)>0&&h(1)},K=s=>{h(7),a(c=>!c);let _=s==null?void 0:s.split("/"),D=`${_[2]}-${_[1]}-${_[0]}`;i(c=>({...c,date:new Date(D)})),J({sid:f,extraBody:{date:s,flow:"Extra_Lecture"}}).then(c=>{var p,j,$;((j=(p=c==null?void 0:c.data)==null?void 0:p.attendance_all)==null?void 0:j.length)>0?(B(($=c==null?void 0:c.data)==null?void 0:$.attendance_all),h(3)):h(0),a(X=>!X)}).catch({})},O=()=>{if(f)if(a(s=>!s),t!=null&&t._id)V({sid:f,did:t==null?void 0:t._id,dailyUpdate:{arr:d,rec_status:l.rec_status,updateDescription:l.updateDescription}}).then(()=>{m(),r(),a(s=>!s)}).catch({});else{const s=new FormData;s.append("date",l.date),s.append("updateDescription",l.updateDescription),(d==null?void 0:d.length)>0&&s.append("arr",JSON.stringify(d)),s.append("rec_status",l.rec_status),(u==null?void 0:u.length)>0&&s.append("extra_lecture",JSON.stringify(u));for(let _ of l.files)s.append("file",_);b({sid:f,addDailyUpdate:s}).then(()=>{m(),r(),a(_=>!_)}).catch({})}},G=()=>{h(0)},Q=()=>{h(0)},H=s=>{u!=null&&u.includes(s)?w(_=>_==null?void 0:_.filter(D=>D!==s)):w(_=>[..._,s])};return e.jsxs(I,{onClose:T,children:[x===2?e.jsx(te,{datePickerPosition:{position:"rlative",top:"-5rem",left:"-10rem",borderRadius:"0.375rem",paddingBottom:"0"},range:!1,onClose:T,dateInput:l.date,setDateInput:K,isClose:!0}):x===3?e.jsxs("div",{className:n.add_academic_record,children:[e.jsxs("div",{className:n.add_academic_record_title,children:[e.jsxs("div",{className:n.add_academic_record_text,children:[e.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:T,alt:"back icon",style:{cursor:"pointer"}}),e.jsx("h6",{children:o("select_extra_lecture")})]}),e.jsx("button",{onClick:G,children:o("next")})]}),e.jsx(L,{customStyle:{width:"100%",marginBottom:"0.7rem"}}),e.jsx("h6",{className:n.extra_lecture_container,onClick:Q,children:o("regular")}),A==null?void 0:A.map((s,_)=>e.jsxs("h6",{className:u!=null&&u.includes(s==null?void 0:s._id)?`${n.extra_lecture_container} ${n.extra_lecture_container_active}`:n.extra_lecture_container,onClick:()=>H(s==null?void 0:s._id),children:[o("extra")," ",_+1]},s==null?void 0:s._id))]}):e.jsxs("div",{className:n.add_academic_record,children:[e.jsxs("div",{className:n.add_academic_record_title,children:[e.jsxs("div",{className:n.add_academic_record_text,children:[e.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:T,alt:"back icon",style:{cursor:"pointer"}}),e.jsx("h6",{children:o(x===0?"select_topic":"save_record")})]}),x===0?e.jsx("button",{onClick:W,children:o("next")}):e.jsx("button",{onClick:O,children:o("save")})]}),e.jsx(L,{customStyle:{width:"100%"}}),x===0?e.jsx(e.Fragment,{children:e.jsx(z,{sid:f,isView:"SUBJECT_TEACHER",onGrabChapterId:P,topicId:d,recordLecture:!0})}):e.jsx(ie,{topic:S,setState:i,state:l,isEdit:t==null?void 0:t._id,topicId:d})]}),N&&e.jsx(v,{})]})},fe=({daily:r,sid:f,onParentRefetch:m,isView:t})=>{var N;const{t:o}=k(),[x,h]=g.useState("");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.academic_card_container,children:[e.jsxs("div",{className:n.academic_card_top,style:{justifyContent:"space-between"},children:[e.jsxs("div",{className:n.academic_card_top_text,children:[e.jsx("img",{src:"/images/member_tab/subject/subject-topic-icon.svg",alt:"topic icon"}),e.jsxs("h6",{children:[U(r==null?void 0:r.date).format("Do MMMM, yyyy"),": Topics Covered"]})]}),t==="STUDENT"?null:e.jsxs("h6",{onClick:()=>h(r),children:["(",o("edit_"),")"]})]}),(N=r==null?void 0:r.daily_topic)==null?void 0:N.map(a=>e.jsx(F,{topic:a==null?void 0:a.topic,topicType:a==null?void 0:a.status,topicCurrentStatus:a==null?void 0:a.current_status,isView:"DAILY"},a==null?void 0:a._id)),e.jsx(re,{updateDescription:r==null?void 0:r.updateDescription,upadateImage:r==null?void 0:r.upadateImage,createdAt:r==null?void 0:r.createdAt,isView:t,subject:r==null?void 0:r.subject})]}),x&&e.jsx(oe,{onClose:()=>h(""),sid:f,onRefetch:m,dailyMenu:x})]})};export{oe as A,fe as S};
