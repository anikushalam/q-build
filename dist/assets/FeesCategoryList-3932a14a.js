import{u as B,r,j as s,Q as L,t as q,W as J,S as X,c as Y}from"./index-0ca76035.js";import{n as Z,o as M,p as H,q as ss,r as ts,s as es,t as as,c as ls,v as is,a as cs}from"./finance-api-e818490b.js";import{B as O}from"./BorderBottom-1dc6f53e.js";import{U as rs}from"./UniversalTab-73e7f63a.js";import{J as U}from"./JoinFormInput-82706177.js";import{s as c}from"./FeesStructure.module-7a88fbbc.js";import{P as F}from"./PopupWrapper-2578092d.js";import{S as K}from"./StringLength-ef31e6b8.js";import{B as ns}from"./ButtonWithAction-aaeab9a0.js";import{O as z}from"./Overlay-c8100e0a.js";import{S as I}from"./SearchModalBackdrop-c4f123e6.js";import{s as A}from"./EditConfirm.module-344fbdb9.js";const os=({onClose:t,financeId:i,onRefetch:h})=>{const{t:n}=B(),[l,a]=r.useState(""),[m,o]=r.useState(!1),[S]=Z(),p=g=>{var _;((_=g.target.value)==null?void 0:_.length)<=30&&a(g.target.value)},f=()=>{l&&(o(g=>!g),S({fid:i,createCategory:{category_name:l}}).then(()=>{h(),t(),o(g=>!g)}).catch(()=>{o(g=>!g)}))};return s.jsxs(F,{children:[s.jsxs("div",{className:c.add_category_modal,children:[s.jsxs("div",{className:c.add_category_modal_title,children:[s.jsx("h6",{children:n("add_new_category")}),s.jsx("img",{src:"/images/close-post-icon.svg",onClick:t,alt:""})]}),s.jsx(U,{labelText:n("category_name"),placeholder:n("category_example"),name:"category",value:l,type:"text",onChange:p,customStyleContainer:{width:"100%"}}),s.jsx(K,{maxLength:30,valueLength:l}),s.jsx(ns,{type:"button",buttonText:n("create"),shwoLoader:!1,onAction:f,customStyleButton:l?{marginTop:"2rem"}:{backgroundColor:"rgb(228, 224, 224)",marginTop:"2rem"},customStyleButtonText:l?{}:{color:"rgba(18, 18, 18, 0.8)"}})]}),m&&s.jsx(L,{})]})},ms=({categoryList:t,selectedId:i,onSecondary:h,onClose:n})=>{const{t:l}=B();return s.jsx(F,{onClose:n,children:s.jsxs("div",{className:`${c.add_category_modal} ${c.seating_modal}`,children:[s.jsxs("div",{className:c.add_category_modal_title,children:[s.jsx("h6",{children:l("select_secondary_category")}),s.jsx("img",{src:"/images/close-post-icon.svg",onClick:n,alt:""})]}),s.jsx(O,{customStyle:{width:"100%",marginTop:"0.7rem",marginBottom:"0.7rem"}}),t==null?void 0:t.map(a=>(a==null?void 0:a._id)===i?"":s.jsxs("div",{className:`${c.category_card} ${c.add_category_modal_title_active}`,onClick:()=>h(a==null?void 0:a._id),children:[s.jsx("img",{src:"/images/fees-category-icon.svg",alt:"categor icon"}),s.jsx("h6",{children:(a==null?void 0:a.category_name)??""})]},a==null?void 0:a._id))]})})},ds=({onClose:t,fid:i,openCategoryMenu:h,onRefetch:n,categoryList:l})=>{const[a,m]=r.useState(!1),[o]=M(),[S]=H(),[p,f]=r.useState(!1),g=()=>{m(y=>!y),o({cid:h}).then(()=>{n(),t(),m(y=>!y)}).catch({})},_=y=>{f(!1),m(E=>!E),S({fid:i,secondaryData:{old_category:h,fee_category:y}}).then(()=>{n(),t(),m(E=>!E)}).catch({})};return s.jsx(s.Fragment,{children:p?s.jsx(ms,{selectedId:h,categoryList:l,onSecondary:_,onClose:()=>f(!1)}):s.jsxs(s.Fragment,{children:[s.jsx(I,{onClose:t}),s.jsxs(z,{customStyle:{zIndex:"1200"},children:[s.jsxs("div",{className:A.edit_modal_container,style:{width:"250px"},children:[s.jsx("h6",{className:A.edit,onClick:()=>f(!0),children:"Mark As Secondary"}),s.jsx("h6",{className:A.edit,onClick:g,children:"Delete"})]}),a&&s.jsx(L,{})]})]})})},Q=({onClose:t,financeId:i,onRefetch:h,openAs:n,openFeeHeadMenu:l,onEdit:a})=>{const{t:m}=B(),[o,S]=r.useState({master_name:n==="EDIT"?l==null?void 0:l.master_name:"",master_amount:n==="EDIT"?l==null?void 0:l.master_amount:""}),[p,f]=r.useState(""),[g,_]=r.useState(!1),[y]=ss();r.useEffect(()=>{n==="EDIT"&&S({master_name:l==null?void 0:l.master_name,master_amount:l==null?void 0:l.master_amount})},[n]);const E=x=>{var v;x.target.name==="master_name"?((v=x.target.value)==null?void 0:v.length)<=30&&S(j=>({...j,[x.target.name]:x.target.value})):S(j=>({...j,[x.target.name]:+x.target.value}))},T=x=>{const v={};for(let j in x)x[j]||(v[j]=`${j} is required!`);return v},N=()=>{const x=T(o);let v=!1;for(let j in x)if(j){v=!0;break}v?f(x):n==="EDIT"?a(o):(_(j=>!j),y({fid:i,addFeeHead:o}).then(()=>{h(),t(),_(j=>!j),S({master_name:"",master_amount:""})}).catch({}))};return s.jsx(F,{onClose:t,children:s.jsxs("div",{className:c.add_category_modal,children:[s.jsxs("div",{className:c.add_category_modal_title,children:[s.jsx("h6",{children:m(n==="EDIT"?"edit_fee_head":"add_new_fee_head")}),s.jsx("img",{src:"/images/close-post-icon.svg",onClick:t,alt:""})]}),s.jsx(U,{labelText:m("head_name"),placeholder:m("head_name_placeholder"),name:"master_name",value:o==null?void 0:o.master_name,type:"text",onChange:E,errorShow:p.master_name}),s.jsx(K,{maxLength:30,valueLength:o==null?void 0:o.master_name}),s.jsx(U,{labelText:m("amount"),placeholder:m("enter_amount"),name:"master_amount",value:o==null?void 0:o.master_amount,type:"tel",onChange:E,errorShow:p.master_amount}),s.jsx("button",{className:c.set_fees_structure_btn,title:"Add fees head",onClick:N,style:{justifyContent:"center"},children:m(n==="EDIT"?"update":"create")}),g&&s.jsx(L,{})]})})},hs=({onClose:t,openFeeHeadMenu:i,onRefetch:h,financeId:n})=>{const[l,a]=r.useState(!1),[m,o]=r.useState(!1),[S]=ts(),[p]=es(),f=()=>{a(_=>!_),S({fhid:i==null?void 0:i._id,fid:n}).then(()=>{h(),t(),a(_=>!_)}).catch({})},g=_=>{a(y=>!y),o(!1),t(),p({fmid:i==null?void 0:i._id,updateFeeHead:_}).then(()=>{h(),a(y=>!y)}).catch({})};return s.jsx(s.Fragment,{children:m?s.jsx(Q,{onClose:t,financeId:n,onRefetch:h,openAs:"EDIT",openFeeHeadMenu:i,onEdit:g}):s.jsxs(s.Fragment,{children:[s.jsx(I,{onClose:t}),s.jsxs(z,{customStyle:{zIndex:"1200"},children:[s.jsxs("div",{className:A.edit_modal_container,style:{width:"200px"},children:[s.jsx("h6",{className:A.edit,onClick:()=>o(_=>!_),children:"Edit"}),s.jsx("h6",{className:A.remove,onClick:f,children:"Delete"})]}),l&&s.jsx(L,{})]})]})})},xs=({financeId:t,openAs:i})=>{const{t:h}=B(),[n,l]=r.useState(!1),[a,m]=r.useState(""),[o,S]=q(),[p,f]=r.useState(1),[g,_]=r.useState(!0),[y,E]=r.useState(!1),[T,N]=r.useState(!0),[x,v]=r.useState([]),[j,d]=r.useState(!1),[C]=J(),[b]=as(),{getAllFeeHeadMaster:u,getAllFeeHeadMasterRefetch:D}=ls({data:{fid:t,page:p,limit:10,search:""},skip:!t});r.useEffect(()=>{t&&(N(!0),D())},[t,p,D]),r.useEffect(()=>{S&&g&&f(e=>e+1)},[S,g]),r.useEffect(()=>{var e,k;y?(v(u==null?void 0:u.all_master),N(!1),E(!1)):u!=null&&u.all_master?(v(w=>[...new Set([...w,...u==null?void 0:u.all_master].map(JSON.stringify))].map(JSON.parse)),N(!1)):((e=u==null?void 0:u.all_master)==null?void 0:e.length)===0&&N(!1),((k=u==null?void 0:u.all_master)==null?void 0:k.length)===10?_(!0):_(!1)},[u==null?void 0:u.all_master]);const R=()=>{l(e=>!e)},P=()=>{f(1),E(!0),N(!0),D()},V=e=>{d(w=>!w);const k=new FormData;k.append("file",e.target.files[0]),C({fileUpload:k}).then(w=>{var $,W;($=w.data)!=null&&$.imageKey?b({fid:t,excelFile:{excel_file:(W=w.data)==null?void 0:W.imageKey}}).then(()=>{d(G=>!G)}).catch({}):d(G=>!G)}).catch({})};return s.jsxs(s.Fragment,{children:[i==="HOSTEL_MANAGER"||i==="TRANSPORT_MANAGER"?"":s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c.upload_excel_container,children:[s.jsx("label",{className:c.upload_excel_file,htmlFor:"uploadExcel",children:s.jsx("img",{src:"/images/upload-xslx-icon.svg",alt:"add student icon",title:"Upload excel file"})}),s.jsx("input",{type:"file",id:"uploadExcel",accept:".xlsx",onChange:V,style:{display:"none"}}),s.jsx("p",{className:c.add_new_category,onClick:R,children:h("add_new_fee_head")})]}),s.jsx(O,{customStyle:{marginBottom:"1rem"}})]}),x==null?void 0:x.map((e,k)=>(x==null?void 0:x.length)===k+1?s.jsxs("div",{className:c.category_card,ref:o,style:{height:"74px"},children:[s.jsx("img",{style:{height:"36px",width:"36px"},src:"/images/fees-category-icon.svg",alt:"categor icon"}),s.jsxs("div",{className:c.category_card_fee,children:[s.jsx("h6",{style:{marginBottom:"0.3rem"},children:(e==null?void 0:e.master_name)??""}),s.jsxs("h6",{style:{color:"rgba(18, 18, 18, 0.5)"},children:[h("rs"),".",(e==null?void 0:e.master_amount)??0]})]}),i==="HOSTEL_MANAGER"||i==="TRANSPORT_MANAGER"||["Hostel Linked","Linked","Transport Linked"].includes(e==null?void 0:e.master_status)?"":s.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:()=>m(e),className:c.menu_icon,title:"Menu"})]},e==null?void 0:e._id):s.jsxs("div",{className:c.category_card,style:{height:"74px"},children:[s.jsx("img",{style:{height:"36px",width:"36px"},src:"/images/fees-category-icon.svg",alt:"categor icon"}),s.jsxs("div",{className:c.category_card_fee,children:[s.jsx("h6",{style:{marginBottom:"0.3rem"},children:(e==null?void 0:e.master_name)??""}),s.jsxs("h6",{style:{color:"rgba(18, 18, 18, 0.5)"},children:[h("rs"),".",(e==null?void 0:e.master_amount)??0]})]}),i==="HOSTEL_MANAGER"||i==="TRANSPORT_MANAGER"||["Hostel Linked","Linked","Transport Linked"].includes(e==null?void 0:e.master_status)?"":s.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:()=>m(e),className:c.menu_icon,title:"Menu"})]},e==null?void 0:e._id)),T&&s.jsx(X,{}),n&&s.jsx(Q,{onClose:R,financeId:t,onRefetch:P}),a&&s.jsx(hs,{openFeeHeadMenu:a,onRefetch:P,onClose:()=>m(""),financeId:t}),j&&s.jsx(L,{})]})},bs=({financeId:t,openAs:i})=>{var j;const{t:h}=B(),n=[{name:h("category"),id:0},{name:h("fees_heads"),id:1}],l=Y(),[a,m]=r.useState(0),[o,S]=r.useState(!1),[p,f]=r.useState(!1),[g,_]=r.useState(""),[y]=J(),[E]=is(),{getAllFeesCategory:T,getAllFeesCategoryRefetch:N}=cs({fid:t,skip:!t});r.useEffect(()=>{t&&N()},[t,N]);const x=()=>{S(d=>!d)},v=d=>{f(b=>!b);const C=new FormData;C.append("file",d.target.files[0]),y({fileUpload:C}).then(b=>{var u,D;(u=b.data)!=null&&u.imageKey?E({fid:t,excelFile:{excel_file:(D=b.data)==null?void 0:D.imageKey}}).then(()=>{f(R=>!R)}).catch({}):f(R=>!R)}).catch({})};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c.category_header,children:[s.jsx("img",{src:"/images/left-back-icon.svg",alt:"back arrow",className:c.back_icon,onClick:()=>l(-1),style:{cursor:"pointer"}}),s.jsx("h6",{className:c.category_header_title,children:h("fees_master")})]}),s.jsx(rs,{tabList:n,activeIndexTab:a,setActiveIndexTab:m,showAs:!1,customStyleTab:{width:"50%"}}),s.jsx(O,{customStyle:{marginBottom:"1rem"}}),a===0&&s.jsxs(s.Fragment,{children:[i==="HOSTEL_MANAGER"||i==="TRANSPORT_MANAGER"?"":s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c.upload_excel_container,children:[s.jsx("label",{className:c.upload_excel_file,htmlFor:"uploadExcel",children:s.jsx("img",{src:"/images/upload-xslx-icon.svg",alt:"add student icon",title:"Upload excel file"})}),s.jsx("input",{type:"file",id:"uploadExcel",accept:".xlsx",onChange:v,style:{display:"none"}}),s.jsx("p",{className:c.add_new_category,onClick:x,children:h("add_new_category")})]}),s.jsx(O,{customStyle:{marginBottom:"1rem"}})]}),(j=T==null?void 0:T.all_fees_format)==null?void 0:j.map(d=>{var C,b;return s.jsxs("div",{className:c.category_card,children:[s.jsx("img",{src:"/images/fees-category-icon.svg",alt:"categor icon"}),s.jsxs("h6",{children:[(d==null?void 0:d.category_name)??""," ",(C=d==null?void 0:d.secondary_category)!=null&&C.category_name?s.jsxs("span",{style:{fontSize:"11px",fontWeight:"400"},children:["(",((b=d==null?void 0:d.secondary_category)==null?void 0:b.category_name)??"",")"]}):""]}),i==="HOSTEL_MANAGER"||i==="TRANSPORT_MANAGER"?"":s.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:()=>_(d==null?void 0:d._id),className:c.menu_icon,title:"Menu"})]},d==null?void 0:d._id)}),o&&s.jsx(os,{onClose:x,financeId:t,onRefetch:N}),g&&s.jsx(ds,{onClose:()=>_(""),openCategoryMenu:g,onRefetch:N,fid:t,categoryList:(T==null?void 0:T.all_fees_format)??[]}),p&&s.jsx(L,{})]}),a===1&&s.jsx(xs,{financeId:t,openAs:i})]})};export{bs as F};
