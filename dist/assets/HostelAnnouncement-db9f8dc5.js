import{j as e,u as A,r as i,d as P,t as q,S as O}from"./index-0ca76035.js";import{aa as V,ab as $}from"./hostel-api-9294ced1.js";import{B as I}from"./BorderBottom-1dc6f53e.js";import{s as F}from"./Hostel.module-50da11fe.js";import{s as d}from"./NewAnnouncement.module-4f17791a.js";import{L as H}from"./LoaderButton-56f541f9.js";import{F as J}from"./FormToggle-18d319d7.js";const k=({announcement:r})=>{var h;return e.jsxs("div",{className:F.announcement_card,children:[e.jsx("h6",{children:(r==null?void 0:r.insAnnTitle)??""}),e.jsx("p",{children:(h=r==null?void 0:r.insAnnDescription)==null?void 0:h.substring(0,200)})]})},L=({hid:r,onRefetch:h,onClose:x})=>{const{t:c}=A(),[n,D]=i.useState(),[S,y]=i.useState([]),[g,N]=i.useState([]),[j,_]=i.useState(!1),[w,u]=i.useState(!1),o=i.useRef(""),f=i.useRef(""),[E,b]=i.useState(""),[a]=V();i.useEffect(()=>{if(n){const t=[],l=[];for(let p in n)for(let s in n[p])s==="type"&&(n[p][s].includes("image/")?t.push(URL.createObjectURL(n[p])):l.push({name:n[p].name}));y(t),N(l)}},[n]);const v=()=>{if(o.current.value){u(!0);const t=new FormData;t.append("insAnnTitle",o.current.value),t.append("insAnnDescription",f.current.value),t.append("insAnnVisibility",j?"Private":"Anyone");let l=0;for(let p in n)n[p].size&&(t.append(`file${l+1}`,n[p]),++l);t.append("announceCount",l),a({hid:r,announcement:t}).then(()=>{h(),x(),o.current.value="",f.current.value="",u(!1)}).catch({})}else b({title_val:"*required"})},T=t=>{D(t.target.files)},m=document.querySelector("textarea");m==null||m.addEventListener("keyup",t=>{m.style.height="auto";let l=t.target.scrollHeight;m.style.height=`${l}px`});const C=t=>{_(t.target.checked)};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h6",{children:c("new_announcement")}),e.jsx("img",{src:"/images/close-post-icon.svg",onClick:x,alt:"close icon",style:{cursor:"pointer"}})]}),e.jsx(I,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}}),e.jsx(J,{labelHeading:c("turn_announcement_private_only"),customContainer:{padding:"0"},customLabel:{fontWeight:"500"},checkedToggle:j,onToggleHandler:C}),e.jsxs("div",{className:d.postTitle,children:[e.jsx("input",{className:d.input,type:"text",ref:o,required:!0,placeholder:c("title_announce")}),E.title_val&&e.jsx("div",{style:{color:"red"},children:"* announcement title required"})]}),e.jsx("div",{className:d.postDesc,children:e.jsx("textarea",{className:d.postTextarea,rows:"3",type:"text",required:!0,ref:f,name:"CreateInsPost",placeholder:c("description"),style:{border:"0.5px solid rgba(18, 18, 18, 0.3)",borderRadius:"6px"}})}),e.jsxs("div",{className:d.listContainer,children:[S.length>0&&e.jsx("div",{className:d.documentList,children:S.map((t,l)=>e.jsx("img",{src:t,alt:""},l))}),g.length>0&&e.jsx("div",{className:d.pdfList,children:g.map((t,l)=>e.jsxs("div",{className:d.pdfPreview,children:[e.jsx("img",{src:"/images/pdf-icon.png",alt:""},l),e.jsx("p",{children:t.name})]}))})]}),e.jsx("label",{htmlFor:"document",style:{cursor:"pointer"},children:e.jsx("p",{className:d.addfiles,children:c("add_files")})}),e.jsx("input",{className:d.upload,multiple:!0,id:"document",name:"file",onChange:T,type:"file",accept:"image/gif, image/jpeg, image/png,  application/pdf, application/msword"}),e.jsxs("button",{className:d.btn,disabled:w,onClick:v,style:{marginTop:"0"},children:[e.jsx("p",{children:c("post")}),w&&e.jsx("div",{children:e.jsx(H,{})})]})]})},X=({hid:r,carryParentState:h})=>{var C,t,l,p;const{t:x}=A(),c=P(),[n,D]=i.useState(!1),[S,y]=q(),[g,N]=i.useState(1),[j,_]=i.useState(!0),[w,u]=i.useState(!0),[o,f]=i.useState([]),[E,b]=i.useState(!1),{getAnnouncementListByHostel:a,getAnnouncementListByHostelRefetch:v}=$({data:{hid:r??((C=c.state)==null?void 0:C.hid),page:g,limit:10},skip:r?!r:!((t=c.state)!=null&&t.hid)});i.useEffect(()=>{var s;(r||(s=c.state)!=null&&s.hid)&&(u(!0),v())},[r,(l=c.state)==null?void 0:l.hid,g,v]),i.useEffect(()=>{y&&j&&N(s=>s+1)},[y,j]),i.useEffect(()=>{var s,R;E?(f(a==null?void 0:a.announcement),u(!1),b(!1)):a!=null&&a.announcement?(f(U=>[...new Set([...U,...a==null?void 0:a.announcement].map(JSON.stringify))].map(JSON.parse)),u(!1)):((s=a==null?void 0:a.announcement)==null?void 0:s.length)===0&&u(!1),((R=a==null?void 0:a.announcement)==null?void 0:R.length)===10?_(!0):_(!1)},[a==null?void 0:a.announcement]);const T=()=>{D(s=>!s)},m=()=>{N(1),b(!0),u(!0),v()};return e.jsxs(e.Fragment,{children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:F.with_search,children:e.jsx("h6",{children:x("hostel_announcement")})}),e.jsx(I,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}}),((p=c.state)==null?void 0:p.viewNotice)==="HOSTEL_UNIT_TAB"?"":e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("p",{className:F.add_new_category,onClick:T,children:x("create_new_announcement")})}),o==null?void 0:o.map((s,R)=>(o==null?void 0:o.length)===R+1?e.jsx("div",{ref:S,children:e.jsx(k,{announcement:s})},s==null?void 0:s._id):e.jsx(k,{announcement:s},s==null?void 0:s._id)),w&&e.jsx(O,{})]}),n&&e.jsx(L,{onClose:T,hid:r,onRefetch:m})]})};export{X as H};
