import{u as M,j as e,n as U,d as D,L as q,lH as Q,r as m,c as P,t as W}from"./index-0ca76035.js";import{n as z,al as N,B as v,am as V,an as Y,M as J,ao as b,U as p,a as R,C as H,Q as k,ap as K,p as X,q as Z,l as L,s as j,r as w,L as ee}from"./FinanceConfig-24ef7fd2.js";import{F as ae}from"./FormTextarea-d1bf4550.js";const se="_student_table_15ul5_1",le="_student_table_header_15ul5_5",re="_student_table_header_label_15ul5_10",te="_student_table_content_card_15ul5_19",ce="_student_table_profile_15ul5_28",ne="_student_table_header_name_15ul5_40",_e="_student_table_header_label_text_15ul5_47",oe="_student_table_contact_15ul5_53",ie="_student_table_contact_email_15ul5_62",me="_student_table_contact_number_15ul5_68",r={student_table:se,student_table_header:le,student_table_header_label:re,student_table_content_card:te,student_table_profile:ce,student_table_header_name:ne,student_table_header_label_text:_e,student_table_contact:oe,student_table_contact_email:ie,student_table_contact_number:me},he=({studentAlias:a})=>{const{t:s}=M();return e.jsx("div",{className:r.student_table,children:e.jsxs("div",{className:r.student_table_header,children:[e.jsx("p",{className:r.student_table_header_label,style:{flex:"1"},children:a??s("gr_no")}),e.jsx("p",{className:r.student_table_header_label,style:{flex:"3"},children:s("name")}),e.jsx("p",{className:r.student_table_header_label,style:{flex:"2"},children:s("contact_number")}),e.jsx("p",{className:r.student_table_header_label,style:{flex:"1"},children:s("applicable_outs")})]})})},$=({student:a,messageId:s,headId:o,instituteId:i})=>{var x;const d=U(),t=D();return e.jsx(e.Fragment,{children:e.jsxs(q,{to:`/q/${d.username}/student/profile`,state:{...t.state,sid:a==null?void 0:a._id,messageId:s,headId:o,instituteId:i},children:[e.jsxs("div",{className:r.student_table_content_card,style:{cursor:"pointer"},children:[e.jsx("p",{className:r.student_table_header_label,style:{flex:"1"},children:(a==null?void 0:a.studentGRNO)??""}),e.jsxs("div",{className:r.student_table_profile,style:{flex:"3"},children:[e.jsx("img",{src:a!=null&&a.studentProfilePhoto?`${Q}/${a==null?void 0:a.studentProfilePhoto}`:`${z}/feed-user-avatar.svg`,loading:"lazy",alt:"avatar"}),e.jsxs("div",{children:[e.jsxs("p",{className:r.student_table_header_name,children:[`${(a==null?void 0:a.studentFirstName)??""} ${(a==null?void 0:a.studentMiddleName)??""} ${(a==null?void 0:a.studentLastName)??""}`,(a==null?void 0:a.profile_percentage)==="100"||(a==null?void 0:a.profile_percentage)===100?e.jsx("img",{src:`${N}/complete.svg`,loading:"lazy",alt:"avatar",style:{marginLeft:"0.6rem",height:"1rem"}}):null]}),e.jsx("p",{className:r.student_table_header_label_text,children:((x=a==null?void 0:a.studentClass)==null?void 0:x.classTitle)??""})]})]}),e.jsxs("div",{className:r.student_table_header_label,style:{flex:"2"},children:[e.jsxs("div",{className:r.student_table_contact,children:[e.jsx("img",{src:`${N}/gender.svg`,alt:"gender icon"}),e.jsx("p",{className:r.student_table_contact_email,children:a==null?void 0:a.studentGender})]}),e.jsxs("div",{className:r.student_table_contact,style:{marginTop:"0.4rem"},children:[e.jsx("img",{src:`${N}/phone.svg`,alt:"phone icon"}),e.jsx("p",{className:r.student_table_contact_number,children:a!=null&&a.user.userPhoneNumber?a==null?void 0:a.user.userPhoneNumber:(a==null?void 0:a.user.userEmail)??""})]})]}),e.jsx("p",{className:r.student_table_header_label,style:{flex:"1"},children:(a==null?void 0:a.applicable_fees_pending)??0})]}),e.jsx(v,{customStyleBorder:{margin:"0"}})]})})},de=({onClose:a,sendStudentList:s,messageId:o,instituteId:i,headId:d,viewAs:t,isStudentProfile:x,toRedirectUrl:y,parentState:g})=>{const{t:h}=M(),[C,f]=m.useState(!1),[T,A]=m.useState(!1),[E]=V(),[I]=Y(),[n,S]=m.useState({alarm_mode:"APP_NOTIFICATION",content:""}),l=P(),u=()=>{n.content?x?o&&n.alarm_mode&&(s==null?void 0:s.length)>0&&i&&(f(_=>!_),I({sendMessage:{message:n.content,from:d??"",type:t==="ADMISSION_ADMIN"?"Admission Head":t==="FINANCE_MANAGER"?"Finance Head":t==="CERTIFICATE_AUTHORITY"?"Certificate Authority":t==="STUDENT_SECTION"?"Student Section":t==="ID_CARD_SECTION"?"Id Card Authority":"Institute Admin",fid:o??"",alarm_mode:n.alarm_mode,sid:s,flow:t==="INSTITUTE_ADMIN"?"INSTITUTE_ADMIN":"Other"},id:i}).then(()=>{a(),f(_=>!_)}).catch({})):o&&n.alarm_mode&&(s==null?void 0:s.length)>0&&i&&(f(_=>!_),E({sendMessage:{message:n.content,from:d??"",type:t==="ADMISSION_ADMIN"?"Admission Head":t==="FINANCE_MANAGER"?"Finance Head":t==="CERTIFICATE_AUTHORITY"?"Certificate Authority":t==="STUDENT_SECTION"?"Student Section":t==="ID_CARD_SECTION"?"Id Card Authority":"Institute Admin",fid:o??"",alarm_mode:n.alarm_mode,filtered_arr:s,flow:t==="INSTITUTE_ADMIN"?"INSTITUTE_ADMIN":"Other"},id:i}).then(()=>{a(),l(y,{state:g}),f(_=>!_)}).catch({})):A(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("div",{className:b.modal_container,children:[e.jsx(p,{children:e.jsxs("div",{className:b.modal_container_outer_header,children:[e.jsx("div",{className:b.modal_container_header,children:e.jsx("h6",{children:h("student_message")})}),e.jsx("img",{src:`${R}/close.svg`,alt:"close icon",onClick:a})]})}),e.jsx(v,{}),e.jsxs(p,{customStyle:{paddingTop:"0"},children:[e.jsxs("section",{className:b.notify_container,onClick:()=>S(_=>({..._,alarm_mode:"APP_NOTIFICATION"})),children:[e.jsx("img",{src:n.alarm_mode==="APP_NOTIFICATION"?`${N}/radio-blue.svg`:`${N}/radio-grey.svg`,alt:"icon"}),e.jsxs("div",{className:b.notify_text,children:[e.jsx("h6",{children:h("Notify_with_In_app_Notification")}),e.jsx("p",{children:h("Notify_with_In_app_Notification_note")})]})]}),e.jsxs("section",{className:b.notify_container,children:[e.jsx("img",{src:n.alarm_mode==="EMAIL_NOTIFICATION"?`${N}/radio-blue.svg`:`${N}/radio-grey.svg`,alt:"icon"}),e.jsxs("div",{className:b.notify_text,children:[e.jsx("h6",{children:h("Notify_On_Email_and_SMS")}),e.jsx("p",{children:h("Notify_On_Email_and_SMS_note")})]})]}),n.alarm_mode==="APP_NOTIFICATION"&&e.jsx(ae,{label:h("student_message_label"),placeholder:h("student_message_label_placeholder"),name:"content",value:n.content,type:"text",onChange:_=>S(F=>({...F,content:_.target.value})),errorShow:T}),e.jsx(H,{label:"confirm",onAction:u})]})]})}),C&&e.jsx(k,{})]})},fe=({instituteId:a,studentAlias:s,headId:o,messageId:i})=>{const{t:d}=M(),t=P(),x=D(),y=U(),[g,h]=m.useState(""),[C,f]=m.useState(1),[T,A]=m.useState(!0),[E,I]=W({skip:g}),[n,S]=m.useState(!1),{instituteAllStudent:l,instituteAllStudentLoading:u}=K({data:{id:a,page:C,limit:10,search:g},skip:!a});m.useEffect(()=>{I&&T&&f(c=>c+1)},[I,T]),m.useEffect(()=>{l!=null&&l.length&&X(l==null?void 0:l.length,A)},[l==null?void 0:l.length]);const _=m.useCallback(Z(c=>h(c),500),[]),F=c=>{_(c.target.value)},O=()=>{S(c=>!c)},B=()=>{t(`/q/${y.username}/member/staff/finance?type=message`,{state:x.state})};return e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx(p,{children:e.jsxs("div",{className:j.fm_header_container,children:[e.jsx("h6",{children:d("all_students")}),e.jsxs("div",{className:j.fm_both_filter,children:[e.jsx("div",{className:j.fm_search,children:e.jsx("section",{className:j.fm_search_container,children:e.jsxs("div",{className:j.fm_search_container_inner,children:[e.jsx("img",{className:j.fm_search_icon,alt:"search icon",src:`${w}/navbar-search.svg`}),e.jsx("input",{type:"text",placeholder:d("search"),onChange:F,style:{minWidth:"300px"}})]})})}),e.jsx("img",{src:`${R}/history.svg`,alt:"history icon",onClick:B}),e.jsx(H,{label:"student_message",customStyle:{margin:"0"},onAction:O})]})]})}),e.jsx(v,{}),e.jsx(p,{children:e.jsx(he,{studentAlias:s})}),e.jsx(v,{}),e.jsxs(p,{children:[u&&e.jsx(ee,{}),u&&g&&e.jsx(k,{}),l==null?void 0:l.map((c,G)=>(l==null?void 0:l.length)===G+1?e.jsx("div",{ref:E,children:e.jsx($,{student:c,instituteId:a,messageId:i,headId:o})},c==null?void 0:c._id):e.jsx($,{student:c,instituteId:a,messageId:i,headId:o},c==null?void 0:c._id))]})]}),n&&e.jsx(de,{onClose:O,messageId:i,instituteId:a,headId:o,parentState:x.state,toRedirectUrl:`/q/${y.username}/member/staff/finance?type=message`,viewAs:"FINANCE_MANAGER"})]})};export{fe as default};
