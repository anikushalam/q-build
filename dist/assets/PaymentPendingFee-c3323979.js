import{u as K,r as b,k as X,j as a,D as Z,N as M,Q as t}from"./index-0ca76035.js";import{s as i}from"./PaymentPendingFee.module-4ffad14d.js";import{aQ as n,aR as l,aS as ee}from"./admission-api-925391d9.js";import{J as S}from"./JoinFormInput-82706177.js";import{J as oe}from"./JoinFormCalender-d186c4ef.js";import{C as re}from"./CustomNormalSelectInput-0a62fa3f.js";import{as as ae,at as pe}from"./hostel-api-9294ced1.js";import{P as de}from"./PaymentModeType-555d6eae.js";import{H as ce}from"./transport-api-ee724cce.js";import"./JoinForm.module-212f9bb3.js";import"./DatePicker-c6d0e911.js";function je({hideModal:y,payFees:U,installment:e,onAdmissionFeesRefetch:s,onFeesRefetch:h,studentId:_,viewAs:L}){var C;const{t:p}=K(),[B,f]=b.useState(!1),A=X(o=>o.admissionChange.aid),[r,x]=b.useState({amount:"",mode:"",fee_payment_mode:"",fee_payment_amount:"",transaction_date:"",fee_bank_name:"",fee_bank_holder:"",fee_utr_reference:""}),[v,P]=b.useState(""),[N,k]=b.useState({msg:"",run:!1}),[m]=n(),[G]=l(),[O]=ae(),[V]=pe(),[$]=ee(),[J]=ce();b.useEffect(()=>{(e==null?void 0:e.openAs)==="REFUND"&&x(o=>({...o,fee_payment_mode:"Refunded",fee_payment_amount:e==null?void 0:e.refundAmount,amount:e==null?void 0:e.refundAmount}))},[e==null?void 0:e.openAs]);const q=o=>{(e==null?void 0:e.openAs)!=="REFUND"&&(r.fee_payment_mode==="Exempted/Unrecovered"||x(d=>({...d,amount:+o.target.value,fee_payment_amount:+o.target.value})))},j=o=>{o.target.name==="fee_payment_mode"?x(d=>({...d,[o.target.name]:o.target.value,mode:o.target.value==="By Cash"?"Offline":o.target.value==="Exempted/Unrecovered"?"Exempted":"Online",fee_payment_mode:o.target.value,amount:o.target.value==="Exempted/Unrecovered"?+(e==null?void 0:e.remainAmount):"",fee_payment_amount:o.target.value==="Exempted/Unrecovered"?+(e==null?void 0:e.remainAmount):""})):x(d=>({...d,[o.target.name]:o.target.value}))},Q=o=>{const d=o==null?void 0:o.split("/");x(g=>({...g,transaction_date:`${d[2]}-${d[1]}-${d[0]}`}))},z=o=>{var g;const d={};for(let c in o)c==="fee_bank_name"||c==="fee_bank_holder"||c==="fee_utr_reference"||c==="amount"||c==="mode"||(o[c]?c==="fee_payment_amount"&&(r.fee_payment_mode==="Government/Scholarship"||r.fee_payment_mode==="Exempted/Unrecovered"||o[c]>((g=e==null?void 0:e.install)==null?void 0:g.remainAmount)&&(k({msg:"You can not enter amount greater than Remaining fees",run:!0}),d.fee_payment_amount=`${c} is required!`)):d[c]=`${c} is required!`);return d},W=o=>{x(d=>({...d,mode:o==="By Bank"?"Online":"Offline"}))},Y=()=>{var o,d,g,c,F,T,I,E,R,D;if((e==null?void 0:e.openAs)==="REFUND"&&_&&(e!=null&&e.admissionId))f(!0),(e==null?void 0:e.collectFlow)==="Hostel Application"?V({hid:e==null?void 0:e.hostelId,sid:_,appId:e==null?void 0:e.appId,refundData:{...r}}).then(()=>{s(),h(),y(!1),f(!1)}).catch({}):G({aid:e==null?void 0:e.admissionId,sid:_,appId:e==null?void 0:e.appId,refundData:{...r}}).then(()=>{s(),h(),y(!1),f(!1)}).catch({});else if(_!==""&&((o=e==null?void 0:e.install)==null?void 0:o.appId)!==""){const w=z(r);let H=!1;for(let u in w){H=!0;break}H?P(w):(f(!0),(e==null?void 0:e.collectFlow)==="Transport Application"?J({tid:e==null?void 0:e.transportId,sid:_,id:(d=e==null?void 0:e.install)==null?void 0:d.instituteId,remain_data:{...r,type:(g=e==null?void 0:e.install)==null?void 0:g.installmentValue,rid:e==null?void 0:e.rid}}).then(u=>{u.data.paid&&(s(),h(),y(!1),f(!1))}).catch({}):(e==null?void 0:e.collectFlow)==="Hostel Application"?O({hid:e==null?void 0:e.hostelId,sid:_,appId:(c=e==null?void 0:e.install)==null?void 0:c.appId,receipt_status:r.fee_payment_mode==="Fee Receipt Not Generated"?"Fee Receipt Not Generated":"",remain_data:{...r,type:(F=e==null?void 0:e.install)==null?void 0:F.installmentValue}}).then(u=>{u.data.paid&&(s(),h(),y(!1),f(!1))}).catch({}):e!=null&&e.is_already_made?$({aid:A||(e==null?void 0:e.admissionId),sid:_,appId:(T=e==null?void 0:e.install)==null?void 0:T.appId,receipt_status:r.fee_payment_mode==="Fee Receipt Not Generated"?"Fee Receipt Not Generated":"",remain_data:{...r,type:(I=e==null?void 0:e.install)==null?void 0:I.installmentValue,remain_1:(E=e==null?void 0:e.install)==null?void 0:E._id,rid:e==null?void 0:e.rid}}).then(u=>{u.data.paid&&(s(),h(),y(!1),f(!1))}).catch({}):m({aid:A||(e==null?void 0:e.admissionId),sid:_,appId:(R=e==null?void 0:e.install)==null?void 0:R.appId,receipt_status:r.fee_payment_mode==="Fee Receipt Not Generated"?"Fee Receipt Not Generated":"",remain_data:{...r,type:(D=e==null?void 0:e.install)==null?void 0:D.installmentValue}}).then(u=>{u.data.paid&&(s(),h(),y(!1),f(!1))}).catch({}))}};return a.jsxs(a.Fragment,{children:[!B&&a.jsxs(Z,{open:U,onClose:()=>y(!1),children:[a.jsxs("div",{className:i.addDisplay,style:{width:"35rem"},children:[a.jsx("div",{className:i.title,children:(e==null?void 0:e.openAs)!=="REFUND"?p("collect_fees"):p("refund_amount")}),a.jsxs("div",{className:i.content,children:[(e==null?void 0:e.collectFlow)==="Transport Application"?null:a.jsxs("section",{className:i.admission_fees_amount,children:[a.jsx("h6",{children:p("applicable_amount")}),a.jsxs("h6",{children:[p("rs"),".",((C=e==null?void 0:e.feeStructure)==null?void 0:C.applicable_fees)??0]})]}),a.jsxs("section",{className:i.admission_fees_amount,children:[a.jsx("h6",{children:p("remaining_fees")}),a.jsxs("h6",{children:[p("rs"),".",(e==null?void 0:e.remainAmount)??0]})]}),a.jsx(de,{paymentHeadingPlaceholder:p("collect_fee_note"),paymentHeading:p("payment_type_mode"),onInputChange:j,errorShow:v.payment_type_mode,openAs:e==null?void 0:e.openAs,viewAs:L}),(e==null?void 0:e.openAs)==="REFUND"&&a.jsx(re,{selectLabel:p("payment_type"),value:r.mode?r.mode==="Online"?"By Bank":"By Cash":"",onClick:W,selectedValue:"Select Payment Type By Bank/By Cash",options:["By Bank","By Cash"],customLabelStyle:{marginTop:"7px",marginBottom:"7px",fontWeight:"400",fontSize:"12px",color:"rgba(18, 18, 18, 0.8)"},customListStyle:{maxHeight:"fit-content"}}),a.jsx(S,{labelText:p("amount"),name:"fee_payment_amount",type:"tel",value:r==null?void 0:r.fee_payment_amount,onChange:q,placeholder:p("please_enter_amount_paid"),errorShow:v.fee_payment_amount}),a.jsx(oe,{labelText:p("select_date_of_transaction"),placeholder:p("please_select_date"),name:"transaction_date",value:r.transaction_date,onDateFunction:Q,customStyleContainer:{position:"relative",marginTop:"0.5rem",marginBottom:"0.5rem"},datePickerPosition:{position:"relative",top:"-20rem"},customStyleLabel:{marginTop:"7px"},errorShow:v.transaction_date}),r.fee_payment_mode==="By Cash"||r.mode==="Offline"?"":a.jsxs(a.Fragment,{children:[a.jsx(S,{labelText:p("bank_name_collect"),name:"fee_bank_name",type:"tel",value:r.fee_bank_name,onChange:j,placeholder:p("please_enter_bank_name"),customStyleLabel:{marginTop:"7px",marginBottom:"7px"}}),a.jsx(S,{labelText:p("banke_holder_name"),name:"fee_bank_holder",type:"tel",value:r.fee_bank_holder,onChange:j,placeholder:p("please_enter_name_of_bank_holder"),customStyleLabel:{marginTop:"7px",marginBottom:"7px"}}),a.jsx(S,{labelText:p("cheque_dd_neft"),name:"fee_utr_reference",type:"tel",value:r.fee_utr_reference,onChange:j,placeholder:p("please_enter_utr_ref_number"),customStyleLabel:{marginTop:"7px",marginBottom:"7px"}})]}),a.jsx("div",{className:i.btn,onClick:Y,style:{marginTop:"1rem"},children:p("confirm")})]})]}),a.jsx(M,{msg:N.msg,run:N.run,setRun:()=>k({msg:"",run:!1}),postiton:"bottom",type:"error"})]}),B&&a.jsx(t,{})]})}export{je as default};
