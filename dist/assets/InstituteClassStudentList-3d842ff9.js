import{u as M,r as g,dC as Q,j as t,Q as U,n as V,L as Z,e as H}from"./index-731451a5.js";import{P as K}from"./PopupWrapper-ffbaef7a.js";import{s as L}from"./Funds.module-95df49a8.js";import{C as X}from"./index-43f19233.js";import{B as u}from"./BorderBottom-47800983.js";import{u as ee,s as S}from"./Catalog.module-33ea6d38.js";import{t as C}from"./Tile.module-64552da2.js";import{J as G}from"./JoinFormCalender-5158d888.js";import{u as ae}from"./class-api-ec8ace00.js";const me=({onClose:x,cid:y,className:D})=>{const{t:p}=M(),[R,j]=g.useState(!1),[b,l]=g.useState(!1),[v,w]=g.useState(!1),[P,a]=g.useState([]),[s,O]=g.useState(""),[h,F]=g.useState({startRange:"",endRange:""}),{daysInMonth:i,selectedDate:f,monthNames:$,getNextMonth:k,getPrevMonth:T}=ee(),[A]=Q();g.useEffect(()=>{v&&(document.getElementById("attendance_download_file").click(),w(!1),a([]),j(c=>!c))},[v]);const I=()=>{k()},W=()=>{T()},B=r=>{var c;if(s==="ALL"){let n={GRNO:"",RollNo:"",Name:"",Gender:"",[r.className]:"","Class Overall Percentage":""};for(let e of r==null?void 0:r.mapSubject)n[e.subjectName]="",n[`${e.subjectName} Overall Percentage`]="";return n["Overall Percentage"]="",(c=r==null?void 0:r.students)==null?void 0:c.map(e=>{var o;let d=0,m={...n};m.GRNO=(e==null?void 0:e.studentGRNO)??"N/A",m.RollNo=e==null?void 0:e.studentROLLNO,m.Name=`${(e==null?void 0:e.studentFirstName)+" "+(e==null?void 0:e.studentMiddleName)+" "+(e==null?void 0:e.studentLastName)}`,m.Gender=e==null?void 0:e.studentGender,m[e.className]=`${e.classWise.presentCount}/${e.classWise.totalCount}`,m["Class Overall Percentage"]=e.classWise.totalPercentage;for(let N of e==null?void 0:e.subjects)m[N.subjectName]=`${N.presentCount}/${N.totalCount}`,m[`${N.subjectName} Overall Percentage`]=N.totalPercentage,N.totalPercentage&&(d+=N.totalPercentage);return m["Overall Percentage"]=(d/((o=e==null?void 0:e.subjects)==null?void 0:o.length)).toFixed(2),m})}else{let n=new Date(`${i} ${$[f.getMonth()]} ${f.getFullYear()}`);return n=n.toISOString(),r==null?void 0:r.map(e=>{let d={};if(s==="RANGE")for(let o=1;o<=i;o++)d[`${o}/${n.substring(5,7)}/${n.substring(0,4)}`]="";else if(s==="All")for(let o=1;o<=i;o++)d[`${o}/${n.substring(5,7)}/${n.substring(0,4)}`]="";else for(let o=1;o<=i;o++)o<10?d[`0${o}/${n.substring(5,7)}/${n.substring(0,4)}`]="":d[`${o}/${n.substring(5,7)}/${n.substring(0,4)}`]="";for(let o of e==null?void 0:e.availablity)d[`${o==null?void 0:o.date}`]=o==null?void 0:o.status;return{GRNO:(e==null?void 0:e.studentGRNO)??"N/A",RollNo:e==null?void 0:e.studentROLLNO,Name:(e==null?void 0:e.studentFirstName)+" "+(e==null?void 0:e.studentMiddleName)+" "+(e==null?void 0:e.studentLastName),Gender:e==null?void 0:e.studentGender,...d}})}},E=r=>{O(r)},Y=r=>{const c={};for(let n in r)r[n]||(c[n]=`${n} is required!`);return c},q=()=>{let r=!1,c="";if(s==="RANGE"){c=Y(h);for(let n in c)if(n){r=!0;break}}else r=!1;if(r)l(c);else{j(_=>!_);let n=new Date(`${i} ${$[f.getMonth()]} ${f.getFullYear()}`);n=n.toISOString(),A({cid:y,is_type:s,month:`${n.substring(5,7)}`,year:`${n.substring(0,4)}`,zipData:h}).then(async _=>{var d;let e=await B((d=_.data)==null?void 0:d.attendance_zip);a(()=>e),w(!0)}).catch(()=>{})}},z=r=>{F(c=>({...c,startRange:r}))},J=r=>{F(c=>({...c,endRange:r}))};return t.jsxs(K,{onClose:x,children:[t.jsxs("div",{className:L.filter_container,style:{minHeight:"15rem"},children:[t.jsx("h6",{className:L.filter_title,children:p("filter_and_export_student_attendance")}),t.jsx(u,{customStyle:{width:"100%"}}),t.jsxs("section",{className:C.tile_tile_container,style:{marginTop:"1rem"},children:[t.jsx("div",{className:s===""?C.tile_tile_active:C.tile_tile,onClick:()=>E(""),children:p("month")}),t.jsx("div",{className:s==="ALL"?C.tile_tile_active:C.tile_tile,onClick:()=>E("ALL"),children:p("all")})]}),s?s==="ALL"?null:t.jsxs(t.Fragment,{children:[t.jsx(G,{labelText:p("filter_from"),placeholder:p("select_date"),name:"from",value:h.startRange,onDateFunction:z,errorShow:b.startRange,customStyleContainer:{position:"relative",width:"100%"},datePickerPosition:{top:"-1rem"}}),t.jsx(G,{labelText:p("filter_to"),placeholder:p("select_date"),name:"to",value:h.endRange,onDateFunction:J,errorShow:b.endRange,customStyleContainer:{position:"relative",width:"100%"},datePickerPosition:{top:"-1rem",left:"-7rem"}})]}):t.jsxs("section",{className:L.fees_head_title,children:[t.jsx("img",{src:"/images/members/back-icon-white.svg",style:{cursor:"pointer"},onClick:W}),t.jsxs("h6",{className:`${L.yearmonth}`,children:[`${$[f.getMonth()]}`," ",`${f.getFullYear()}`]}),t.jsx("img",{src:"/images/members/forward-icon-white.svg",style:{cursor:"pointer"},onClick:I})]}),t.jsx("button",{className:L.next_btn,onClick:q,style:{marginTop:"3rem"},children:p("export_data")}),t.jsx(X,{data:P,filename:`${D}`,id:"attendance_download_file"})]}),R&&t.jsx(U,{})]})},pe=({cid:x,openAs:y,isDepartment:D})=>{var P;const p=V(),{t:R}=M(),[j,b]=g.useState([]),{classAllStudent:l,classAllStudentRefetch:v}=ae({data:{cid:x,page:1,limit:30},skip:!x});g.useEffect(()=>{x&&v()},[x,v]),g.useEffect(()=>{var a,s;(a=l==null?void 0:l.classes)!=null&&a.ApproveStudent&&b((s=l==null?void 0:l.classes)==null?void 0:s.ApproveStudent)},[(P=l==null?void 0:l.classes)==null?void 0:P.ApproveStudent]);const w=a=>{var s,O,h;if(a.target.value){const F=(O=(s=l==null?void 0:l.classes)==null?void 0:s.ApproveStudent)==null?void 0:O.filter(i=>{var f,$,k;return(k=(f=`${i==null?void 0:i.studentFirstName} ${i!=null&&i.studentMiddleName?(i==null?void 0:i.studentMiddleName)+" ":""}${i==null?void 0:i.studentLastName}`)==null?void 0:f.toLowerCase())!=null&&k.includes(($=a.target.value)==null?void 0:$.toLowerCase())?i:null});b(F)}else b((h=l==null?void 0:l.classes)==null?void 0:h.ApproveStudent)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:S.catalog,style:{border:D?"none":"0.5px solid #cacaca"},children:[t.jsx("div",{className:S.searchContainerr,children:t.jsxs("div",{className:S.searchContainer,style:{width:"100%"},children:[t.jsx("img",{alt:"",src:"/images/search-dept-icon.svg"}),t.jsx("input",{type:"text",placeholder:R("search-label"),onChange:w})]})}),t.jsx("div",{className:S.itemsContainer,children:j==null?void 0:j.map(a=>t.jsx(Z,{to:`/q/${p.username}/student/profile`,state:{sid:a==null?void 0:a._id,viewAs:y||"INSTITUTE"},children:t.jsxs("div",{className:S.item,children:[t.jsx("p",{children:a==null?void 0:a.studentROLLNO}),t.jsx("img",{alt:"",src:a!=null&&a.studentProfilePhoto?`${H}/${a==null?void 0:a.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg"}),t.jsxs("div",{children:[t.jsxs("p",{children:[a==null?void 0:a.studentFirstName," ",a!=null&&a.studentMiddleName?a==null?void 0:a.studentMiddleName:" "," ",a==null?void 0:a.studentLastName]}),t.jsxs("p",{style:{marginTop:"0.3rem"},children:[R("gr_number")," ",(a==null?void 0:a.studentGRNO)??""]})]})]})}))})]})})};export{me as E,pe as I};
