import{u as A,n as ee,j as s,L as se,e as X,r as x,S as H,Q as q,R as K}from"./index-0ca76035.js";import{s as a}from"./PromoteDepartment.module-1bdd3b1d.js";import{a3 as ne,a4 as Z,a5 as P}from"./department-api-e4b13f05.js";import{_ as le,$ as ie,a0 as ce}from"./class-api-bd140bb6.js";import{C as G}from"./CustomSelectDepartment-11201deb.js";import{B as O}from"./BorderBottom-1dc6f53e.js";import{P as Q}from"./PopupWrapper-2578092d.js";import{s as $}from"./AdmissionApplicationRequest.module-43e4e129.js";import{C as Y}from"./CustomNormalSelectInput-0a62fa3f.js";const te=({stu:n,viewAs:e})=>{var j,r;const{t:h}=A(),d=ee();return s.jsx(se,{to:`/q/${d.username}/student/profile`,state:{sid:n==null?void 0:n._id,viewAs:"SUBJECT_TEACHER"},children:s.jsxs("div",{className:a.student_container,children:[s.jsx("img",{src:n!=null&&n.studentProfilePhoto?`${X}/${n==null?void 0:n.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",loading:"lazy",alt:"avatar icon"}),s.jsxs("div",{className:a.student_info_container,children:[s.jsxs("div",{className:a.student_info_text,children:[s.jsxs("h6",{children:[n==null?void 0:n.studentFirstName," ",n!=null&&n.studentMiddleName?n==null?void 0:n.studentMiddleName:" "," ",n==null?void 0:n.studentLastName]}),e==="PROMOTE"?"":s.jsxs("p",{children:[(n==null?void 0:n.studentGender)??""," "]})]}),s.jsx("div",{className:a.student_info_text,children:e==="PROMOTE"?s.jsxs("p",{children:[h("classes"),": ",`${((j=n==null?void 0:n.studentClass)==null?void 0:j.className)??""} - ${((r=n==null?void 0:n.studentClass)==null?void 0:r.classTitle)??""}`]}):s.jsxs(s.Fragment,{children:[s.jsxs("p",{children:[h("roll_number")," ",(n==null?void 0:n.studentROLLNO)??""]}),s.jsxs("p",{children:[h("gr_number"),(n==null?void 0:n.studentGRNO)??""]})]})})]})]})})},B=({onSelectStudent:n,stu:e,promoteData:h})=>{var j,r,l,_,o,g;const{t:d}=A();return s.jsx("div",{className:(j=h==null?void 0:h.students)!=null&&j.includes(e==null?void 0:e._id)?` ${a.promote_student_card} ${a.promote_student_cardActive}`:a.promote_student_card,onClick:()=>n(e==null?void 0:e._id),style:{width:"100%"},children:s.jsxs("div",{className:a.promote_student_card_text,style:{width:"100%"},children:[s.jsx("img",{alt:"",src:e!=null&&e.studentProfilePhoto?`${X}/${e==null?void 0:e.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg"}),s.jsxs("div",{className:a.promote_student_check_container,children:[s.jsxs("div",{className:a.promote_student_name,children:[s.jsxs("p",{children:[e==null?void 0:e.studentFirstName," ",e!=null&&e.studentMiddleName?e==null?void 0:e.studentMiddleName:" "," ",e==null?void 0:e.studentLastName]}),s.jsxs("p",{children:[d("gr_number"),e==null?void 0:e.studentGRNO]})]}),s.jsxs("div",{className:a.promote_student_check,children:[s.jsxs("div",{className:a.promote_student_name,children:[(r=e==null?void 0:e.fee_structure)!=null&&r.applicable_fees?s.jsxs("p",{children:[d("applicable_fees_only")," ",d("rs"),".",((l=e==null?void 0:e.fee_structure)==null?void 0:l.applicable_fees)??0]}):"",s.jsxs("p",{children:[d("paid_fees")," ",": ",d("rs"),".",((o=(_=e==null?void 0:e.remainingFeeList)==null?void 0:_[0])==null?void 0:o.paid_fee)??0]})]}),s.jsx("div",{className:a.promote_student_name,children:(g=h==null?void 0:h.students)!=null&&g.includes(e==null?void 0:e._id)?s.jsx("img",{className:a.department_checkbox,src:"/images/checkbox-icon.svg",alt:"icon"}):s.jsx("img",{className:a.department_checkbox,src:"/images/box-icon.svg",alt:"icon"})})]})]})]})})},D=({isWrapper:n,onClose:e,title:h,firstMessage:d,spanMessage:j,outerSpanMessage:r,lastMessage:l,buttonLabel:_,onHandler:o,buttonStyle:g,messageStyle:w})=>s.jsx(s.Fragment,{children:n?s.jsx(Q,{onClose:e,children:s.jsxs("div",{className:$.admission_modal,children:[s.jsx("h6",{className:$.admission_modal_heading,children:h}),s.jsx(O,{customStyle:{width:"100%",margin:"0.7rem 0"}}),s.jsxs("div",{className:$.admission_class_confirm,style:w,children:[d," ",s.jsx("span",{style:{fontWeight:"600"},children:j})," ",r,s.jsx("span",{style:{fontWeight:"600"},children:l})]}),s.jsx("div",{className:$.confirm_btn,onClick:o,style:g,children:_})]})}):s.jsxs(s.Fragment,{children:[s.jsx("h6",{className:$.admission_modal_heading,children:h}),s.jsx(O,{customStyle:{width:"100%",margin:"0.7rem 0"}}),s.jsxs("div",{className:$.admission_class_confirm,style:w,children:[d," ",s.jsx("span",{style:{fontWeight:"600"},children:j})," ",r,s.jsx("span",{style:{fontWeight:"600"},children:l})]}),s.jsx("div",{className:$.confirm_btn,onClick:o,style:g,children:_})]})}),de=({classId:n,promoteData:e,setPromoteData:h,onClose:d,onRefetchParent:j})=>{var I,R,f,c,u,E;const{t:r}=A(),[l,_]=x.useState(!0),[o,g]=x.useState([]),[w,C]=x.useState(!1),[p,m]=x.useState(!1),[k,L]=x.useState(!1),[T]=le(),{getNotPromoteStudentByPromote:i,getNotPromoteStudentByPromoteRefetch:N}=ne({data:{cid:n,valid_app_fee:(e==null?void 0:e.applicable_with_fees)==="Yes"?"Yes":"No"},skip:!n});x.useEffect(()=>{n&&(_(!0),N())},[n,N]),x.useEffect(()=>{var t;(i!=null&&i.notPromoteStudent||((t=i==null?void 0:i.notPromoteStudent)==null?void 0:t.length)===0)&&(g((i==null?void 0:i.notPromoteStudent)??[]),_(!1))},[i==null?void 0:i.notPromoteStudent]);const U=t=>{var b;if(t.target.value){const v=(b=i==null?void 0:i.notPromoteStudent)==null?void 0:b.filter(S=>{var V,z,J;return(J=(V=`${S==null?void 0:S.studentFirstName} ${S!=null&&S.studentMiddleName?(S==null?void 0:S.studentMiddleName)+" ":""}${S==null?void 0:S.studentLastName}`)==null?void 0:V.toLowerCase())!=null&&J.includes((z=t.target.value)==null?void 0:z.toLowerCase())?S:null});g(v)}else g(i==null?void 0:i.notPromoteStudent)},y=t=>{var b;(b=e==null?void 0:e.students)!=null&&b.includes(t)?h(v=>{var S;return{...v,students:(S=v.students)==null?void 0:S.filter(V=>V!==t)}}):h(v=>({...v,students:v.students?[...v.students,t]:[t]}))},W=()=>{let t=[];for(let b of o)t.push(b==null?void 0:b._id);h(b=>({...b,students:t})),L(!0)},F=()=>{h(t=>({...t,students:[]})),L(!1)},M=()=>{var t,b,v;n&&(m(!1),C(S=>!S),T({cid:n,promote:{applicable_with_fees:e==null?void 0:e.applicable_with_fees,departmentId:(t=e==null?void 0:e.departmentId)==null?void 0:t._id,batchId:(b=e==null?void 0:e.batchId)==null?void 0:b._id,classId:(v=e==null?void 0:e.classId)==null?void 0:v._id,students:e==null?void 0:e.students},flow:(e==null?void 0:e.promot_with_fees)==="Yes"?"WITH_STRUCTURE":"WITH_OUT_STRUCTURE",re_ads:(e==null?void 0:e.re_ads)==="Yes"?"WITH_RE_ADMISSION":"No"}).then(()=>{j(),N(),d(),C(S=>!S)}).catch({}))};return s.jsx(s.Fragment,{children:p?s.jsx(D,{onClose:()=>m(!1),title:r("promote_select_student"),firstMessage:`${r("promote")} `,spanMessage:(I=e==null?void 0:e.students)==null?void 0:I.length,outerSpanMessage:`${r("students")} , ${r("to")} `,lastMessage:`${(R=e==null?void 0:e.classId)==null?void 0:R.classTitle}, ${(f=e==null?void 0:e.batchId)==null?void 0:f.batchName}, ${(c=e==null?void 0:e.departmentId)==null?void 0:c.dName}`,buttonLabel:r("confirm"),onHandler:M,messageStyle:{marginTop:"3.7rem"},buttonStyle:{marginTop:"5.7rem"}}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a.select_header,children:[s.jsxs("h6",{children:[((u=e==null?void 0:e.students)==null?void 0:u.length)>0?`${(E=e==null?void 0:e.students)==null?void 0:E.length} `:"",r("select_student")]}),s.jsxs("div",{children:[k?s.jsx("button",{className:a.select_all_btn,title:"Remove All Student",onClick:F,style:{marginRight:"0.7rem"},children:r("remove_all")}):s.jsx("button",{className:a.select_all_btn,title:"Select All Student",onClick:W,style:{marginRight:"0.7rem"},children:r("select_all")}),s.jsx("button",{className:a.promote_all_btn,title:"Promote Selected Student",onClick:()=>{var t;return((t=e==null?void 0:e.students)==null?void 0:t.length)>0?m(!0):null},children:r("promote")})]})]}),s.jsx(O,{customStyle:{width:"100%",marginTop:"0.5rem"}}),s.jsx("div",{className:a.with_search,style:{marginTop:"1rem",width:"100%",border:"0.4px solid rgba(0, 0, 0, 0.15)",borderRadius:"6px",marginBottom:"0.3rem"},children:s.jsxs("div",{className:a.search_container_input,style:{width:"100%"},children:[s.jsx("img",{className:a.searchIcon,alt:"search icon",src:"/images/search-dash-icon.svg"}),s.jsx("input",{type:"text",placeholder:"Search Student...",style:{width:"100%"},onChange:U})]})}),o==null?void 0:o.map((t,b)=>s.jsx(B,{promoteData:e,stu:t,onSelectStudent:y},b)),l&&s.jsx(H,{}),w&&s.jsx(q,{})]})})},re=({onClose:n,classId:e,onRefetchParent:h})=>{var F,M,I,R;const{t:d}=A(),[j,r]=x.useState("INITIAL_STEP"),[l,_]=x.useState({promot_with_fees:"",applicable_with_fees:"",departmentId:"",batchId:"",classId:"",students:[],re_ads:""}),[o,g]=x.useState(""),{classAllDepartmentWithBatch:w,classAllDepartmentWithBatchRefetch:C}=ie({data:{cid:e,page:1,limit:30},skip:!e}),{classAllBatchWithClass:p,classAllBatchWithClassRefetch:m}=ce({data:{bid:(F=l.batchId)==null?void 0:F._id,page:1,limit:30},skip:!((M=l.batchId)!=null&&M._id)});K.useEffect(()=>{e&&C()},[e,C]),K.useEffect(()=>{var f;(f=l.batchId)!=null&&f._id&&m()},[(I=l.batchId)==null?void 0:I._id,m]);const k=f=>{_(c=>({...c,departmentId:f}))},L=f=>{_(c=>({...c,batchId:f}))},T=f=>{_(c=>({...c,classId:f}))},i=f=>{_(c=>({...c,promot_with_fees:f}))},N=f=>{_(c=>({...c,applicable_with_fees:f}))},U=f=>{_(c=>({...c,re_ads:f}))},y=f=>{const c={};for(let u in f)u==="students"||f[u]||(c[u]=`${u} is required!`);return c},W=()=>{const f=y(l);let c=!1;for(let u in f){c=!0;break}c?g(f):r("SELECT_STUDENT")};return s.jsx(Q,{onClose:j==="INITIAL_STEP"?n:()=>r("INITIAL_STEP"),children:s.jsxs("div",{className:a.promote_container,children:[j==="INITIAL_STEP"&&s.jsxs(s.Fragment,{children:[s.jsx("h6",{style:{textAlign:"center"},children:d("promote_students")}),s.jsx(O,{customStyle:{width:"100%"}}),s.jsx(Y,{selectLabel:d("promote_with_fees_structure"),selectedValue:d("select_yes_or_no"),options:["Yes","No"],value:l.promot_with_fees,errorShow:o.promot_with_fees,onClick:i}),s.jsx(G,{selectLabel:d("select_department"),selectedValue:d("select_department"),options:(w==null?void 0:w.departmets)??[],onClick:k,openAs:"PROMOTE",errorShow:o.departmentId}),s.jsx(G,{selectLabel:d("select_batch"),selectedValue:d("select_batch"),options:((R=l.departmentId)==null?void 0:R.batches)??[],onClick:L,openAs:"PROMOTE",errorShow:o.batchId}),s.jsx(G,{selectLabel:d("select_class"),selectedValue:d("select_class"),options:(p==null?void 0:p.classes)??[],onClick:T,openAs:"PROMOTE",errorShow:o.classId}),s.jsx(Y,{selectLabel:d("promote_applicable_fee"),selectedValue:d("select_yes_or_no"),options:["Yes","No"],value:l.applicable_with_fees,errorShow:o.applicable_with_fees,onClick:N}),s.jsx(Y,{selectLabel:d("promote_with_re_admission"),selectedValue:d("select_yes_or_no"),options:["Yes","No"],value:l.re_ads,onClick:U}),s.jsxs("button",{className:a.select_application_btn,onClick:W,style:{width:"100%"},title:"Select student",children:[s.jsx("div",{children:d("select_student")}),s.jsx("img",{src:"/images/forward-right-icon.svg",alt:"next step"})]})]}),j==="SELECT_STUDENT"&&s.jsx(de,{classId:e,setPromoteData:_,promoteData:l,onClose:n,onRefetchParent:h})]})})},ae=({classId:n,promoteData:e,setPromoteData:h,onClose:d,onRefetchParent:j})=>{var I,R,f;const{t:r}=A(),[l,_]=x.useState(!0),[o,g]=x.useState([]),[w,C]=x.useState(!1),[p,m]=x.useState(!1),[k,L]=x.useState(!1),[T]=Z(),{getPromoteStudentByPromote:i,getPromoteStudentByPromoteRefetch:N}=P({cid:n,skip:!n});x.useEffect(()=>{n&&(_(!0),N())},[n,N]),x.useEffect(()=>{var c;(i!=null&&i.promoteStudent||((c=i==null?void 0:i.promoteStudent)==null?void 0:c.length)===0)&&(g((i==null?void 0:i.promoteStudent)??[]),_(!1))},[i==null?void 0:i.promoteStudent]);const U=c=>{var u;if(c.target.value){const E=(u=i==null?void 0:i.promoteStudent)==null?void 0:u.filter(t=>{var b,v,S;return(S=(b=`${t==null?void 0:t.studentFirstName} ${t!=null&&t.studentMiddleName?(t==null?void 0:t.studentMiddleName)+" ":""}${t==null?void 0:t.studentLastName}`)==null?void 0:b.toLowerCase())!=null&&S.includes((v=c.target.value)==null?void 0:v.toLowerCase())?t:null});g(E)}else g(i==null?void 0:i.promoteStudent)},y=c=>{var u;(u=e==null?void 0:e.arr)!=null&&u.includes(c)?h(E=>{var t;return{...E,arr:(t=E.arr)==null?void 0:t.filter(b=>b!==c)}}):h(E=>({...E,arr:E.arr?[...E.arr,c]:[c]}))},W=()=>{let c=[];for(let u of o)c.push(u==null?void 0:u._id);h(u=>({...u,arr:c})),L(!0)},F=()=>{h(c=>({...c,arr:[]})),L(!1)},M=()=>{m(!1),C(c=>!c),T({cid:n,flow:"PARTICULAR_STUDENT",undoPromote:{arr:e==null?void 0:e.arr}}).then(()=>{j(),d(),C(c=>!c)}).catch({})};return s.jsx(s.Fragment,{children:p?s.jsx(D,{onClose:()=>m(!1),title:r("undo_select_student"),firstMessage:`${r("undo")} `,spanMessage:(I=e==null?void 0:e.arr)==null?void 0:I.length,outerSpanMessage:`${r("students")} , ${r("to")} `,lastMessage:`${r("previous_class")}`,buttonLabel:r("confirm"),onHandler:M,messageStyle:{marginTop:"3.7rem"},buttonStyle:{marginTop:"5.7rem"}}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a.select_header,children:[s.jsxs("h6",{children:[((R=e==null?void 0:e.arr)==null?void 0:R.length)>0?`${(f=e==null?void 0:e.arr)==null?void 0:f.length} `:"",r("select_student")]}),s.jsxs("div",{children:[k?s.jsx("button",{className:a.select_all_btn,title:"Remove All Student",onClick:F,style:{marginRight:"0.7rem"},children:r("remove_all")}):s.jsx("button",{className:a.select_all_btn,title:"Select All Student",onClick:W,style:{marginRight:"0.7rem"},children:r("select_all")}),s.jsx("button",{className:a.promote_all_btn,title:"Undo Selected Student",onClick:()=>{var c;return((c=e==null?void 0:e.arr)==null?void 0:c.length)>0?m(!0):null},children:r("undo")})]})]}),s.jsx(O,{customStyle:{width:"100%",marginTop:"0.5rem"}}),s.jsx("div",{className:a.with_search,style:{marginTop:"1rem",width:"100%",border:"0.4px solid rgba(0, 0, 0, 0.15)",borderRadius:"6px",marginBottom:"0.3rem"},children:s.jsxs("div",{className:a.search_container_input,style:{width:"100%"},children:[s.jsx("img",{className:a.searchIcon,alt:"search icon",src:"/images/search-dash-icon.svg"}),s.jsx("input",{type:"text",placeholder:"Search Student...",style:{width:"100%"},onChange:U})]})}),o==null?void 0:o.map((c,u)=>s.jsx(B,{promoteData:{students:e==null?void 0:e.arr},stu:c,onSelectStudent:y},u)),l&&s.jsx(H,{}),w&&s.jsx(q,{})]})})},he=({onClose:n,classId:e,onRefetchParent:h})=>{const{t:d}=A(),[j,r]=x.useState("INITIAL_STEP"),[l,_]=x.useState({flow:"",arr:[]}),[o,g]=x.useState(""),[w,C]=x.useState(!1),[p]=Z(),m=T=>{_(i=>({...i,flow:T}))},k=T=>{const i={};for(let N in T)N==="students"||T[N]||(i[N]=`${N} is required!`);return i},L=()=>{const T=k(l);let i=!1;for(let N in T){i=!0;break}i?g(T):l.flow==="Full Class"?(C(N=>!N),p({cid:e,flow:"FULL_CLASS",undoPromote:{arr:[]}}).then(()=>{h(),n(),C(N=>!N)}).catch({})):l.flow==="Particular Student"&&r("SELECT_STUDENT")};return s.jsx(s.Fragment,{children:s.jsx(Q,{onClose:j==="INITIAL_STEP"?n:()=>r("INITIAL_STEP"),children:s.jsxs("div",{className:a.promote_container,children:[j==="INITIAL_STEP"&&s.jsxs(s.Fragment,{children:[s.jsx("h6",{style:{textAlign:"center"},children:d("promote_students")}),s.jsx(O,{customStyle:{width:"100%"}}),s.jsx(Y,{selectLabel:d("undo_promote_student"),selectedValue:d("select_full_or_particular"),options:["Full Class","Particular Student"],value:l.flow,errorShow:o.flow,onClick:m}),s.jsx("button",{className:a.select_application_btn,onClick:L,style:{width:"100%",justifyContent:"center",marginTop:"4rem"},children:s.jsx("div",{children:d(l.flow==="Particular Student"?"next":"confirm")})})]}),j==="SELECT_STUDENT"&&s.jsx(ae,{classId:e,setPromoteData:_,promoteData:l,onClose:n,onRefetchParent:h}),w&&s.jsx(q,{})]})})})},_e=({cid:n,onRefetch:e})=>{const{t:h}=A(),[d,j]=x.useState(!1),r=l=>{l.stopPropagation(),j(_=>!_)};return s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:a.select_application_btn,onClick:r,title:"Undo Promote Studens",style:{width:"25%"},children:[s.jsx("div",{children:h("undo_student")}),s.jsx("img",{src:"/images/member_tab/admission/admission-undo-icon.svg",alt:"undo icon",style:{cursor:"pointer",width:"30px"}})]}),d&&s.jsx(he,{onClose:()=>j(!1),classId:n,onRefetchParent:e})]})},Ne=({classId:n})=>{var g,w,C,p;const{t:e}=A(),[h,d]=x.useState(!0),[j,r]=x.useState(!1),{getPromoteStudentByPromote:l,getPromoteStudentByPromoteRefetch:_}=P({cid:n,skip:!n});x.useEffect(()=>{n&&(d(!0),_())},[n,_]),x.useEffect(()=>{var m;(l!=null&&l.promoteStudent||((m=l==null?void 0:l.promoteStudent)==null?void 0:m.length)===0)&&d(!1)},[l==null?void 0:l.promoteStudent]);const o=()=>{r(m=>!m)};return s.jsxs("div",{children:[s.jsxs("div",{className:a.promote_undo_container,children:[s.jsxs("button",{className:a.select_application_btn,onClick:o,children:[s.jsx("div",{children:e("promote_student")}),s.jsx("img",{src:"/images/forward-right-icon.svg",alt:"next step"})]}),s.jsx(_e,{cid:n,onRefetch:_})]}),s.jsxs("h6",{className:a.total_student_count,children:[e("total_student")," ",((g=l==null?void 0:l.count)==null?void 0:g.totalCount)??0]}),s.jsxs("div",{className:a.total_other_count_container,children:[s.jsxs("p",{children:[e("boys_promote"),((w=l==null?void 0:l.count)==null?void 0:w.boyCount)??0]}),s.jsxs("p",{children:[e("girl_promote"),((C=l==null?void 0:l.count)==null?void 0:C.girlCount)??0]})]}),(p=l==null?void 0:l.promoteStudent)==null?void 0:p.map(m=>s.jsx(te,{stu:m,viewAs:"PROMOTE"},m==null?void 0:m._id)),h&&s.jsx(H,{}),j&&s.jsx(re,{classId:n,onClose:o,onRefetchParent:_})]})};export{Ne as P,te as S};
