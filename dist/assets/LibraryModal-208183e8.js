import{u as W,r as f,k as z,t as G,g as J,aQ as K,q as X,c as Y,j as e,D as Z,e as M,bp as O}from"./index-731451a5.js";import{s as o}from"./LibraryModal.module-13078745.js";import{i as b,a as ss}from"./library-api-ded81710.js";import{B as es}from"./ButtonWithAction-805b1066.js";import{D as L}from"./Divider-6278282f.js";import"./LoaderButton-71df50a7.js";function R({img:d,photoId:h,name:m,index:t,setIndex:p,assignAdmissionHead:i}){const g=()=>{i(),p(t)};return e.jsxs("div",{className:o.sidebarbottomitem,onClick:g,children:[e.jsx("img",{alt:"not found",src:h!=="1"?`${M}/${d}`:"/images/member_tab/class/default_avatar.svg"}),e.jsxs("div",{children:[e.jsx("p",{className:o.namee,children:m}),e.jsx("p",{className:o.desig,children:t})]})]})}function ns({libraryModal:d,hideModal:h,edit:m,librarian:t,onParentRefetch:p}){const{t:i}=W(),[g,r]=f.useState(!1),a=z(s=>s.idChange),[D,E]=f.useState(!1),[F,H]=f.useState(!1),[N,w]=f.useState(1),[n,Q]=f.useState([]),[ts,P]=G(),[T]=b(),[B]=ss(),A=J(),{data:x,refetch:S}=K({id:a==null?void 0:a.id,page:N,limit:10},{skip:!(a!=null&&a.id)});f.useEffect(()=>{a!=null&&a.id&&S()},[a==null?void 0:a.id,S]);const{oneInstituteDashboard:j,oneInstituteDashboardRefetch:k}=X({id:a==null?void 0:a.id},{skip:!(a!=null&&a.id)});f.useEffect(()=>{a!=null&&a.id&&k()},[a==null?void 0:a.id,k]),f.useEffect(()=>{x&&(x.staffIns?Q([...n,...x.staffIns]):N>1&&E(!0))},[x]),f.useEffect(()=>{P&&(D||w(N+1))},[P]),f.useEffect(()=>{setTimeout(()=>{H(!F)},3e3)},[]);const q=Y(),[u,v]=f.useState(!1),[y,$]=f.useState(!1),[c,_]=f.useState({sid:"",name:"",index:"",photoId:"",profilePhoto:""}),V=()=>{(a==null?void 0:a.id)!==""&&(r(!0),T({activate:{sid:(c==null?void 0:c.sid)??""},id:a==null?void 0:a.id}).then(s=>{var l,C;s.data.status&&(r(!1),A(O.libraryQuery({lid:(l=s.data)==null?void 0:l.library,lhead:c.sid})),q(`/q/${(C=j==null?void 0:j.institute)==null?void 0:C.name}/library`))}))},U=()=>{c.sid&&(t!=null&&t._id)&&(r(!0),B({osid:t==null?void 0:t._id,nsid:c.sid}).then(s=>{var l;A(O.libraryQuery({lid:(l=s.data)==null?void 0:l.library,lhead:c.sid})),p(),_({...c,sid:""}),$(!y),v(!u),r(!1),h()}))},I=n==null?void 0:n.filter(s=>(s==null?void 0:s._id)!==(t==null?void 0:t._id));return e.jsx(Z,{open:d,onClose:()=>h(!1),children:e.jsxs("div",{className:o.admissionModal,children:[e.jsxs("div",{className:o.admissionModalhead,children:[e.jsx("h6",{children:i(m?"edit_library":"activate_library")}),e.jsx("img",{onClick:()=>h(!1),src:"/images/close-post-icon.svg",alt:""})]}),e.jsx(L,{}),e.jsxs("div",{className:o.admissionModalbody,children:[!u&&!m&&e.jsxs("div",{className:o.assignDesignation,onClick:()=>v(!0),children:[e.jsx("img",{className:o.assignManager,src:"/images/sports/avatar-circle.svg",alt:""}),e.jsxs("div",{children:[e.jsx("h6",{children:i("assign_lib_head")}),e.jsx("p",{children:i("search_from_joined_list")})]})]}),!u&&m&&e.jsxs("div",{className:o.sidebarbottomitem,onClick:()=>v(!0),children:[e.jsx("img",{alt:"not found",src:(t==null?void 0:t.photoId)!=="1"?`${M}/${t==null?void 0:t.staffProfilePhoto}`:"/images/member_tab/class/default_avatar.svg"}),e.jsxs("div",{children:[e.jsx("p",{className:o.namee,children:`${(t==null?void 0:t.staffFirstName)||""} ${t!=null&&t.staffMiddleName?t==null?void 0:t.staffMiddleName:""} ${(t==null?void 0:t.staffLastName)||""}`}),e.jsxs("p",{className:o.desig,children:[" ",i("index_no")," ",t==null?void 0:t.index]})]})]}),u&&!y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:o.searchbar,children:[e.jsx("input",{type:"text",placeholder:i("search"),className:`form-control ${o.searchinput}`}),e.jsx("img",{className:o.searchIcon,alt:"img",src:"/images/search-dash-icon.svg"})]}),e.jsx("div",{className:o.items,children:m?I==null?void 0:I.map(s=>e.jsxs(e.Fragment,{children:[e.jsx(R,{img:s.staffProfilePhoto,photoId:s.photoId,name:`${s.staffFirstName} ${s.staffMiddleName?s.staffMiddleName:""} ${s.staffLastName}`,index:s.staffROLLNO,setIndex:l=>$(!0),assignAdmissionHead:()=>{_({...c,sid:s==null?void 0:s._id,name:`${s==null?void 0:s.staffFirstName} ${s!=null&&s.staffMiddleName?s==null?void 0:s.staffMiddleName:""} ${s==null?void 0:s.staffLastName}`,index:s==null?void 0:s.staffROLLNO,photoId:s==null?void 0:s.photoId,profilePhoto:s==null?void 0:s.staffProfilePhoto})}}),e.jsx(L,{})]})):n==null?void 0:n.map(s=>e.jsxs(e.Fragment,{children:[e.jsx(R,{img:s.staffProfilePhoto,photoId:s.photoId,name:`${s.staffFirstName} ${s.staffMiddleName?s.staffMiddleName:""} ${s.staffLastName}`,index:s.staffROLLNO,setIndex:l=>$(!0),assignAdmissionHead:()=>{_({...c,sid:s==null?void 0:s._id,name:`${s==null?void 0:s.staffFirstName} ${s!=null&&s.staffMiddleName?s==null?void 0:s.staffMiddleName:""} ${s==null?void 0:s.staffLastName}`,index:s==null?void 0:s.staffROLLNO,photoId:s==null?void 0:s.photoId,profilePhoto:s==null?void 0:s.staffProfilePhoto})}}),e.jsx(L,{})]}))})]}),u&&y&&e.jsxs("div",{className:o.sidebarbottomitem,children:[e.jsx("img",{alt:"not found",src:c.photoId!=="1"?`${M}/${c.profilePhoto}`:"/images/member_tab/class/default_avatar.svg"}),e.jsxs("div",{children:[e.jsx("p",{className:o.namee,children:c.name}),e.jsxs("p",{className:o.desig,children:["Index No. ",c.index]})]})]})]}),e.jsx("div",{className:o.admissionModalfooter,children:e.jsx("div",{children:e.jsx(es,{disabled:g,shwoLoader:!0,buttonText:i(m?"edit_":"activate"),customStyleButton:{minHeight:"2rem",marginTop:"0rem"},onAction:m?U:V})})})]})})}export{ns as default};
