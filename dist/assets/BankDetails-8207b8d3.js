import{u as ne,r as d,ac as fe,j as e,k as _e,W as ue,Q as de,c as ie,d as be,e as he,N as pe,v as xe}from"./index-0ca76035.js";import{K as je,u as ke,L as ge,M as Se,N as we,O as Te,l as Ce,m as Ne}from"./finance-api-e818490b.js";import{J as ve}from"./JoinFormFile-a00a41cd.js";import{J as I}from"./JoinFormInput-82706177.js";import{s as o,B as ye}from"./BankCard-dfcd288c.js";import{C as oe}from"./CustomSelectDepartment-11201deb.js";import{P as qe}from"./PopupWrapper-2578092d.js";import{J as $}from"./JoinFormInputView-2b5b0bdd.js";import{F as V}from"./FormToggle-18d319d7.js";import{O as De}from"./Overlay-c8100e0a.js";import{S as Le}from"./SearchModalBackdrop-c4f123e6.js";import{s as re}from"./EditConfirm.module-344fbdb9.js";import{B as Ee}from"./BorderBottom-1dc6f53e.js";import{U as Ie}from"./UniversalTab-73e7f63a.js";import"./JoinForm.module-212f9bb3.js";import"./FinanceTabChangeLink-68f322d9.js";import"./InstituteFinanceTabChangeLink-a344bd8c.js";import"./SearchModalWrapper-0fa3f9a3.js";import"./UniversalForm.module-19614663.js";import"./Switch-4bb87998.js";import"./SwitchBase-e3c2ff35.js";import"./Overlay.module-9133d1bb.js";import"./SearchHeader.module-b69c8942.js";const He=({onCloseApplicable:p,instituteId:t,setApplicablFor:s,libraryId:N,transportId:T,hostelId:n})=>{var k,u,L;const{t:f}=ne(),[l,x]=d.useState({flow:"",flow_id:"",flow_name:"",depart_arr:[]}),{allDepartment:C,allDepartmentRefetch:h}=fe({id:t,skip:!t});d.useEffect(()=>{t&&h()},[t]);const y=a=>{a==="Hostel"?x({flow:"Hostel",flow_id:n,flow_name:"Hostel",depart_arr:[]}):a==="Transport"?x({flow:"Transport",flow_id:T,flow_name:"Transport",depart_arr:[]}):a==="Library"?x({flow:"Library",flow_id:N,flow_name:"Library",depart_arr:[]}):a==="Internal Department"&&x({flow:"Department",flow_id:"",flow_name:"",depart_arr:[]})},j=a=>{x(g=>({...g,flow_id:a==null?void 0:a._id,flow_name:a==null?void 0:a.dName,depart_arr:[...new Set([...g.depart_arr,a==null?void 0:a._id])]}))},c=()=>{s(l),p()};return e.jsx(qe,{onClose:p,children:e.jsxs("div",{className:o.applicable_container,children:[e.jsx(oe,{selectLabel:f("applicable_for"),selectedValue:f("applicable_for_placeholder"),options:["Internal Department","Transport","Library","Hostel"],onClick:y}),l.flow==="Department"&&e.jsx(oe,{selectLabel:f("select_internal_department"),selectedValue:f("select_internal_department_placeholder"),options:((k=C==null?void 0:C.institute)==null?void 0:k.depart)??[],onClick:j,openAs:"PROMOTE",viewAs:"FINANCE_BANK",defalutValue:((u=l.depart_arr)==null?void 0:u.length)>1?`${(L=l.depart_arr)==null?void 0:L.length} department selected`:l.flow_name}),e.jsx("button",{className:o.applicable_btn,onClick:c,style:{width:"100%",justifyContent:"center"},children:e.jsx("div",{children:f("select")})})]})})},me=({onRefetch:p,openBankMenu:t,openAs:s,onClose:N,onEdit:T})=>{var P,J,K,G,W,z,Q,X,Y,Z,F,O,M;const{t:n}=ne(),f=_e(i=>i.financeChange.fid),[l,x]=d.useState(""),[C,h]=d.useState(!1),[y,j]=d.useState(!1),[c,k]=d.useState({finance_bank_name:"",finance_bank_account_number:"",finance_bank_account_name:"",finance_bank_ifsc_code:"",finance_bank_branch_address:"",finance_bank_upi_id:"",finance_bank_upi_qrcode:"",finance_bank_re_account_number:"",finance_bank_re_upi_id:""}),[u,L]=d.useState({flow:"",flow_id:"",flow_name:"",depart_arr:[]}),[a,g]=d.useState(""),[b,B]=d.useState(""),[H]=ue(),[ce]=je(),{financeDetailManager:S,financeDetailManagerRefetch:U}=ke({data:{fid:f,mod_id:""},skip:!f});d.useEffect(()=>{f&&U()},[f,U]),d.useEffect(()=>{s==="EDIT"&&k({finance_bank_name:(t==null?void 0:t.finance_bank_name)??"",finance_bank_account_number:(t==null?void 0:t.finance_bank_account_number)??"",finance_bank_account_name:(t==null?void 0:t.finance_bank_account_name)??"",finance_bank_ifsc_code:(t==null?void 0:t.finance_bank_ifsc_code)??"",finance_bank_branch_address:(t==null?void 0:t.finance_bank_branch_address)??"",finance_bank_upi_id:(t==null?void 0:t.finance_bank_upi_id)??"",finance_bank_upi_qrcode:(t==null?void 0:t.finance_bank_upi_qrcode)??"",finance_bank_re_account_number:(t==null?void 0:t.finance_bank_account_number)??"",finance_bank_re_upi_id:(t==null?void 0:t.finance_bank_upi_id)??""})},[s]);const ee=(i,m)=>{const _={};for(let r in i)r==="finance_bank_account_number"&&i.finance_bank_account_number!==i.finance_bank_re_account_number?_.finance_bank_re_account_number=`${n("form_account_dose_not_match_label")}`:r==="finance_bank_upi_id"&&i.finance_bank_upi_id!==i.finance_bank_re_upi_id?_.finance_bank_re_upi_id=`${n("upi_id_dose_not_match_label")}`:i[r]||(_[r]="* required");return m!=null&&m.flow_id||(_.flow_id="flow_id is required"),_},ae=i=>{const m={};for(let _ in i)_==="finance_bank_account_number"&&i.finance_bank_account_number!==i.finance_bank_re_account_number?m.finance_bank_re_account_number=`${n("form_account_dose_not_match_label")}`:_==="finance_bank_upi_id"&&i.finance_bank_upi_id!==i.finance_bank_re_upi_id?m.finance_bank_re_upi_id=`${n("upi_id_dose_not_match_label")}`:i[_]||(m[_]="* required");return m},v=i=>{k(m=>({...m,[i.target.name]:i.target.value}))},te=i=>{h(_=>!_);const m=new FormData;g(i.target.files[0]),m.append("file",i.target.files[0]),H({fileUpload:m}).then(_=>{h(r=>!r),s==="EDIT"&&B(c.finance_bank_upi_qrcode),k(r=>{var q;return{...r,finance_bank_upi_qrcode:(q=_.data)==null?void 0:q.imageKey}})}).catch(()=>{h(_=>!_)})},se=()=>{if(s==="EDIT"){const i=ae(c);let m=!1;for(let _ in i){m=!0;break}m?x(i):T(c,b)}else{const i=ee(c,u);let m=!1;for(let _ in i){m=!0;break}m?x(i):(h(_=>!_),ce({fid:f,...u,bankDetails:{...c,depart_arr:u.depart_arr}}).then(()=>{p(),N(),h(_=>!_)}).catch(()=>{h(_=>!_)}))}},R=()=>{j(i=>!i)};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:o.add_bank_title,children:[e.jsx("img",{src:"/images/arrow-left-fees-icon.svg",onClick:N,alt:""}),e.jsx("h6",{children:n(s==="EDIT"?"update_bank_details":"add_bank_details")})]}),s==="EDIT"?"":e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"3rem"},children:[e.jsxs("button",{className:o.applicable_btn,onClick:R,children:[e.jsx("div",{children:n("account_applicable_for")}),e.jsx("img",{src:"/images/forward-right-icon.svg",alt:"next step"})]}),u.flow_name&&e.jsx("h6",{className:o.applicable_text,children:((P=u.depart_arr)==null?void 0:P.length)>1?`${(J=u.depart_arr)==null?void 0:J.length} department selected`:u.flow_name})]}),l.flow_id&&e.jsxs("p",{style:{color:"red",marginLeft:"15px"},children:["* ",n("form_require_label")]})]}),e.jsx(I,{labelText:n("bank_name"),placeholder:n("bank_name_placeholder"),name:"finance_bank_name",value:c.finance_bank_name,type:"text",onChange:v,errorShow:l.finance_bank_name}),e.jsx(I,{labelText:n("account_name"),placeholder:n("account_name_placeholder"),name:"finance_bank_account_name",value:c.finance_bank_account_name,type:"text",onChange:v,errorShow:l.finance_bank_account_name}),e.jsx(I,{labelText:n("account_number"),placeholder:n("account_number_placeholder"),name:"finance_bank_account_number",value:c.finance_bank_account_number,type:"tel",onChange:v,errorShow:l.finance_bank_name}),e.jsx(I,{labelText:n("confirm_account_number"),placeholder:n("confirm_account_number_placeholder"),name:"finance_bank_re_account_number",value:c.finance_bank_re_account_number,type:"tel",onChange:v,errorShow:l.finance_bank_re_account_number,reAccount:l.finance_bank_re_account_number}),e.jsx(I,{labelText:n("ifsc_code"),placeholder:n("ifsc_code_placeholder"),name:"finance_bank_ifsc_code",value:c.finance_bank_ifsc_code,type:"text",onChange:v,errorShow:l.finance_bank_ifsc_code}),e.jsx(I,{labelText:n("address_of_bank"),placeholder:n("address_of_bank_placeholder"),name:"finance_bank_branch_address",value:c.finance_bank_branch_address,type:"text",onChange:v,errorShow:l.finance_bank_branch_address}),e.jsx(I,{labelText:n("upi_id"),placeholder:n("upi_id_placeholder"),name:"finance_bank_upi_id",value:c.finance_bank_upi_id,type:"text",onChange:v,errorShow:l.finance_bank_upi_id}),e.jsx(I,{labelText:n("confirm_upi_id"),placeholder:n("finance_bank_re_upi_id"),name:"finance_bank_re_upi_id",value:c.finance_bank_re_upi_id,type:"text",onChange:v,errorShow:l.finance_bank_re_upi_id,reAccount:l.finance_bank_re_upi_id}),e.jsx(ve,{labelText:n("qr_code_above_upi"),name:"finance_bank_upi_qrcode",value:a!=null&&a.name?{originalName:a==null?void 0:a.name}:"",onChange:te,errorShow:l.finance_bank_upi_qrcode}),e.jsx("button",{className:o.save_button,onClick:se,children:n("save")}),C&&e.jsx(de,{}),y&&e.jsx(He,{onCloseApplicable:R,setApplicablFor:L,instituteId:(G=(K=S==null?void 0:S.finance)==null?void 0:K.institute)==null?void 0:G._id,libraryId:(Q=(z=(W=S==null?void 0:S.finance)==null?void 0:W.institute)==null?void 0:z.library)==null?void 0:Q[0],transportId:(Z=(Y=(X=S==null?void 0:S.finance)==null?void 0:X.institute)==null?void 0:Y.transportDepart)==null?void 0:Z[0],hostelId:(M=(O=(F=S==null?void 0:S.finance)==null?void 0:F.institute)==null?void 0:O.hostelDepart)==null?void 0:M[0]})]})},$e=({onClose:p,openBankMenu:t,onRefetch:s,setDiabledInfo:N})=>{const T=ie(),[n,f]=d.useState(!1),[l,x]=d.useState(!1),[C]=ge(),[h]=Se(),y=()=>{f(c=>!c),C(t==null?void 0:t._id).then(()=>{s(),p(),f(c=>!c),T(-1)}).catch({})},j=(c,k)=>{f(u=>!u),x(!1),N(u=>!u),h({bid:t==null?void 0:t._id,bankDetails:c,delete_pic:k}).then(()=>{s(),f(u=>!u),p()}).catch({})};return e.jsx(e.Fragment,{children:l?e.jsx(me,{onEdit:j,openAs:"EDIT",onClose:p,openBankMenu:t}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{onClose:p}),e.jsxs(De,{customStyle:{zIndex:"1200"},children:[e.jsxs("div",{className:re.edit_modal_container,style:{width:"200px"},children:[e.jsx("h6",{className:re.edit,onClick:()=>{N(c=>!c),x(c=>!c)},children:"Edit"}),e.jsx("h6",{className:re.remove,onClick:y,children:"Delete"})]}),n&&e.jsx(de,{})]})]})})},A={width:"100%",marginTop:"0",marginBottom:"0"},w={fontWeight:"400",fontSize:"12px",color:"rgba(18, 18, 18, 0.8)"},Ae=({fid:p,getAllBankByFinanceRefetch:t})=>{var U,ee,ae,v,te,se,R,P,J,K,G,W,z,Q,X,Y,Z,F,O,M,i,m,_;const{t:s}=ne(),N=ie(),T=be(),[n,f]=d.useState(""),[l,x]=d.useState(!1),[C]=we(),[h,y]=d.useState({cash:!1,cheque:!1,demand_draft:!1,net_banking:!1,upi_transfer:!1}),[j,c]=d.useState({msg:"",run:!1}),[k,u]=d.useState(0),L=[{name:s("bank_info"),id:0},{name:s("fund"),id:1}],{getOneBankByFinance:a,getOneBankByFinanceRefetch:g}=Te({bid:T.state.bankId,skip:!T.state.bankId}),{getBankByFinance:b,getBankByFinanceRefetch:B}=Ce({data:{fid:p,flow:"",filter_by:""},skip:!p});d.useEffect(()=>{p&&B()},[p,B]),d.useEffect(()=>{T.state.bankId&&g()},[T.state.bankId,g]),d.useEffect(()=>{var r,q,E,D,le;b!=null&&b.bank_query&&y({cash:((r=b==null?void 0:b.bank_query)==null?void 0:r.cash)??!1,cheque:((q=b==null?void 0:b.bank_query)==null?void 0:q.cheque)??!1,demand_draft:((E=b==null?void 0:b.bank_query)==null?void 0:E.demand_draft)??!1,net_banking:((D=b==null?void 0:b.bank_query)==null?void 0:D.net_banking)??!1,upi_transfer:((le=b==null?void 0:b.bank_query)==null?void 0:le.upi_transfer)??!1})},[b==null?void 0:b.bank_query]);const H=(r,q)=>{const E={...h};for(let D in E)D===r&&(E[D]=q);C({fid:p,paymentModeUpdate:{payment_modes_type:E}}).then(()=>{c({msg:"Payment Mode is updated",run:!0})}).catch({}),y(D=>({...D,[r]:q}))},ce=()=>{g(),t()},S=r=>{u(r)};return e.jsxs("div",{className:o.bank,children:[!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:o.bank_header,children:[e.jsxs("div",{className:o.bank_header_left,children:[e.jsx("img",{src:"/images/left-back-icon.svg",alt:"back arrow",className:o.back_icon,onClick:()=>N(-1)}),e.jsx("h6",{className:o.bank_header_title,children:s("bank_detail")})]}),e.jsx("img",{src:"/images/bank-edit-icon.svg",alt:"back arrow",className:o.back_icon,onClick:()=>f(a==null?void 0:a.one_bank)})]}),e.jsx(Ie,{tabList:L,activeIndexTab:k,setActiveIndexTab:S,showAs:!1,customStyleTab:{width:"50%"}}),e.jsx(Ee,{customStyle:{width:"100%",marginBottom:"0.5rem"}}),k===0&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:o.bank_details,style:{height:"fit-content"},children:[e.jsxs("h6",{children:[s("applicable_for")," "," : "," "]}),e.jsx($,{labelText:"",value:(ee=(U=a==null?void 0:a.one_bank)==null?void 0:U.department)!=null&&ee.dName?(v=(ae=a==null?void 0:a.one_bank)==null?void 0:ae.department)==null?void 0:v.dName:(te=a==null?void 0:a.one_bank)!=null&&te.hostel?"Hostel":(se=a==null?void 0:a.one_bank)!=null&&se.library?"Library":(R=a==null?void 0:a.one_bank)!=null&&R.transport?"Transport":((J=(P=a==null?void 0:a.one_bank)==null?void 0:P.departments)==null?void 0:J.length)>0?(G=(K=a==null?void 0:a.one_bank)==null?void 0:K.departments)==null?void 0:G.map((r,q)=>{var E,D;return e.jsxs("span",{children:[(r==null?void 0:r.dName)??"",q+1===((D=(E=a==null?void 0:a.one_bank)==null?void 0:E.departments)==null?void 0:D.length)?"":", "]},r==null?void 0:r._id)}):"",customStyleContainer:A,customStyleLabel:w,customStyleValue:{...w,marginLeft:"-1rem"}})]}),e.jsxs("section",{className:o.bank_details,children:[e.jsx("h6",{children:s("bank_details")}),e.jsx($,{labelText:`${s("bank_name_collect")} :`,value:(W=a==null?void 0:a.one_bank)==null?void 0:W.finance_bank_name,customStyleContainer:A,customStyleLabel:w,customStyleValue:w}),e.jsx($,{labelText:`${s("account_name")} :`,value:(z=a==null?void 0:a.one_bank)==null?void 0:z.finance_bank_account_name,customStyleContainer:A,customStyleLabel:w,customStyleValue:w}),e.jsx($,{labelText:`${s("account_number")} :`,value:(Q=a==null?void 0:a.one_bank)==null?void 0:Q.finance_bank_account_number,customStyleContainer:A,customStyleLabel:w,customStyleValue:w}),e.jsx($,{labelText:`${s("ifsc_code")} :`,value:(X=a==null?void 0:a.one_bank)==null?void 0:X.finance_bank_ifsc_code,customStyleContainer:A,customStyleLabel:w,customStyleValue:w}),e.jsx($,{labelText:`${s("address")} :`,value:(Y=a==null?void 0:a.one_bank)==null?void 0:Y.finance_bank_branch_address,customStyleContainer:A,customStyleLabel:w,customStyleValue:w})]}),e.jsx("section",{className:o.bank_upi,children:e.jsx($,{labelText:`${s("upi_id")} :`,value:(Z=a==null?void 0:a.one_bank)==null?void 0:Z.finance_bank_upi_id,customStyleContainer:A,customStyleLabel:w,customStyleValue:w})}),e.jsxs("section",{className:o.bank_qr_code,children:[e.jsxs("div",{className:o.bank_qr_code_text,children:[e.jsxs("h6",{children:[s("qr_code"),":"]}),e.jsx("p",{children:((F=a==null?void 0:a.one_bank)==null?void 0:F.finance_bank_upi_id)??""})]}),(O=a==null?void 0:a.one_bank)!=null&&O.finance_bank_upi_qrcode?e.jsx("img",{src:`${he}/${(M=a==null?void 0:a.one_bank)==null?void 0:M.finance_bank_upi_qrcode}`,alt:"qr code"}):""]}),e.jsxs("section",{children:[e.jsx("h6",{children:s("payment_mode")}),e.jsx(V,{labelHeading:s("online_payment_gateway"),labelDescription:"",defaultLabel:!0,customContainer:{padding:"0",marginBottom:"0.5rem"}}),e.jsx(V,{labelHeading:s("cash"),labelDescription:"",defaultLabel:!1,checkedToggle:h.cash,onToggleHandler:r=>H("cash",r.target.checked),customContainer:{padding:"0",marginBottom:"0.5rem"}}),e.jsx(V,{labelHeading:s("upi_transfer"),labelDescription:"",defaultLabel:!1,checkedToggle:h.upi_transfer,onToggleHandler:r=>H("upi_transfer",r.target.checked),customContainer:{padding:"0",marginBottom:"0.5rem"}}),e.jsx(V,{labelHeading:s("neft_rtgs"),labelDescription:"",defaultLabel:!1,checkedToggle:h.net_banking,onToggleHandler:r=>H("net_banking",r.target.checked),customContainer:{padding:"0",marginBottom:"0.5rem"}}),e.jsx(V,{labelHeading:s("cheque"),labelDescription:"",defaultLabel:!1,checkedToggle:h.cheque,onToggleHandler:r=>H("cheque",r.target.checked),customContainer:{padding:"0",marginBottom:"0.5rem"}}),e.jsx(V,{labelHeading:s("demand_draft"),labelDescription:"",defaultLabel:!1,checkedToggle:h.demand_draft,onToggleHandler:r=>H("demand_draft",r.target.checked),customContainer:{padding:"0",marginBottom:"0.5rem"}})]})]}),k===1&&e.jsxs("div",{className:o.bank_fund_container,children:[e.jsxs("div",{className:o.bank_fund,children:[e.jsx("h6",{children:s("total_due")}),e.jsxs("h5",{children:[s("rs"),". ",((i=a==null?void 0:a.one_bank)==null?void 0:i.total_repay)??0]})]}),e.jsxs("div",{className:o.bank_fund,children:[e.jsx("h6",{children:s("bank_online_fees")}),e.jsxs("h5",{children:[s("rs"),"."," ",((m=a==null?void 0:a.one_bank)==null?void 0:m.collect_online)??0]})]}),e.jsxs("div",{className:o.bank_fund,children:[e.jsx("h6",{children:s("repayment_due")}),e.jsxs("h5",{children:[s("rs"),". ",((_=a==null?void 0:a.one_bank)==null?void 0:_.due_repay)??0]})]})]})]}),j.run&&e.jsx(pe,{msg:j.msg,run:j.run,setRun:()=>c({msg:"",run:!1}),postiton:"bottom",type:"success"}),n&&e.jsx($e,{openBankMenu:n,onClose:()=>{f(""),x(!1)},onRefetch:ce,setDiabledInfo:x})]})},ra=({carryParentState:p,callApi:t,financeId:s,viewAs:N})=>{var L,a;const T=ie(),n=be(),{t:f}=ne(),l=_e(g=>g.financeChange.fid),[x,C]=d.useState(!1),[h,y]=d.useState(!1),{getAllBankByFinance:j,getAllBankByFinanceRefetch:c}=Ne({data:{fid:l||s,page:1,limit:40,search:""},skip:l?!l:!s});d.useEffect(()=>{(l||s)&&c()},[l,s,c]);const{scrollToTop:k}=xe();d.useEffect(()=>{k()},[]);const u=()=>{y(g=>!g)};return e.jsxs(e.Fragment,{children:[((L=n.search)==null?void 0:L.substring(3))==="bank"?!x&&e.jsxs("div",{className:o.bank,children:[e.jsxs("div",{className:o.bank_header,children:[e.jsxs("div",{className:o.bank_header_left,children:[e.jsx("img",{src:"/images/left-back-icon.svg",alt:"back arrow",className:o.back_icon,onClick:()=>T(-1)}),e.jsx("h6",{className:o.bank_header_title,children:f("bank_acount_detail")})]}),e.jsx("img",{src:"/images/add-plus-blue-icon.svg",alt:"back arrow",className:o.back_icon,onClick:()=>C(!0)})]}),e.jsx("div",{className:o.bank_list,children:(a=j==null?void 0:j.all_accounts)==null?void 0:a.map(g=>e.jsx(ye,{bank:g,carryParentState:p,callApi:t,viewAs:N}))})]}):e.jsx(Ae,{fid:l||s,getAllBankByFinanceRefetch:c}),x&&e.jsx(me,{bank_query:j==null?void 0:j.bank_query,onRefetch:c,onEditAction:u,edit:h,onClose:()=>C(!1)})]})};export{ra as default};
