import{u as Q,d as U,c as W,r as m,j as s,m1 as G,e as K,Q as q}from"./index-0ca76035.js";import{s as h}from"./JoinForm.module-212f9bb3.js";import{s as a}from"./Markdetails.module-89b9535e.js";import{a3 as z,a4 as J}from"./subject-api-d07de19e.js";import{K as X}from"./department-api-e4b13f05.js";const E=()=>{var b,I,p,g,_,v,M,$,y,L,C,w,B;const{t:o}=Q(),n=U(),F=W();m.useEffect(()=>{var e;(e=document.getElementById("scrollView"))==null||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[(b=n.state)==null?void 0:b.subjectId]);const R=()=>{F(-1)},[c,N]=m.useState([]),[O,x]=m.useState(!0),{backlogExamAllStudent:i,backlogExamAllStudentRefetch:j}=z({data:{sid:(I=n.state)==null?void 0:I.subjectId,eid:(p=n.state)==null?void 0:p.examId},skip:!((g=n.state)!=null&&g.subjectId)}),[P]=J(),{departmentExamDetail:r,departmentExamDetailRefetch:k}=X({eid:(_=n.state)==null?void 0:_.examId,skip:!((v=n.state)!=null&&v.examId)});m.useEffect(()=>{var e;(e=n.state)!=null&&e.subjectId&&j()},[(M=n.state)==null?void 0:M.subjectId,j]),m.useEffect(()=>{i!=null&&i.students&&x(!1)},[i==null?void 0:i.students]),m.useEffect(()=>{var e;(e=n.state)!=null&&e.examId&&k()},[($=n.state)==null?void 0:$.examId,k]);const T=(e,d)=>{if(c!=null&&c.length){const t=[];for(let l of c)t.push(l.studentId);t!=null&&t.includes(e)||N([...c,{studentId:e,obtainMarks:0,previous_year_id:d}])}else N([...c,{studentId:e,obtainMarks:0,previous_year_id:d}])},V=e=>{for(let d of c)d.studentId===e.target.name&&(d.obtainMarks=parseInt(e.target.value))},H=()=>{var e,d,t,l;(e=n.state)!=null&&e.examId&&((d=n.state)!=null&&d.subjectId)&&(x(f=>!f),P({sid:(t=n.state)==null?void 0:t.subjectId,marksList:{examId:(l=n.state)==null?void 0:l.examId,marks:c}}).then(()=>{j(),x(f=>!f)}).catch({}))};return s.jsxs(G,{children:[" ",s.jsx("div",{className:h.goback_container,id:"scrollView",children:s.jsxs("div",{className:h.goback_container_text,onClick:R,children:[s.jsx("img",{src:"/images/arr-left-white.svg",alt:"go back icon"}),s.jsx("h6",{className:h.goback_container_text_go,children:o("go_back")})]})}),s.jsx("div",{className:h.student_from_container,style:{marginBottom:"1rem"},children:s.jsxs("div",{className:a.markDetails,children:[s.jsxs("div",{className:a.markDetailsHeader,children:[s.jsxs("h6",{children:[s.jsxs("span",{className:a.span,children:[o("exam")," : "]})," ",(y=r==null?void 0:r.exam)==null?void 0:y.examName]}),(c==null?void 0:c.length)>0?s.jsx("div",{className:a.savebtn,onClick:H,children:o("save")}):""]}),s.jsxs("div",{className:a.markDetailsHeader2,children:[s.jsxs("h6",{children:[s.jsxs("span",{className:a.span2,children:[" ",o("Maximum Marks")," : "]})," ",i==null?void 0:i.maximumMarks]}),((L=r==null?void 0:r.exam)==null?void 0:L.examType)==="Final"?"":s.jsxs("h6",{children:[s.jsxs("span",{className:a.span2,children:[" ",o("weightage")," : "]})," ",(C=r==null?void 0:r.exam)==null?void 0:C.examWeight,"%"]})]}),s.jsx("div",{className:a.table,children:s.jsxs("table",{children:[s.jsx("thead",{className:a.thead,children:s.jsxs("tr",{className:a.tr,children:[s.jsx("th",{className:`${a.th} ${a.rroll}`,children:o("roll_no")}),s.jsx("th",{className:`${a.th} ${a.rname}`,children:o("name")}),s.jsx("th",{className:`${a.th} ${a.rmark}`,children:o("ob")}),((w=r==null?void 0:r.exam)==null?void 0:w.examType)==="Final"?"":s.jsx("th",{className:`${a.th} ${a.rmark}`,children:o("fr")})]})}),s.jsx("tbody",{className:a.tbody,children:(B=i==null?void 0:i.students)==null?void 0:B.map(e=>{var d,t;return s.jsxs("tr",{className:a.tr,children:[s.jsx("td",{className:`${a.rroll} ${a.rrolld} ${a.td}`,children:(e==null?void 0:e.studentROLLNO)!==""?s.jsxs("h6",{children:[" ",e==null?void 0:e.studentROLLNO,"."]}):s.jsx("h6",{})}),s.jsx("td",{className:a.td,children:s.jsxs("div",{className:a.student,children:[s.jsx("img",{src:e!=null&&e.studentProfilePhoto?`${K}/${e==null?void 0:e.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:""}),s.jsxs("h6",{children:[e==null?void 0:e.studentFirstName," ",e!=null&&e.studentMiddleName?e==null?void 0:e.studentMiddleName:" "," ",e==null?void 0:e.studentLastName]})]})}),s.jsx("td",{className:`${a.td} ${a.tdinputcontaier}`,children:s.jsx("div",{className:a.tdinput,children:s.jsx("input",{type:"number",name:e==null?void 0:e._id,defaultValue:(e==null?void 0:e.obtainMarks)||0,min:"0",max:(i==null?void 0:i.maximumMarks)??100,onClick:()=>T(e==null?void 0:e._id,e==null?void 0:e.previous_year_id),onChange:V})})}),((d=r==null?void 0:r.exam)==null?void 0:d.examType)==="Final"?"":s.jsx("td",{className:a.td,children:(e.obtainMarks*((t=r==null?void 0:r.exam)==null?void 0:t.examWeight)/(i==null?void 0:i.maximumMarks)).toFixed(2)})]},e==null?void 0:e._id)})})]})}),O&&s.jsx(q,{})]})})]})};export{E as default};
