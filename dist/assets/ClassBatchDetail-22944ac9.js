import{u as k,r as t,j as e,Q,n as ce,L as oe,a1 as fe,S as H,e as le,a5 as _e,d as ge,t as xe,l as je}from"./index-0ca76035.js";import{B as V}from"./BorderBottom-1dc6f53e.js";import{s as C}from"./Hostel.module-50da11fe.js";import{P as Z}from"./PopupWrapper-2578092d.js";import{s as X}from"./HostelFeeStructure.module-5a40a31e.js";import{S as pe}from"./StringLength-ef31e6b8.js";import{J as Se}from"./JoinFormInput-82706177.js";import{a as Ne,b as ve,c as ye,d as Ce,e as we,f as De,u as Ee,g as be,h as ue}from"./class-api-bd140bb6.js";import{O as ne}from"./Overlay-c8100e0a.js";import{S as me}from"./SearchModalBackdrop-c4f123e6.js";import{s as J}from"./EditConfirm.module-344fbdb9.js";import{s as Y}from"./Catalog.module-96e4a559.js";import{C as Le}from"./ClassCard-b1734f36.js";import{s as S}from"./AdmissionScholarship.module-d4281c11.js";const he=({onClose:s,onRefetch:l,openAs:f,batchMenu:o,onEdit:j,cid:h})=>{const{t:i}=k(),[g,c]=t.useState(""),[_,n]=t.useState(!1),[m,w]=t.useState({batchName:f==="EDIT"?o==null?void 0:o.batchName:""}),[D]=Ne();t.useEffect(()=>{f==="EDIT"&&w(N=>({...N,batchName:o==null?void 0:o.batchName}))},[f]);const b=()=>{m.batchName?f==="EDIT"?j(m.batchName):h&&(n(N=>!N),D({cid:h,classBatch:m}).then(()=>{l(),s(),n(N=>!N)}).catch({})):c(!0)};return e.jsx(Z,{onClose:s,children:e.jsxs("div",{className:X.add_category_modal,children:[e.jsxs("div",{className:X.add_category_modal_title,children:[e.jsx("h6",{children:i(f==="EDIT"?"edit_batch":"add_new_batch")}),e.jsx("img",{src:"/images/close-post-icon.svg",onClick:s,alt:""})]}),e.jsx(V,{customStyle:{width:"100%",marginTop:"0.6rem",marginBottom:"0.6rem"}}),e.jsx(Se,{labelText:i("batch-name-place"),placeholder:"e.g. 2022-23",name:"batchName",value:m==null?void 0:m.batchName,type:"text",onChange:N=>{var u;((u=N.target.value)==null?void 0:u.length)<=30&&w(x=>({...x,batchName:N.target.value}))},errorShow:g}),e.jsx(pe,{maxLength:30,valueLength:m.batchName}),e.jsx("button",{className:X.set_fees_structure_btn,title:"Create Batch",onClick:b,style:{justifyContent:"center"},children:i(f==="EDIT"?"update":"create")}),_&&e.jsx(Q,{})]})})},Re=({onClose:s,batchMenu:l,onRefetch:f})=>{const[o,j]=t.useState(!1),[h,i]=t.useState(!1),[g]=ve(),[c]=ye(),_=()=>{l!=null&&l._id&&(j(m=>!m),c({bid:l==null?void 0:l._id}).then(()=>{f(),s(),j(m=>!m)}).catch({}))},n=m=>{l!=null&&l._id&&(i(!1),j(w=>!w),g({bid:l==null?void 0:l._id,updateBatch:{batchName:m}}).then(()=>{f(),j(w=>!w),s()}).catch({}))};return e.jsx(e.Fragment,{children:h?e.jsx(he,{openAs:"EDIT",onEdit:n,batchMenu:l,onClose:()=>i(m=>!m),onRefetch:f}):e.jsxs(e.Fragment,{children:[e.jsx(me,{onClose:s}),e.jsxs(ne,{customStyle:{zIndex:"1200"},children:[e.jsxs("div",{className:J.edit_modal_container,style:{width:"200px"},children:[e.jsx("h6",{className:J.edit,onClick:()=>i(m=>!m),children:"Edit"}),e.jsx("h6",{className:J.remove,onClick:_,children:"Delete"})]}),o&&e.jsx(Q,{})]})]})})},$e=({batch:s,onRefetch:l,carryParentState:f,viewAs:o})=>{const{t:j}=k(),h=ce(),[i,g]=t.useState("");return e.jsxs(e.Fragment,{children:[e.jsx(oe,{to:o==="INSTITUTE"?`/q/${h.username}/class?type=batch-detail`:`/q/${h.username}/member/class/${h.cname}?a=batch-detail`,state:{...f,batchName:s==null?void 0:s.batchName,batchId:s==null?void 0:s._id},children:e.jsxs("div",{className:`${C.hostel_batch_container} ${C.hostel_batch_container_hover}`,children:[e.jsx("img",{className:C.hostel_batch_image,src:"/images/master-24-grey-icon.svg",alt:"batch icon",style:{borderRadius:"0"}}),e.jsxs("div",{className:C.hostel_batch_container_text,children:[e.jsx("h6",{children:(s==null?void 0:s.batchName)??""}),e.jsxs("p",{children:[j("created_on_")," ",fe(s==null?void 0:s.createdAt).format("DD MMM yyyy")]})]}),e.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:c=>{c.preventDefault(),g(s)},className:C.hostel_batch_menu,title:"Menu"})]})},s==null?void 0:s._id),i&&e.jsx(Re,{onClose:()=>g(""),onRefetch:l,batchMenu:i})]})},Xe=({cid:s,carryParentState:l,viewAs:f})=>{var w;const{t:o}=k(),[j,h]=t.useState(!1),[i,g]=t.useState(!0),{getClassAllBatch:c,getClassAllBatchRefetch:_}=Ce({cid:s,skip:!s});t.useEffect(()=>{s&&(g(!0),_())},[s,_]),t.useEffect(()=>{var D;(c!=null&&c.all_batches||((D=c==null?void 0:c.all_batches)==null?void 0:D.length)===0)&&g(!1)},[c==null?void 0:c.all_batches]);const n=()=>{g(!0),_()},m=()=>{h(D=>!D)};return e.jsxs("div",{className:C.hostel_container,style:f==="INSTITUTE"?{border:"none"}:null,children:[e.jsx("div",{className:C.with_search,children:e.jsx("h6",{children:o("class_batch")})}),e.jsx(V,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}}),e.jsx("div",{className:C.add_container,children:e.jsx("p",{className:C.add_new_category,onClick:m,children:o("create_new_batch")})}),(w=c==null?void 0:c.all_batches)==null?void 0:w.map(D=>e.jsx($e,{batch:D,onRefetch:n,carryParentState:l,viewAs:f},D==null?void 0:D._id)),i&&e.jsx(H,{status:"white"}),j&&e.jsx(he,{onClose:m,cid:s,onRefetch:n})]})},ke=({onClose:s,studentMenu:l,bid:f,onRefetch:o})=>{const[j,h]=t.useState(!1),[i]=we(),g=()=>{f&&(h(c=>!c),i({bid:f,destroy:{student_arr:[l]}}).then(()=>{o(),s(),h(c=>!c)}).catch({}))};return e.jsxs(e.Fragment,{children:[e.jsx(me,{onClose:s}),e.jsxs(ne,{customStyle:{zIndex:"1200"},children:[e.jsx("div",{className:J.edit_modal_container,style:{width:"200px"},children:e.jsx("h6",{className:J.remove,onClick:g,children:"Delete"})}),j&&e.jsx(Q,{})]})]})},ie=({student:s,batchId:l,onRefetch:f})=>{var c;const{t:o}=k(),j=ce(),[h,i]=t.useState(""),g=_=>{_.preventDefault(),i(s==null?void 0:s._id)};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{to:`/q/${j.username}/student/profile`,state:{sid:s==null?void 0:s._id,viewAs:"CLASS_CATALOG"},children:e.jsxs("div",{className:Y.item,style:{position:"relative"},children:[e.jsx("p",{children:(s==null?void 0:s.studentROLLNO)??""}),e.jsx("img",{alt:"",src:s!=null&&s.studentProfilePhoto?`${le}/${s==null?void 0:s.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg"}),e.jsxs("div",{className:Y.student_catalog_name,children:[e.jsxs("h5",{children:[(s==null?void 0:s.studentFirstName)??""," ",(s==null?void 0:s.studentMiddleName)??" "," ",(s==null?void 0:s.studentLastName)??""]}),e.jsxs("h6",{children:[o("gr_number")," ",e.jsx("span",{style:{fontWeight:"500"},children:(s==null?void 0:s.studentGRNO)??""}),(c=s==null?void 0:s.class_selected_batch)==null?void 0:c.map(_=>(_==null?void 0:_._id)===l?e.jsx("span",{style:{fontWeight:"500"},children:`, ${o("batch")}: ${_==null?void 0:_.batchName}`}):null)]})]}),e.jsx("img",{src:"/images/three-24-dot-icon.svg",alt:"menu icon",onClick:g,className:Y.batch_container_menu,title:"Menu"})]})}),h&&e.jsx(ke,{onClose:()=>i(""),bid:l,onRefetch:f,studentMenu:h})]})},Te=({batchId:s,onClose:l,onGrab:f})=>{var c,_,n;const{t:o}=k(),[j,h]=t.useState(!0),{allClass:i,allClassRefetch:g}=_e({bid:s,skip:!s});return t.useEffect(()=>{var m;(m=i==null?void 0:i.batch)!=null&&m.classroom&&h(!1)},[(c=i==null?void 0:i.batch)==null?void 0:c.classroom]),t.useEffect(()=>{s&&g()},[s,g]),e.jsx(Z,{onClose:l,children:e.jsxs("div",{className:S.assign_role_container,style:{width:"40rem"},children:[e.jsxs("section",{className:S.assign_role_title,style:{justifyContent:"space-between"},children:[e.jsx("h6",{children:o("select_class")}),e.jsx("div",{className:S.button_container,style:{justifyContent:"flex-end",gap:"1rem"},children:e.jsx("img",{src:"/images/close-post-icon.svg",onClick:l,alt:"",style:{cursor:"pointer"}})})]}),e.jsx(V,{customStyle:{width:"100%",marginBottom:"0.8rem"}}),e.jsxs("section",{style:{padding:"0 0.8rem"},children:[(n=(_=i==null?void 0:i.batch)==null?void 0:_.classroom)==null?void 0:n.map(m=>e.jsx(Le,{setViewClass:()=>{},classData:m,setAllotC:w=>f(w),isView:"CLASS_TEACHER"})),j&&e.jsx(H,{status:"white"})]})]})})},Ie=({cid:s,onClose:l,onRefetch:f,batchId:o,onCloseParent:j})=>{var O;const{t:h}=k(),[i,g]=t.useState(!0),[c,_]=t.useState([]),[n,m]=t.useState(""),[w,D]=t.useState(!1),[b,N]=t.useState(!1);t.useState(!1);const[u]=De(),{classAllStudent:x,classAllStudentRefetch:I}=Ee({data:{cid:s,page:1,limit:30},skip:!s});t.useEffect(()=>{s&&(g(!0),I())},[s,I]),t.useEffect(()=>{var a,r,y,L;(a=x==null?void 0:x.classes)!=null&&a.ApproveStudent?(_((r=x==null?void 0:x.classes)==null?void 0:r.ApproveStudent),g(!1)):((L=(y=x==null?void 0:x.classes)==null?void 0:y.ApproveStudent)==null?void 0:L.length)===0&&g(!1)},[(O=x==null?void 0:x.classes)==null?void 0:O.ApproveStudent]);const B=a=>{var r,y,L;if(a.target.value){const K=(y=(r=x==null?void 0:x.classes)==null?void 0:r.ApproveStudent)==null?void 0:y.filter(p=>{var F,R,T,G,W,U;return(T=(F=`${p==null?void 0:p.studentFirstName} ${p!=null&&p.studentMiddleName?(p==null?void 0:p.studentMiddleName)+" ":""}${p==null?void 0:p.studentLastName}`)==null?void 0:F.toLowerCase())!=null&&T.includes((R=a.target.value)==null?void 0:R.toLowerCase())||(U=(G=`${p==null?void 0:p.studentGRNO}`)==null?void 0:G.toLowerCase())!=null&&U.includes((W=a.target.value)==null?void 0:W.toLowerCase())?p:null});_(K)}else _((L=x==null?void 0:x.classes)==null?void 0:L.ApproveStudent)},q=a=>{n!=null&&n.includes(a)?m(r=>r==null?void 0:r.filter(y=>y!==a)):m(r=>[...r,a])},P=()=>{var r;let a=[];for(let y of(r=x==null?void 0:x.classes)==null?void 0:r.ApproveStudent)a.push(y==null?void 0:y._id);m(a),N(!0)},A=()=>{m([]),N(!1)},z=()=>{o&&(n!=null&&n.length)&&(D(a=>!a),u({bid:o,addStudent:{student_arr:n}}).then(()=>{f(),j(),D(a=>!a)}).catch({}))};return e.jsx(Z,{onClose:()=>{},children:e.jsxs("div",{className:S.assign_role_container,style:{width:"40rem"},children:[e.jsxs("section",{className:S.assign_role_title,style:{justifyContent:"space-between"},children:[e.jsxs("h6",{children:[(n==null?void 0:n.length)>0?`${n==null?void 0:n.length} `:"",h("select_student")]}),e.jsxs("div",{className:S.button_container,style:{justifyContent:"flex-end",gap:"1rem"},children:[b?e.jsx("button",{className:S.next_student_btn,title:"Remove All Student",onClick:A,style:{marginRight:"0.7rem"},children:h("remove_all")}):e.jsx("button",{className:S.next_student_btn,title:"Select All Student",onClick:P,style:{marginRight:"0.7rem"},children:h("select_all")}),e.jsx("button",{className:S.next_student_btn,onClick:z,children:h("add")}),e.jsx("img",{src:"/images/close-post-icon.svg",onClick:l,alt:"",style:{cursor:"pointer"}})]})]}),e.jsx(V,{customStyle:{width:"100%"}}),e.jsxs("section",{style:{padding:"0 0.8rem"},children:[e.jsx("div",{className:S.search_container,style:{marginBottom:"0.6rem"},children:e.jsxs("div",{className:S.search_container_text,children:[e.jsx("img",{className:S.searchIcon,alt:"search icon",src:"/images/search-dash-icon.svg"}),e.jsx("input",{type:"text",placeholder:h("search-label"),onChange:B,autoFocus:!0,style:{border:"0.029vw solid rgba(0, 0, 0, 0.15)",width:"450px"}})]})}),c==null?void 0:c.map(a=>{var r,y;return e.jsxs("section",{className:n!=null&&n.includes(a==null?void 0:a._id)?`${S.student_container} ${S.select_hover_active}`:`${S.student_container} ${S.select_hover}`,style:{padding:"0.6rem 0.4rem",margin:"0",justifyContent:"space-between"},children:[e.jsxs("div",{className:S.student_container_text,children:[e.jsx("p",{className:S.student_container_gr,style:{marginBottom:"0"},children:(a==null?void 0:a.studentROLLNO)??""}),e.jsx("img",{src:a!=null&&a.studentProfilePhoto?`${le}/${a==null?void 0:a.studentProfilePhoto}`:"/images/member_tab/class/default_avatar.svg",alt:"student avatar"}),e.jsxs("div",{className:S.student_container_name,children:[e.jsx("h6",{children:`${a==null?void 0:a.studentFirstName} ${a!=null&&a.studentMiddleName?a==null?void 0:a.studentMiddleName:""} ${a==null?void 0:a.studentLastName}`}),e.jsxs("p",{className:S.student_container_gr,children:[h("gr_number")," ",(a==null?void 0:a.studentGRNO)??"",(r=a==null?void 0:a.class_selected_batch)!=null&&r.batchName?`, ${h("batch")}: ${(y=a==null?void 0:a.class_selected_batch)==null?void 0:y.batchName}`:null]})]})]}),e.jsx("div",{className:S.student_container_text,children:n!=null&&n.includes(a==null?void 0:a._id)?e.jsx("img",{src:"/images/checkbox-icon.svg",alt:"icon",style:{borderRadius:"0",height:"1.5rem"},onClick:()=>q(a==null?void 0:a._id)}):e.jsx("img",{src:"/images/box-icon.svg",alt:"icon",style:{borderRadius:"0",height:"1.5rem"},onClick:()=>q(a==null?void 0:a._id)})})]},a==null?void 0:a._id)}),i&&e.jsx(H,{status:"white"}),w&&e.jsx(Q,{})]})]})})},Be=({batchId:s,onClose:l,onRefetch:f,masterBatchId:o})=>{const[j,h]=t.useState("CLASSES"),[i,g]=t.useState(""),c=_=>{g(_),h("STUDENT")};return e.jsx(e.Fragment,{children:j==="CLASSES"?e.jsx(Te,{batchId:o,onClose:l,onGrab:c}):e.jsx(Ie,{cid:i==null?void 0:i._id,onClose:()=>h("CLASSES"),onCloseParent:l,onRefetch:f,batchId:s})})},Ye=({cid:s,viewAs:l,masterBatchId:f})=>{var M,ee,se,ae,te;const o=ge(),{t:j}=k(),[h,i]=t.useState(!1),[g,c]=xe(),[_,n]=t.useState(1),[m,w]=t.useState(!0),[D,b]=t.useState(!0),[N,u]=t.useState([]),[x,I]=t.useState(!1),[B,q]=t.useState(""),[P,A]=t.useState(!1),[z,O]=t.useState(!1),[a]=be(),{getClassBatchAllStudent:r,getClassBatchAllStudentRefetch:y}=ue({data:{bid:(M=o.state)==null?void 0:M.batchId,page:_,limit:10,search:B},skip:!((ee=o.state)!=null&&ee.batchId)});t.useEffect(()=>{var d;(d=o.state)!=null&&d.batchId&&(b(!0),y())},[(se=o.state)==null?void 0:se.batchId,_,B,y]),t.useEffect(()=>{c&&m&&n(d=>d+1)},[c,m]),t.useEffect(()=>{var d,v;x?(u(r==null?void 0:r.all_students),b(!1),I(!1)):B?(u(r==null?void 0:r.all_students),b(!1)):r!=null&&r.all_students?(u(E=>[...new Set([...E,...r==null?void 0:r.all_students].map(JSON.stringify))].map(JSON.parse)),b(!1)):((d=r==null?void 0:r.all_students)==null?void 0:d.length)===0&&b(!1),((v=r==null?void 0:r.all_students)==null?void 0:v.length)===10?w(!0):w(!1)},[r==null?void 0:r.all_students]);const L=t.useCallback(je.debounce(d=>q(d),500),[]),K=d=>{L(d.target.value)},p=()=>{n(1),I(!0),b(!0),y()},F=()=>{i(d=>!d)},R=t.useRef(),T=t.useRef(),G=(d,v)=>{d.stopPropagation(),R.current=v},W=(d,v)=>{d.stopPropagation(),T.current=v},U=d=>{d.stopPropagation();const v=[...N],E=v[R.current];v.splice(R.current,1),v.splice(T.current,0,E),R.current=null,T.current=null,u(v)},de=()=>{var v;O(E=>!E);let d=[];for(let E of N)d.push(E==null?void 0:E._id);a({suffle:{shuffle_arr:d,bid:(v=o.state)==null?void 0:v.batchId,flow:"BATCH_WISE"}}).then(()=>{p(),A(!1),O(E=>!E)}).catch({})};return e.jsxs("div",{className:C.hostel_container,style:l==="INSTITUTE"?{border:"none"}:null,children:[e.jsxs("div",{className:C.with_search,children:[e.jsx("h6",{children:((ae=o.state)==null?void 0:ae.batchName)??""}),e.jsx("section",{className:C.search_container,children:e.jsxs("div",{className:C.search_container_input,children:[e.jsx("img",{className:C.searchIcon,alt:"search icon",src:"/images/search-dash-icon.svg"}),e.jsx("input",{type:"text",placeholder:"Search students...",onChange:K})]})})]}),e.jsx(V,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}}),e.jsxs("div",{className:C.add_container,style:{gap:"1rem"},children:[e.jsx("p",{className:C.add_new_category,onClick:F,children:j("add_student")}),P?e.jsx("p",{className:C.add_new_category,onClick:de,children:j("save")}):e.jsx("p",{className:C.add_new_category,onClick:()=>A(!0),children:j("resuffle")})]}),N==null?void 0:N.map((d,v)=>{var E,re;return(N==null?void 0:N.length)===v+1?e.jsx("div",{ref:g,draggable:P,onDragStart:$=>G($,v),onDragEnter:$=>W($,v),onDragEnd:U,children:e.jsx(ie,{student:d,onRefetch:p,batchId:(E=o.state)==null?void 0:E.batchId})},d==null?void 0:d._id):e.jsx("div",{draggable:P,onDragStart:$=>G($,v),onDragEnter:$=>W($,v),onDragEnd:U,children:e.jsx(ie,{student:d,onRefetch:p,batchId:(re=o.state)==null?void 0:re.batchId},d==null?void 0:d._id)})}),D&&e.jsx(H,{status:"white"}),h&&e.jsx(Be,{onClose:F,cid:s,onRefetch:p,batchId:(te=o.state)==null?void 0:te.batchId,masterBatchId:f}),z&&e.jsx(Q,{})]})};export{Xe as C,Ye as a};
