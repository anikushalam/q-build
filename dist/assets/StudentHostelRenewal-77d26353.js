import{u as B,n as ln,r as h,lq as sn,lr as dn,j as n,Q as F,N as _n,D as tn,a1 as Ye,t as cn,S as mn}from"./index-731451a5.js";import{j as hn,k as an,l as rn,i as fn,m as pn}from"./hostel-api-4d11cb04.js";import{s as I}from"./Hostel.module-50da11fe.js";import{B as xn}from"./BorderBottom-47800983.js";import{s as m,S as jn,U as bn,N as vn,C as gn,D as Nn,P as Cn}from"./DemandProcess-df635659.js";import{P as wn,p as Sn}from"./PaymentGatewayConfig-78c07c77.js";import{j as kn}from"./finance-api-5c6c5671.js";import{J as Xe}from"./JoinFormInput-8e74a0e0.js";import{C as An}from"./CashProcess-d4947217.js";import{g as In}from"./paytmUpiInitiative-bed1cea7.js";import{P as Ze}from"./PopupWrapper-ffbaef7a.js";import{S as En}from"./Switch-81e70f2f.js";import{ac as Pn,F as Tn}from"./admission-api-56b87fde.js";const Rn={inputPxrops:{"aria-label":"Switch demo"}};function $n({hideModal:l,statusQuery:e,onRefetchApplication:o}){var J,V,z,U,Y,X,K,Z,y,D,u,Q,ee,ne,oe,ie,le,se,de,_e,te,ce,me,he,ae,re,fe,pe,xe,je,be,ve,ge,Ne,Ce,we,Se,ke,Ae,Ie,Ee,Pe,Te,Re,$e,He,Me,Oe,qe;const{t:d}=B(),g=ln(),[b,N]=h.useState(!1),[f,i]=h.useState(0),[C,E]=h.useState(!1),[v,r]=h.useState(!1),[j,p]=h.useState(""),[t,c]=h.useState({amount:0,feesId:"",insId:"",type:"",installmentType:""}),[S,R]=h.useState({msg:"",run:!1}),[_,P]=h.useState({fee_payment_mode:"",fee_payment_amount:"",transaction_date:"",fee_bank_name:"",fee_bank_holder:"",fee_utr_reference:"",fee_payment_acknowledge:"",month:""}),{data:$}=sn(),[ye]=dn(),[De]=hn(),{merchantId:M,merchantIdRefetch:G}=kn({id:(V=(J=e==null?void 0:e.renewal_hostel)==null?void 0:J.institute)==null?void 0:V._id,skip:!((U=(z=e==null?void 0:e.renewal_hostel)==null?void 0:z.institute)!=null&&U._id)});h.useEffect(()=>{var s,a;(a=(s=e==null?void 0:e.renewal_hostel)==null?void 0:s.institute)!=null&&a._id&&G()},[(X=(Y=e==null?void 0:e.renewal_hostel)==null?void 0:Y.institute)==null?void 0:X._id,G]),h.useEffect(()=>{c(s=>{var a,k,A;return{...s,amount:(A=(k=(a=e==null?void 0:e.renewal_student)==null?void 0:a.hostel_fee_structure)==null?void 0:k.one_installments)==null?void 0:A.fees}})},[]);const ue=()=>{N(s=>!s)},Qe=s=>{c(a=>({...a,amount:s.target.value}))},W=s=>{const a={};return s||(a.month_re="is required!"),a},O=()=>{var A,H;const s=W(_.month);let a=!1;for(let w in s)if(w){a=!0;break}if(a)p(s);else{r(!0);var k={sid:(A=e==null?void 0:e.renewal_student)==null?void 0:A._id,rid:e==null?void 0:e._id,selectRenewal:f!==2?_:{fee_payment_mode:"By Cash",month:_.month}};((H=e==null?void 0:e.renewal_student)==null?void 0:H._id)!==""&&(e==null?void 0:e._id)!==""&&De(k).then(w=>{w.data.status&&(o(),r(!1),l(!1))}).catch({})}},en=s=>{var Le,We,Be,Fe;let a=+(t==null?void 0:t.amount)*2.1/100,k=+a*18/100,A=a+k;const H=parseInt(t==null?void 0:t.amount);var w={amount:Math.ceil(H+ +A.toFixed(2))};s==="PAYTM"?In({amount:+(t==null?void 0:t.amount),amount_nocharges:+w.amount,type:"Hostel",paidBy:`${(Le=e==null?void 0:e.renewal_student)==null?void 0:Le._id}`,paidTo:`${(Be=(We=e==null?void 0:e.renewal_hostel)==null?void 0:We.institute)==null?void 0:Be._id}`,moduleId:`${(Fe=e==null?void 0:e.renewal_application)==null?void 0:Fe._id}`,ad_status_id:`${e==null?void 0:e._id}`,payment_installment:t.installmentType,ad_install:b,month:_.month,payment_remain_1:null,payment_card_type:null,payment_book_id:null,name:g.username,isApk:"web",payment_card_id:null}).then(x=>{var q,L;window.onScriptLoad((L=(q=x==null?void 0:x.response)==null?void 0:q.body)==null?void 0:L.txnToken,x==null?void 0:x.order,x==null?void 0:x.amount)}).catch(x=>{console.info(x)}):$!=null&&$.Key&&(w!=null&&w.amount)?ye({amount:w==null?void 0:w.amount}).then(x=>{var q,L,Ge,Je,Ve,ze,Ue;(q=x.data)!=null&&q.success?Sn({key:$==null?void 0:$.Key,oid:(L=x.data)==null?void 0:L.order.id,amount_nocharge:(t==null?void 0:t.amount)*100,amount:(Ge=x.data)==null?void 0:Ge.order.amount,type:"Hostel",pay_by:`${(Je=e==null?void 0:e.renewal_student)==null?void 0:Je._id}`,pay_to:`${(ze=(Ve=e==null?void 0:e.renewal_hostel)==null?void 0:Ve.institute)==null?void 0:ze._id}`,mid:`${(Ue=e==null?void 0:e.renewal_application)==null?void 0:Ue._id}`,razor_key:M==null?void 0:M.key,razor_author:M==null?void 0:M.bool,status:`${e==null?void 0:e._id}`,installment_type:t.installmentType,is_install:b,h_month:_.month}):console.log("data error")}).catch(x=>{console.log(x)}):console.log("error")},nn=s=>{var A,H;const a=W(_.month);let k=!1;for(let w in a)if(w){k=!0;break}k?p(a):+t.amount>=((A=s==null?void 0:s.one_installments)==null?void 0:A.fees)&&+t.amount<=(s==null?void 0:s.total_admission_fees)?(c({...t,type:"Admission",installmentType:b?"one_installments":""}),E(!0)):R({msg:`Enter amount is not less than ${(H=s==null?void 0:s.one_installments)==null?void 0:H.fees} or greater than ${s==null?void 0:s.total_admission_fees}`,run:!0})},on=s=>{const a=W(_.month);let k=!1;for(let A in a)if(A){k=!0;break}k?p(a):i(s)};return n.jsxs(n.Fragment,{children:[!C&&n.jsxs(Ze,{onClose:()=>l(!1),children:[(f===0||f===1)&&n.jsxs("div",{className:m.addDisplay,children:[n.jsxs("div",{className:m.title,children:[n.jsx("div",{}),n.jsx("h6",{children:d("confirm_renewal")}),n.jsx("img",{src:"/images/close-post-icon.svg",onClick:()=>l(!1),alt:""})]}),n.jsxs("div",{className:m.content,children:[n.jsx(Xe,{labelText:d("stay_for_month"),placeholder:d("total_months_placeholder"),name:"month_re",value:_==null?void 0:_.month,type:"text",onChange:s=>P(a=>({...a,month:s.target.value})),errorShow:j.month_re}),n.jsxs("div",{className:m.tabsss,children:[n.jsx("div",{className:f===0?`${m.singletab} ${m.singletabActive}`:m.singletab,onClick:()=>i(0),children:d("pay_online")}),n.jsx("div",{className:f===1?`${m.singletab} ${m.singletabActive}`:m.singletab,onClick:()=>i(1),children:d("pay_offline")})]}),f===0&&n.jsxs("div",{children:[n.jsxs("div",{className:m.singlerow,children:[n.jsx("h6",{children:d("admission_fees")}),n.jsxs("h6",{children:["Rs."," ",((Z=(K=e==null?void 0:e.renewal_student)==null?void 0:K.hostel_fee_structure)==null?void 0:Z.total_admission_fees)??0]})]}),n.jsxs("div",{className:m.singlerow,style:{marginTop:"1rem"},children:[n.jsx("h6",{children:d("applicable_fees_only")}),n.jsxs("h6",{children:["Rs."," ",((D=(y=e==null?void 0:e.renewal_student)==null?void 0:y.hostel_fee_structure)==null?void 0:D.applicable_fees)??0]})]}),n.jsx("div",{className:m.singlerow,children:n.jsxs("h6",{children:[d("fees_category")," "," : ",((ee=(Q=(u=e==null?void 0:e.renewal_student)==null?void 0:u.hostel_fee_structure)==null?void 0:Q.category_master)==null?void 0:ee.category_name)??""]})}),n.jsx("h6",{className:m.fee_structure_note,children:d("fee_structure_note")}),n.jsxs("div",{className:m.singlerow1,children:[n.jsx("h6",{children:d("pay_in_installment")}),n.jsx(En,{...Rn,onChange:ue})]}),b&&n.jsxs("div",{children:[n.jsx("div",{className:m.borderr}),n.jsxs("div",{className:m.singlerow1,children:[n.jsx("h6",{children:d("first_install")}),n.jsxs("h6",{children:["Rs."," ",((ie=(oe=(ne=e==null?void 0:e.renewal_student)==null?void 0:ne.hostel_fee_structure)==null?void 0:oe.one_installments)==null?void 0:ie.fees)??0]})]})]}),n.jsx(Xe,{labelText:d("enter_amount_to_be_paid"),name:"amount",type:"tel",value:t.amount,onChange:Qe,placeholder:d("please_enter_amount_paid")}),n.jsx("div",{className:m.payandconfirmContainer,children:n.jsx("p",{className:m.payandconfirm,children:d("pay_and_confirm")})}),n.jsx("div",{className:m.btn,style:{cursor:"pointer"},onClick:()=>{var s;return nn((s=e==null?void 0:e.renewal_student)==null?void 0:s.hostel_fee_structure)},children:d("pay_confirm")})]}),f===1&&n.jsxs("div",{children:[n.jsxs("div",{className:m.singlerow,children:[n.jsx("h6",{children:d("admission_fees")}),n.jsxs("h6",{children:["Rs."," ",((se=(le=e==null?void 0:e.renewal_student)==null?void 0:le.hostel_fee_structure)==null?void 0:se.total_admission_fees)??0]})]}),n.jsxs("div",{className:m.singlerow,style:{marginTop:"1rem"},children:[n.jsx("h6",{children:d("applicable_fees_only")}),n.jsxs("h6",{children:["Rs."," ",((_e=(de=e==null?void 0:e.renewal_student)==null?void 0:de.hostel_fee_structure)==null?void 0:_e.applicable_fees)??0]})]}),n.jsx("div",{className:m.singlerow,children:n.jsxs("h6",{children:[d("fees_category")," "," : ",((me=(ce=(te=e==null?void 0:e.renewal_student)==null?void 0:te.hostel_fee_structure)==null?void 0:ce.category_master)==null?void 0:me.category_name)??""]})}),n.jsx("h6",{className:m.fee_structure_note,children:d("fee_structure_note")}),((re=(ae=(he=e==null?void 0:e.renewal_student)==null?void 0:he.hostel_fee_structure)==null?void 0:ae.one_installments)==null?void 0:re.fees)&&n.jsxs("div",{className:m.singlerow1,children:[n.jsx("h6",{children:d("first_install")}),n.jsxs("h6",{children:["Rs."," ",((xe=(pe=(fe=e==null?void 0:e.renewal_student)==null?void 0:fe.hostel_fee_structure)==null?void 0:pe.one_installments)==null?void 0:xe.fees)??0]})]}),n.jsx("div",{className:m.borderr}),n.jsx("div",{className:m.adholdcontainer,children:n.jsx("p",{className:m.payandconfirm,children:d("admission_hold")})}),n.jsx(jn,{financeId:((ve=(be=(je=e==null?void 0:e.renewal_hostel)==null?void 0:je.institute)==null?void 0:be.financeDepart)==null?void 0:ve[0])??"",setIndex:on,departmentId:((ge=e==null?void 0:e.renewal_hostel)==null?void 0:ge._id)??"",flowAs:"Hostel"})]})]})]}),f===2&&n.jsx(An,{setIndex:i,ConfirmOffline:O}),f===3&&n.jsx(bn,{financeId:((we=(Ce=(Ne=e==null?void 0:e.renewal_hostel)==null?void 0:Ne.institute)==null?void 0:Ce.financeDepart)==null?void 0:we[0])??"",setIndex:i,setPayData:P,payData:_,ConfirmOffline:O,departmentId:((Se=e==null?void 0:e.renewal_hostel)==null?void 0:Se._id)??"",flowAs:"Hostel",viewAs:"HOSTEL_RENEWAL"}),f===4&&n.jsx(vn,{financeId:((Ie=(Ae=(ke=e==null?void 0:e.renewal_hostel)==null?void 0:ke.institute)==null?void 0:Ae.financeDepart)==null?void 0:Ie[0])??"",setIndex:i,setPayData:P,payData:_,ConfirmOffline:O,departmentId:((Ee=e==null?void 0:e.renewal_hostel)==null?void 0:Ee._id)??"",flowAs:"Hostel",viewAs:"HOSTEL_RENEWAL"}),f===5&&n.jsx(gn,{financeId:((Re=(Te=(Pe=e==null?void 0:e.renewal_hostel)==null?void 0:Pe.institute)==null?void 0:Te.financeDepart)==null?void 0:Re[0])??"",setIndex:i,setPayData:P,payData:_,ConfirmOffline:O,departmentId:(($e=e==null?void 0:e.renewal_hostel)==null?void 0:$e._id)??"",flowAs:"Hostel",viewAs:"HOSTEL_RENEWAL"}),f===6&&n.jsx(Nn,{financeId:((Oe=(Me=(He=e==null?void 0:e.renewal_hostel)==null?void 0:He.institute)==null?void 0:Me.financeDepart)==null?void 0:Oe[0])??"",setIndex:i,setPayData:P,payData:_,ConfirmOffline:O,departmentId:((qe=e==null?void 0:e.renewal_hostel)==null?void 0:qe._id)??"",flowAs:"Hostel",viewAs:"HOSTEL_RENEWAL"}),v&&n.jsx(F,{})]}),C&&n.jsx(wn,{onClose:()=>E(!1),allContent:t,checkoutAdmissionHandler:en}),S.run&&n.jsx(_n,{msg:S.msg,run:S.run,setRun:()=>R({msg:"",run:!1}),postiton:"bottom",type:"error"})]})}const Hn="_addDisplay_1yh8r_1",Mn="_title_1yh8r_8",On="_content_1yh8r_34",qn="_contentRow_1yh8r_51",Ln="_payLabel_1yh8r_74",Wn="_payInput_1yh8r_81",Bn="_payCardTop_1yh8r_90",Fn="_payCardContent_1yh8r_102",Gn="_btn_1yh8r_117",Jn="_btn2_1yh8r_135",Vn="_contentstatus_1yh8r_152",zn="_payConfirmbtn_1yh8r_164",T={addDisplay:Hn,title:Mn,content:On,contentRow:qn,payLabel:Ln,payInput:Wn,payCardTop:Bn,payCardContent:Fn,btn:Gn,btn2:Jn,contentstatus:Vn,payConfirmbtn:zn};function Un({cancelStatus:l,hideModal:e,cancelData:o,fetch:d,setCancelStatus:g,viewAs:b}){const[N,f]=h.useState(""),[i]=Pn(),[C]=an(),[E]=rn(),[v,r]=h.useState(!1),j=()=>{var p,t,c;o!=null&&o._id&&(o!=null&&o.applicationId)&&(o!=null&&o.studentId)&&N==="Cancel"&&(r(!0),b==="RENEWAL"?E({rid:o==null?void 0:o._id,sid:(p=o==null?void 0:o.renewal_student)==null?void 0:p._id}).then(()=>{d(),g(!1),r(!1)}).catch({}):(o==null?void 0:o.flow_status)==="Hostel Application"?C({status:o==null?void 0:o._id,appId:(t=o==null?void 0:o.applicationId)==null?void 0:t._id,sid:o==null?void 0:o.studentId}).then(()=>{d(),g(!1),r(!1)}).catch({}):i({status:o==null?void 0:o._id,appId:(c=o==null?void 0:o.applicationId)==null?void 0:c._id,sid:o==null?void 0:o.studentId}).then(S=>{S.data.cancel_status&&(d(),g(!1),r(!1))}).catch({}))};return n.jsxs(n.Fragment,{children:[!v&&n.jsx(tn,{open:l,onClose:()=>e(!1),children:n.jsxs("div",{className:`${T.addDisplay} ${T.cancelModal}`,children:[n.jsx("div",{className:T.title,children:"Not Accept Application ?"}),n.jsx("div",{className:T.content,children:n.jsxs("div",{className:T.payCard,children:[n.jsxs("label",{htmlFor:"Cancel",className:T.payLabel,children:["Type ",n.jsx("i",{children:"Cancel"})," for cancel ?"]}),n.jsx("input",{type:"text",name:"cancel",className:T.payInput,required:!0,placeholder:"Type Cancel here...",id:"Cancel",onChange:p=>f(p.target.value)}),N==="Cancel"?n.jsx("div",{className:T.btn,onClick:j,children:"Cancel"}):n.jsx("div",{className:T.btn2,children:"Cancel"})]})})]})}),v&&n.jsx(F,{})]})}const Yn=({receipt:l,onClose:e,onRefetch:o,sid:d})=>{const[g,b]=h.useState({fee_payment_mode:"",fee_payment_amount:"",transaction_date:"",fee_bank_name:"",fee_bank_holder:"",fee_utr_reference:"",fee_payment_acknowledge:""}),[N,f]=h.useState(!1),{getFeeReceiptDetail:i,getFeeReceiptDetailRefetch:C}=Tn({rid:l,skip:!l}),[E]=fn();h.useEffect(()=>{l&&C()},[l,C]),h.useEffect(()=>{var r,j,p,t,c,S,R,_;i!=null&&i.receipt&&b({fee_payment_mode:(r=i==null?void 0:i.receipt)==null?void 0:r.fee_payment_mode,fee_payment_amount:(j=i==null?void 0:i.receipt)==null?void 0:j.fee_payment_amount,transaction_date:(t=(p=i==null?void 0:i.receipt)==null?void 0:p.fee_transaction_date)==null?void 0:t.substr(0,10),fee_bank_name:(c=i==null?void 0:i.receipt)==null?void 0:c.fee_bank_name,fee_bank_holder:(S=i==null?void 0:i.receipt)==null?void 0:S.fee_bank_holder,fee_utr_reference:(R=i==null?void 0:i.receipt)==null?void 0:R.fee_utr_reference,fee_payment_acknowledge:(_=i==null?void 0:i.receipt)==null?void 0:_.fee_payment_acknowledge})},[i==null?void 0:i.receipt]);const v=()=>{var r;f(j=>!j),E({rid:(r=i==null?void 0:i.receipt)==null?void 0:r._id,sid:d,receiptReapply:g}).then(()=>{o(),e(),f(j=>!j)}).catch({})};return n.jsxs(Ze,{onClose:e,children:[n.jsx("div",{style:{width:"30rem",maxHeight:"35rem",padding:"0.9rem",overflowX:"hidden",scrollBehavior:"smooth",overflowY:"auto"},children:n.jsx(Cn,{payData:g,setPayData:b,ConfirmOffline:v,setOpenForm:e})}),N&&n.jsx(F,{})]})},Ke=({renewal:l,onRefetch:e})=>{var C,E,v,r,j;const{t:o}=B(),[d,g]=h.useState(!1),[b,N]=h.useState(!1),[f,i]=h.useState(!1);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:I.student_renewal_card,children:[n.jsx("h6",{children:o("current_stay")}),n.jsxs("div",{className:I.student_renewal_date,children:[n.jsx("p",{children:o("start_on")}),n.jsx("p",{children:Ye(l==null?void 0:l.renewal_start).format("DD MMM yyyy")})]}),n.jsxs("div",{className:I.student_renewal_date,children:[n.jsx("p",{children:o("expire_on")}),n.jsx("p",{children:Ye(l==null?void 0:l.renewal_end).format("DD MMM yyyy")})]}),n.jsxs("p",{children:["Stay for"," ",(E=(C=l==null?void 0:l.renewal_student)==null?void 0:C.hostel_fee_structure)==null?void 0:E.structure_month," ","Months for fees info click here"]}),(l==null?void 0:l.renewal_status)==="Current Stay Request"&&n.jsxs(n.Fragment,{children:[n.jsx("h6",{children:o("renewal_requested")}),n.jsxs("div",{className:I.student_renewal_btn_group,children:[n.jsx("button",{className:I.student_renewal_cancel_btn,onClick:()=>N(!0),children:o("cancel")}),n.jsx("button",{className:I.student_renewal_confirm_btn,onClick:()=>g(!0),children:o("confirm")})]})]}),(l==null?void 0:l.receipt_status)==="Requested"&&n.jsxs(n.Fragment,{children:[n.jsx("h6",{children:o("renewal_requested")}),n.jsx("div",{className:I.student_renewal_btn_group,children:n.jsx("button",{className:I.student_renewal_confirm_btn,style:{backgroundColor:"#B8B83E",width:"100%"},children:o("requested")})})]}),(l==null?void 0:l.receipt_status)==="Rejected"&&n.jsxs(n.Fragment,{children:[n.jsx("h6",{children:o("renewal_requested")}),n.jsxs("div",{className:I.student_renewal_date,style:{justifyContent:"flex-start"},children:[n.jsxs("p",{children:[o("reason")," "]}),n.jsx("p",{children:` : ${((v=l==null?void 0:l.receipt)==null?void 0:v.reason)??""}`})]}),n.jsx("div",{className:I.student_renewal_btn_group,children:n.jsx("button",{className:I.student_renewal_confirm_btn,style:{width:"100%"},onClick:()=>i(!0),children:o("re_apply_for_receipt")})})]})]}),f&&n.jsx(Yn,{receipt:(r=l==null?void 0:l.receipt)==null?void 0:r._id,onClose:()=>i(!1),onRefetch:e,sid:(j=l==null?void 0:l.renewal_student)==null?void 0:j._id}),d&&n.jsx($n,{addDisplay:d,hideModal:p=>g(p),statusQuery:l,onRefetchApplication:e}),b&&n.jsx(Un,{cancelStatus:b,hideModal:p=>N(p),cancelData:l,fetch:e,setCancel:N,viewAs:"RENEWAL"})]})},_o=({sid:l,isProfile:e,isOther:o})=>{const{t:d}=B(),[g,b]=cn(),[N,f]=h.useState(1),[i,C]=h.useState(!0),[E,v]=h.useState(!0),[r,j]=h.useState([]),[p,t]=h.useState(!1),{getRenewalListByStudent:c,getRenewalListByStudentRefetch:S}=pn({data:{sid:l,page:N,limit:10},skip:!l});h.useEffect(()=>{l&&(v(!0),S())},[l,N,S]),h.useEffect(()=>{b&&i&&f(_=>_+1)},[b,i]),h.useEffect(()=>{var _,P;p?(j(c==null?void 0:c.all_renewals),v(!1),t(!1)):c!=null&&c.all_renewals?(j($=>[...new Set([...$,...c==null?void 0:c.all_renewals].map(JSON.stringify))].map(JSON.parse)),v(!1)):((_=c==null?void 0:c.all_renewals)==null?void 0:_.length)===0&&v(!1),((P=c==null?void 0:c.all_renewals)==null?void 0:P.length)===10?C(!0):C(!1)},[c==null?void 0:c.all_renewals]);const R=()=>{f(1),t(!0),v(!0),S()};return n.jsxs(n.Fragment,{children:[e==="VIEW_PROFILE"||o?"":n.jsxs(n.Fragment,{children:[n.jsx("div",{className:I.with_search,children:n.jsx("h6",{children:d("stay_renewal")})}),n.jsx(xn,{customStyle:{marginTop:"0.5rem",marginBottom:"0.6rem",width:"100%"}})]}),r==null?void 0:r.map((_,P)=>(r==null?void 0:r.length)===P+1?n.jsx("div",{ref:g,children:n.jsx(Ke,{renewal:_,onRefetch:R})},_==null?void 0:_._id):n.jsx(Ke,{renewal:_,onRefetch:R},_==null?void 0:_._id)),E&&n.jsx(mn,{})]})};export{_o as S};
